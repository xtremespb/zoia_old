"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(_){var a="zoiaFormBuilder",i={load:{url:"#",method:"POST"},save:{url:"#",method:"POST"},captcha:"/api/captcha",items:[],edit:!1,validation:!0,html:{helpText:'<div class="uk-text-meta">{text}</div>',text:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><input class="uk-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',select:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><select{multiple} class="uk-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-flex"><div class="{prefix}-field-wrap"><input class="uk-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="uk-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',captcha:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-grid uk-grid-small"><div><input class="uk-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="uk-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="uk-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}_btn">{label}:{bullet}</label><div class="uk-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="uk-button uk-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}{html}</div>',textarea:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><textarea class="uk-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',checkboxlistItem:'<li><label><input class="uk-checkbox {prefix}-{name}-cbx" type="checkbox" data="{title}">&nbsp;&nbsp;{title}</label></li>',checkboxlist:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-panel uk-panel-scrollable{css}" id="{prefix}_{name}_wrap"><ul class="uk-list">{items}</ul></div>{helpText}</div>',valueslistItem:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right"><input placeholder="{langParameter}" type="text" class="uk-input formBuilder-valueslist-par" value="{key}"></div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div><div style="padding-top:3px"><button class="uk-icon-button uk-button-danger formBuilder-valueslist-btnDel" uk-icon="icon:minus"></button></div></div>',valueslistItemFixed:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right">{key}</div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div></div>',valueslist:'<div class="uk-flex uk-flex-column"><div class="uk-margin-bottom"><label class="uk-form-label">{label}:{bullet}</label></div><div><button type="button" class="uk-icon-button uk-button-primary formBuilder-valueslist-btnAdd" id="{prefix}_{name}_btnAdd" uk-icon="icon:plus" data-prefix="{prefix}" data-name="{name}"></button></div><div id="{prefix}_{name}_wrap" class="uk-margin-bottom {prefix}-formBuilder-valueslist-wrap">{items}</div></div>',bullet:'&nbsp;<span style="color:red;font-size:120%">&#8226;</span>'},template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:"Should not be empty",tooShort:"Too short",tooLong:"Too long",invalidFormat:"Doesn't match required format",passwordsNotMatch:"Passwords do not match",parameter:"Parameter",value:"Value"},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(){},onSaveSuccess:function(){},onSaveError:function(){},onLoadStart:function(){},onLoadSuccess:function(){},onLoadError:function(){}},formDangerClass:"uk-form-danger"},s=function(t,e){this.element=t,this.settings=_.extend({},i,e),this._defaults=i,this._name=a,this._prefix=this.element.id,this._formTypes=["text","email","password","tags","select","passwordConfirm","captcha","launcher","textarea","checkboxlist","valueslist","valueslistfixed","valueslisteditable"],this._saving=!1,this.init()};_.extend(s.prototype,{init:function(){var t="",e="";for(var a in this.settings.items){var i=this.settings.items[a],s="";switch((i.validation&&!this.settings.edit&&i.validation.mandatoryCreate||i.validation&&this.settings.edit&&i.validation.mandatoryEdit)&&(s=this.settings.html.bullet),i.type){case"text":case"email":case"password":case"tags":t+=this._template(this.settings.html.text,{prefix:this._prefix,name:a,label:i.label,bullet:s,css:i.css?" "+i.css:"",autofocus:i.autofocus?"autofocus":"",helpText:i.helpText?this._template(this.settings.html.helpText,{text:i.helpText,prefix:this._prefix}):"",type:i.type});break;case"launcher":t+=this._template(this.settings.html.launcher,{prefix:this._prefix,name:a,label:i.label,bullet:s,labelBtn:i.labelBtn,data:i.data,value:i.value,css:i.css?" "+i.css:"",helpText:i.helpText?this._template(this.settings.html.helpText,{text:i.helpText,prefix:this._prefix}):"",html:i.html?" "+i.html:""});break;case"valueslist":var l="";for(var n in i.values)l+=this._template(this.settings.html.valueslistItem,{prefix:this._prefix,name:a,key:i.values[n].p,value:i.values[n].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t+=this._template(this.settings.html.valueslist,{prefix:this._prefix,name:a,label:i.label,bullet:s,items:l});break;case"valueslisteditable":var r="";for(var o in i.values)r+=this._template(i.values[o].t?this.settings.html.valueslistItemEditablePostfix:this.settings.html.valueslistItemEditable,{prefix:this._prefix,name:a,key:i.values[o].p,value:i.values[o].v,postfix:i.values[o].t,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t+=this._template(this.settings.html.valueslistEditable,{prefix:this._prefix,name:a,label:i.label,bullet:s,items:r,helpText:i.helpText?this._template(this.settings.html.helpText,{text:i.helpText,prefix:this._prefix}):"",buttons:i.buttons||""});break;case"valueslistfixed":var d="";for(var u in i.values)d+=this._template(this.settings.html.valueslistItemFixed,{prefix:this._prefix,name:a,key:i.values[u].p,value:i.values[u].t,data:i.values[u].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t+=this._template(this.settings.html.valueslistFixed,{prefix:this._prefix,name:a,label:i.label,bullet:s,items:d});break;case"select":var c="";for(var p in i.values)c+='<option value="'+p+'">'+i.values[p]+"</option>";t+=this._template(this.settings.html.select,{prefix:this._prefix,name:a,label:i.label,bullet:s,css:i.css?" "+i.css:"",multiple:i.multiple?" multiple":"",autofocus:i.autofocus?"autofocus":"",helpText:i.helpText?this._template(this.settings.html.helpText,{text:i.helpText,prefix:this._prefix}):"",type:i.type,values:c});break;case"checkboxlist":var f="";for(var m in i.values)f+=this._template(this.settings.html.checkboxlistItem,{prefix:this._prefix,name:a,title:i.values[m]});t+=this._template(this.settings.html.checkboxlist,{prefix:this._prefix,name:a,label:i.label,bullet:s,css:i.css?" "+i.css:"",multiple:i.multiple?" multiple":"",helpText:i.helpText?this._template(this.settings.html.helpText,{text:i.helpText,prefix:this._prefix}):"",items:f});break;case"passwordConfirm":t+=this._template(this.settings.html.passwordConfirm,{prefix:this._prefix,name:a,label:i.label,bullet:s,css:i.css?" "+i.css:"",autofocus:i.autofocus?"autofocus":"",helpText:i.helpText?this._template(this.settings.html.helpText,{text:i.helpText,prefix:this._prefix}):"",type:"password"});break;case"captcha":t+=this._template(this.settings.html.captcha,{prefix:this._prefix,name:a,css:i.css?" "+i.css:"",label:i.label,bullet:s,helpText:i.helpText?this._template(this.settings.html.helpText,{text:i.helpText,prefix:this._prefix}):"",autofocus:i.autofocus?"autofocus":""});break;case"textarea":t+=this._template(this.settings.html.textarea,{prefix:this._prefix,name:a,label:i.label,bullet:s,rows:i.rows?i.rows:"2",css:i.css?" "+i.css:"",autofocus:i.autofocus?"autofocus":"",helpText:i.helpText?this._template(this.settings.html.helpText,{text:i.helpText,prefix:this._prefix}):""});break;case"buttons":for(var v="",h=0;h<i.buttons.length;h++){var b=i.buttons[h];v+=this._template(this.settings.html.button,{css:b.css?" "+b.css:"",prefix:this._prefix,name:b.name||"button"+h,type:b.type||"button",label:b.label||""})+"&nbsp;"}e+=this._template(this.settings.html.buttonsWrap,{prefix:this._prefix,css:i.css?" "+i.css:"",buttons:v,html:i.html?" "+i.html:""})}}_(this.element).html(this._template(this.settings.template.fields,{fields:t})+this._template(this.settings.template.buttons,{buttons:e})),_(".formBuilder-valueslist-btnAdd").unbind(),_(".formBuilder-valueslist-btnAdd").click(function(t){x._valueslistAddFunc(_(this).attr("data-prefix"),_(this).attr("data-name"),"","")}),_(".formBuilder-valueslist-btnDel").unbind(),_(".formBuilder-valueslist-btnDel").click(function(t){_(this).parent().parent().remove()}),_(".formBuilder-valueslistfixed-btnAdd").unbind(),_(".formBuilder-valueslistfixed-btnAdd").click(function(t){x._valueslistfixedAddFunc(_(this).attr("data-prefix"),_(this).attr("data-name"),"","")}),_(".formBuilder-valueslistfixed-btnDel").unbind(),_(".formBuilder-valueslistfixed-btnDel").click(function(t){_(this).parent().parent().remove()}),_(".formBuilder-valueslisteditable-btnAdd").unbind(),_(".formBuilder-valueslisteditable-btnAdd").click(function(t){x._valueslistAddFunc(_(this).attr("data-prefix"),_(this).attr("data-name"),"","")}),_(".formBuilder-valueslisteditable-btnDel").unbind(),_(".formBuilder-valueslisteditable-btnDel").click(function(t){_(this).parent().parent().remove()}),this.settings.events.onInit&&this.settings.events.onInit();var x=this;for(var g in _(this.element).submit(function(t){t.preventDefault(),x._submit()}),this._captchaInit(),this.settings.items){this.settings.items[g].autofocus&&_("#"+this._prefix+"_"+g).focus()}},_valueslistAddFunc:function(t,e,a,i,s){var l=this._template(this.settings.html.valueslistItem,{prefix:t,name:e,key:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:i,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});_("#"+t+"_"+e+"_wrap").append(l),s||_("."+t+"-"+e+"-item").last().find("div>input:first").focus(),_(".formBuilder-valueslist-btnDel").unbind(),_(".formBuilder-valueslist-btnDel").click(function(t){t.stopPropagation(),_(this).parent().parent().remove()})},_valueslisteditableAddFunc:function(t,e,a,i,s,l,n){if(l="undefined"===l?null:l,a){a=String(a);var r=this._template(l?this.settings.html.valueslistItemEditablePostfix:this.settings.html.valueslistItemEditable,{prefix:t,name:e,key:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:i,data:s,postfix:l,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});_("#"+t+"_"+e+"_wrap").append(r),n||_("."+t+"-"+e+"-item").last().find("div>input:first").focus(),_(".formBuilder-valueslisteditable-btnDel").unbind(),_(".formBuilder-valueslisteditable-btnDel").click(function(t){t.stopPropagation(),_(this).parent().parent().remove()})}},_valueslistfixedAddFunc:function(t,e,a,i,s){var l=this._template(this.settings.html.valueslistfixedItem,{prefix:t,name:e,key:a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:i,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});_("#"+t+"_"+e+"_wrap").append(l),s||_("."+t+"-"+e+"-item").last().find("div>input:first").focus(),_(".formBuilder-valueslistfixed-btnDel").unbind(),_(".formBuilder-valueslistfixed-btnDel").click(function(t){t.stopPropagation(),_(this).parent().parent().remove()})},setValidation:function(t){this.validation=t},setEditMode:function(t){this.settings.edit=t},clearErrors:function(){_("."+this._prefix+"-form-field").removeClass(this.settings.formDangerClass),_("."+this._prefix+"-error-text").hide()},resetForm:function(){this.clearErrors();for(var t in _("."+this._prefix+"-form-field").not(".zoiaFormBuilder-no-reset").val(""),_("select."+this._prefix+"-form-field").prop("selectedIndex",0),_(".formBuilder-valueslist-val").val(""),_("."+this._prefix+"-formBuilder-valueslist-wrap").html(""),this.settings.items){var e=this.settings.items[t];e.default&&_("#"+this._prefix+"_"+t).val(e.default),"launcher"===e.type&&(_("#"+this._prefix+"_"+t+"_val").html(e.value),_("#"+this._prefix+"_"+t+"_val").attr("data",e.data)),"checkboxlist"===e.type&&_("."+this._prefix+"-"+t+"-cbx").prop("checked",!1)}},serialize:function(){var s=this,l={};for(var n in this.settings.items){var r=this.settings.items[n];-1!==this._formTypes.indexOf(r.type)&&function(){switch(r.type){case"launcher":l[n]={type:r.type,value:_("#"+s._prefix+"_"+n+"_val").html(),id:_("#"+s._prefix+"_"+n+"_val").attr("data")};break;case"checkboxlist":var t=_("."+s._prefix+"-"+n+"-cbx:checked").map(function(){return _(this).attr("data")}).get();l[n]={type:r.type,value:t.join(",")};break;case"valueslist":var e=[];_("."+s._prefix+"-"+n+"-item").each(function(){e.push({p:String(_(this).find("*>.formBuilder-valueslist-par").val()),v:String(_(this).find("*>.formBuilder-valueslist-val").val())})}),l[n]={type:r.type,value:e};break;case"valueslisteditable":var a=[];_("."+s._prefix+"-"+n+"-item").each(function(){a.push({p:String(_(this).find("*>.formBuilder-valueslist-par").html()),v:String(_(this).find("*>.formBuilder-valueslist-val").val()),d:String(_(this).find("*>.formBuilder-valueslist-val").attr("data")),t:String(_(this).find("*>.formBuilder-valueslist-val").attr("data-postfix"))})}),l[n]={type:r.type,value:a};break;case"valueslistfixed":var i=[];_("."+s._prefix+"-"+n+"-item").each(function(){i.push({p:String(_(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(_(this).find("*>.formBuilder-valueslist-val").val())})}),l[n]={type:r.type,value:i};break;default:l[n]={type:r.type,value:_("#"+s._prefix+"_"+n).val()}}}()}return l},deserialize:function(t){if(t&&"object"===(void 0===t?"undefined":_typeof(t)))for(var e in this.settings.items)switch(t[e]||(t[e]={id:"",value:""}),t[e].type){case"launcher":_("#"+this._prefix+"_"+e+"_val").html(t[e].value),_("#"+this._prefix+"_"+e+"_val").attr("data",t[e].id);break;case"checkboxlist":var a=t[e].value.split(",");for(var i in a)_('.editForm-groups-cbx[data="'+a[i]+'"]').prop("checked",!0);break;case"valueslist":var s=[];for(var l in t[e].value)s.push(t[e].value[l].p),s.push(t[e].value[l].v);for(_("#"+this._prefix+"_"+e+"_wrap").html("");0<s.length;){var n=s.shift(),r=s.shift();this._valueslistAddFunc(this._prefix,e,n,r,!0)}break;case"valueslisteditable":var o=[];for(var d in t[e].value)o.push(t[e].value[d].p),o.push(t[e].value[d].v),o.push(t[e].value[d].d),o.push(t[e].value[d].t);for(_("#"+this._prefix+"_"+e+"_wrap").html("");0<o.length;){var u=o.shift(),c=o.shift(),p=o.shift(),f=o.shift();this._valueslisteditableAddFunc(this._prefix,e,u,c,p,f,!0)}break;case"valueslistfixed":for(var m in _("."+this._prefix+"-"+e+"-item-val").val(""),t[e].value)_("."+this._prefix+"-"+e+'-item-val[data="'+t[e].value[m].p+'"]').val(t[e].value[m].v);break;default:_("#"+this._prefix+"_"+e).val(t[e].value||"")}},deserializePart:function(t,e){if(e&&"object"===(void 0===e?"undefined":_typeof(e)))switch(e||(e={id:"",value:""}),e.type){case"launcher":_("#"+this._prefix+"_"+t+"_val").html(e.value),_("#"+this._prefix+"_"+t+"_val").attr("data",e.id);break;case"checkboxlist":var a=e.value.split(",");for(var i in a)_('.editForm-groups-cbx[data="'+a[i]+'"]').prop("checked",!0);break;case"valueslist":var s=[];for(var l in e.value)s.push(e.value[l].p),s.push(e.value[l].v);for(_("#"+this._prefix+"_"+t+"_wrap").html("");0<s.length;){var n=s.shift(),r=s.shift();this._valueslistAddFunc(this._prefix,t,n,r,!0)}break;case"valueslisteditable":var o=[];for(var d in e.value)o.push(e.value[d].p),o.push(e.value[d].v),o.push(e.value[d].d),o.push(e.value[d].t);for(_("#"+this._prefix+"_"+t+"_wrap").html("");0<o.length;){var u=o.shift(),c=o.shift(),p=o.shift(),f=o.shift();this._valueslisteditableAddFunc(this._prefix,t,u,c,p,f,!0)}break;case"valueslistfixed":for(var m in _("."+this._prefix+"-"+t+"-item-val").val(""),e.value)_("."+this._prefix+"-"+t+'-item-val[data="'+e.value[m].p+'"]').val(e.value[m].v);break;default:_("#"+this._prefix+"_"+t).val(e.value||"")}},loadJSON:function(t){var c=this,p=this;jQuery.each(t,function(t,e){if(_("#"+p._prefix+"_"+t).val(e),p.settings.items[t]&&"checkboxlist"===p.settings.items[t].type&&e){var a=e.split(",");for(var i in a)_('.editForm-groups-cbx[data="'+a[i]+'"]').prop("checked",!0)}if(p.settings.items[t]&&"valueslist"===p.settings.items[t].type&&e){var s=[];for(var l in e)s.push(l),s.push(e[l]);for(var n in _("#"+p._prefix+"_"+t+"_wrap").html(""),e)p._valueslistAddFunc(p._prefix,t,s.shift(),s.shift())}if(p.settings.items[t]&&"valueslisteditable"===p.settings.items[t].type&&e){var r=[];for(var o in e)r.push(o),r.push(e[o]);for(var d in _("#"+p._prefix+"_"+t+"_wrap").html(""),e)p._valueslisteditableAddFunc(p._prefix,t,r.shift(),r.shift(),r.shift(),r.shift())}if(p.settings.items[t]&&"valueslistfixed"===p.settings.items[t].type&&e)for(var u in _("."+c._prefix+"-"+t+"-item-val").val(""),e)_("."+c._prefix+"-"+t+'-item-val[data="'+e[u].p+'"]').val(e[u].v)})},loadData:function(t){var c=this;this.settings.events.onLoadStart&&this.settings.events.onLoadStart(),this.resetForm();var p=this;_.ajax({type:this.settings.load.method,url:this.settings.load.url,data:t,cache:!1}).done(function(t){t&&1===t.status?(jQuery.each(t.item,function(t,e){if(_("#"+p._prefix+"_"+t).val(e),p.settings.items[t]&&"checkboxlist"===p.settings.items[t].type&&e){var a=e.split(",");for(var i in a)_('.editForm-groups-cbx[data="'+a[i]+'"]').prop("checked",!0)}if(p.settings.items[t]&&"valueslist"===p.settings.items[t].type&&e){var s=[];for(var l in e)s.push(l),s.push(e[l]);for(var n in _("#"+p._prefix+"_"+t+"_wrap").html(""),e)p._valueslistAddFunc(p._prefix,t,s.shift(),s.shift())}if(p.settings.items[t]&&"valueslisteditable"===p.settings.items[t].type&&e){var r=[];for(var o in e)r.push(o),r.push(e[o]);for(var d in _("#"+p._prefix+"_"+t+"_wrap").html(""),e)p._valueslisteditableAddFunc(p._prefix,t,r.shift(),r.shift(),r.shift())}if(p.settings.items[t]&&"valueslistfixed"===p.settings.items[t].type&&e)for(var u in _("."+c._prefix+"-"+t+"-item-val").val(""),e)_("."+c._prefix+"-"+t+'-item-val[data="'+e[u].p+'"]').val(e[u].v)}),p.settings.events.onLoadSuccess&&p.settings.events.onLoadSuccess(t)):p.settings.events.onLoadError&&p.settings.events.onLoadError(t)}).fail(function(t,e){p.settings.events.onLoadError&&p.settings.events.onLoadError(t,e)})},captchaRefresh:function(){_("."+this._prefix+"-captcha-img").show(),_("."+this._prefix+"-captcha-img").attr("src",this.settings.captcha+"?"+(new Date).getTime()),_("."+this._prefix+"-captcha-field").val("")},_captchaInit:function(){this.captchaRefresh();var t=this;_("img."+this._prefix+"-captcha-img").click(function(){t.captchaRefresh()})},_template:function(t,e){for(var a in e)t=t.replace(new RegExp("{"+a+"}","g"),e[a]);return t},validate:function(e){var a=this,t={},i={};for(var s in this.settings.items){var l=this.settings.items[s];if(-1!==this._formTypes.indexOf(l.type))if("launcher"!==l.type){if("valueslist"===l.type)if("continue"===function(){if(e&&e[s])return i[s]=e[s].value,"continue";var t=[];return _("."+a._prefix+"-"+s+"-item").each(function(){t.push({p:String(_(this).find("*>.formBuilder-valueslist-par").val()),v:String(_(this).find("*>.formBuilder-valueslist-val").val())})}),i[s]=t,"continue"}())continue;if("valueslisteditable"===l.type)if("continue"===function(){if(e&&e[s])return i[s]=e[s].value,"continue";var t=[];return _("."+a._prefix+"-"+s+"-item").each(function(){t.push({p:String(_(this).find("*>.formBuilder-valueslist-par").val()),v:String(_(this).find("*>.formBuilder-valueslist-val").val())})}),i[s]=t,"continue"}())continue;if("valueslistfixed"===l.type)if("continue"===function(){if(e&&e[s])return i[s]=e[s].value,"continue";var t=[];return _("."+a._prefix+"-"+s+"-item").each(function(){t.push({p:String(_(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(_(this).find("*>.formBuilder-valueslist-val").val())})}),i[s]=t,"continue"}())continue;if("checkboxlist"!==l.type){var n=e?e[s]?e[s].value:void 0:_("#"+this._prefix+"_"+s).val();if(l.validation){if(!l.validation.mandatoryEdit&&!n&&this.settings.edit||!l.validation.mandatoryCreate&&!n&&!this.settings.edit)continue;if(l.validation.mandatoryCreate&&!n&&!this.settings.edit){t[s]=this.settings.lang.mandatoryMissing;continue}if(l.validation.mandatoryEdit&&!n&&this.settings.edit){t[s]=this.settings.lang.mandatoryMissing;continue}if(l.validation.process&&"function"==typeof l.validation.process&&(n=l.validation.process(n)),"passwordConfirm"===l.type)if(_("#"+this._prefix+"_"+s+"Confirm").val()!==n){t[s]=this.settings.lang.passwordsNotMatch;continue}if(l.validation.length){if(l.validation.length.min&&n.length<l.validation.length.min){t[s]=this.settings.lang.tooShort;continue}if(l.validation.length.max&&n.length>l.validation.length.max){t[s]=this.settings.lang.tooLong;continue}}if(l.validation.regexp&&!n.match(l.validation.regexp)){t[s]=this.settings.lang.invalidFormat;continue}i[s]=n}}else{var r=_("."+this._prefix+"-"+s+"-cbx:checked").map(function(){return _(this).attr("data")}).get();i[s]=e?e[s]?e[s].value:void 0:r.join(",")}}else i[s]=e?e[s]?e[s].id:void 0:_("#"+this._prefix+"_"+s+"_val").attr("data")}return{data:i,errors:t}},errors:function(t){if(0<Object.keys(t).length){var e=!1;for(var a in t)_("#"+this._prefix+"_"+a).addClass(this.settings.formDangerClass),_("#"+this._prefix+"_"+a+"_error_text > span").html(t[a]),_("#"+this._prefix+"_"+a+"_error_text").show(),e||(_("#"+this._prefix+"_"+a).focus(),e=!0),"passwordConfirm"===this.settings.items[a].type&&_("#"+this._prefix+"_"+a+"Confirm").addClass(this.settings.formDangerClass);return!0}return!1},_submit:function(){if(!this._saving){this.settings.events.onSaveSubmit&&this.settings.events.onSaveSubmit(),this.clearErrors();var i=this,t={},e={};if(this.settings.validation){var a=this.validate();if(t=a.data||{},e=a.errors||{},this.errors(e))return;if(this.settings.events.onSaveValidate&&"__stop"===(t=this.settings.events.onSaveValidate(t,e)||t))return}else if(this.settings.events.onSaveValidate&&"__stop"===(t=this.settings.events.onSaveValidate(t)))return;i._saving=!0,_.ajax({type:this.settings.save.method,url:this.settings.save.url,data:t,cache:!1}).done(function(t){if(i._saving=!1,t&&1===t.status)i.settings.events.onSaveSuccess&&i.settings.events.onSaveSuccess(t);else{if(t.fields)for(var e in t.fields){var a=!1;_("#"+i._prefix+"_"+t.fields[e]).addClass(i.settings.formDangerClass),a||(_("#"+i._prefix+"_"+t.fields[e]).focus(),a=!0)}i.captchaRefresh(),i.settings.events.onSaveError&&i.settings.events.onSaveError(t)}}).fail(function(t,e){i._saving=!1,i.captchaRefresh(),i.settings.events.onSaveError&&i.settings.events.onSaveError(t,e)})}}}),_.fn[a]=function(t){var e=void 0;return this.each(function(){(e=_.data(this,"plugin_"+a))||(e=new s(this,t),_.data(this,"plugin_"+a,e))}),e}}(jQuery,window,document),function(){var s=void 0,l=void 0,n=void 0,a=void 0,r=void 0,o=void 0,i=void 0,d=void 0,u=void 0,c=void 0,p=void 0,f=function(t){if(t.preventDefault(),!$("#zoia_spinner_topup").is(":visible")){$(".zoia-topup-field").removeClass("za-form-danger");var e=$("#topup_sum").val().trim();if(!e||!e.match(/^\d+(\.\d+)?$/))return $("#topup_sum").addClass("za-form-danger");$("#zoia_spinner_topup").show(),$("#zoia_btn_topup").hide(),$.ajax({type:"POST",url:"/customer/payment/request",data:{sum:e},cache:!1}).done(function(t){t&&1===t.status&&t.url?location.href=t.url:($("#zoia_spinner_topup").hide(),$("#zoia_btn_topup").show(),t.error?$zUI.modal.alert(t.error,{labels:{ok:lang.OK},stack:!0}):$zUI.modal.alert(lang["Unable to create top-up request. Please try again later."],{labels:{ok:lang.OK},stack:!0}))}).fail(function(){$("#zoia_spinner_topup").hide(),$("#zoia_btn_topup").show(),$zUI.modal.alert(lang["Unable to create top-up request. Please try again later."],{labels:{ok:lang.OK},stack:!0})},200)}},m=function(){var t=$("#zoiaAccountForm_preset").val(),e=$("#zoiaAccountForm_months").val(),a=i[t]*e;c<a?($("#zoiaAccountForm_btnSave").prop("disabled",!0),$("#zoiaAccountCreateInsufficientFunds").show()):($("#zoiaAccountForm_btnSave").prop("disabled",!1),$("#zoiaAccountCreateInsufficientFunds").hide()),$(".zoia-create-account-total").html(("left"===u.currencyPosition?u.currency[o]:"")+a+("right"===u.currencyPosition?"&nbsp;"+u.currency[o]:""))},v=function(){var t=$("#zoiaAccountExtendForm_months").val(),e=a*t;c<e?($("#zoiaAccountExtendForm_btnSave").prop("disabled",!0),$("#zoiaAccountExtendInsufficientFunds").show()):($("#zoiaAccountExtendForm_btnSave").prop("disabled",!1),$("#zoiaAccountExtendInsufficientFunds").hide()),$(".zoia-extend-account-total").html(("left"===u.currencyPosition?u.currency[o]:"")+e+("right"===u.currencyPosition?"&nbsp;"+u.currency[o]:""))},h=function(t){t.preventDefault(),a=parseFloat(i[$(this).parent().parent().find("td:eq(1)").attr("data")]),r=$(this).parent().parent().find("td:eq(0)").html(),v(),$("#zoiaAccountExtendForm").zoiaFormBuilder().resetForm(),s.show()};$(document).ready(function(){o=$("#zp_locale").attr("data"),i=JSON.parse($("#zp_prices").attr("data")),d=JSON.parse($("#zp_presets").attr("data")),u=JSON.parse($("#zp_configModule").attr("data")),c=parseFloat($("#zp_totalFunds").attr("data")),p=parseInt($("#zp_transactionsLength").attr("data"),10),$.getScript("/api/lang/hosting/"+o+".js").done(function(){var t={mandatoryMissing:lang["Should not be empty"],tooShort:lang["Too short"],tooLong:lang["Too long"],invalidFormat:lang["Doesn't match required format"],passwordsNotMatch:lang["Passwords do not match"],parameter:lang.Parameter,value:lang.Value},e={helpText:'<div class="za-text-meta">{text}</div>',text:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><input class="za-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>',select:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><select{multiple} class="za-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-flex"><div class="{prefix}-field-wrap"><input class="za-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="za-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',captcha:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-grid za-grid-small"><div><input class="za-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="za-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="za-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}_btn">{label}:</label><div class="za-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="za-button za-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}{html}</div>',textarea:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><textarea class="za-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>',checkboxlistItem:'<li><label><input class="za-checkbox {prefix}-{name}-cbx" type="checkbox" data="{title}">&nbsp;&nbsp;{title}</label></li>',checkboxlist:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-panel za-panel-scrollable{css}" id="{prefix}_{name}_wrap"><ul class="za-list">{items}</ul></div>{helpText}</div>',valueslistItem:'<div class="za-flex za-margin-top {prefix}-{name}-item"><div class="za-margin-right"><input placeholder="{langParameter}" type="text" class="za-input formBuilder-valueslist-par" value="{key}"></div><div class="za-margin-right"><input placeholder="{langValue}" type="text" class="za-input formBuilder-valueslist-val" value="{value}"></div><div style="padding-top:3px"><button class="za-icon-button za-button-danger formBuilder-valueslist-btnDel" za-icon="icon:minus"></button></div></div>',valueslistItemFixed:'<div class="za-flex za-margin-top {prefix}-{name}-item"><div class="za-margin-right" style="margin-top:10px;min-width:100px;font-size:80%">{value}:</div><div class="za-margin-right"><input placeholder="{langValue}" type="text" class="za-input formBuilder-valueslist-val {prefix}-{name}-item-val" value="{data}" data="{key}"></div></div>',valueslistItemEditable:'<div class="za-flex za-width-1-2@l za-width-1-1@m za-card za-card-default za-card-small za-card-body {prefix}-{name}-item"><span class="za-sortable-handle za-margin-small-right" za-icon="icon: table"></span><div class="za-width-1-1"><button type="button" class="selectPropertyItemClose" za-close style="float:right"></button><label class="za-form-label formBuilder-valueslist-par">{key}</label><input placeholder="{langValue}" type="text" class="za-input za-width-1-1 formBuilder-valueslist-val" value="{value}" data="{data}"></div></div>',valueslistItemEditablePostfix:'<div class="za-flex za-width-1-2@l za-width-1-1@m za-card za-card-default za-card-small za-card-body {prefix}-{name}-item"><span class="za-sortable-handle za-margin-small-right" za-icon="icon: table"></span><div class="za-width-1-1"><button type="button" class="selectPropertyItemClose" za-close style="float:right"></button><label class="za-form-label formBuilder-valueslist-par">{key}</label><div><div class="za-inline za-form-width-medium"><span class="za-form-icon za-form-icon-flip">{postfix}</span><input placeholder="{langValue}" type="number" step="0.01" class="za-input za-width-1-1 formBuilder-valueslist-val" value="{value}" data-postfix="{postfix}" data="{data}"></div></div></div></div>',valueslist:'<div class="za-flex za-flex-column"><div class="za-margin-bottom"><label class="za-form-label">{label}:</label></div><div><button type="button" class="za-icon-button za-button-primary formBuilder-valueslist-btnAdd" id="{prefix}_{name}_btnAdd" za-icon="icon:plus" data-prefix="{prefix}" data-name="{name}"></button></div><div id="{prefix}_{name}_wrap" class="za-margin-bottom {prefix}-formBuilder-valueslist-wrap">{items}</div>',valueslistFixed:'<div class="za-flex za-flex-column"><div><label class="za-form-label">{label}:</label></div><div id="{prefix}_{name}_wrap" class="za-margin-bottom formBuilder-valueslist-wrap">{items}</div></div>',valueslistEditable:'<div class="za-flex za-flex-column" id="{prefix}_{name}_widget"><div class="za-margin-bottom"><label class="za-form-label">{label}:</label></div>{buttons}<div id="{prefix}_{name}_wrap" class="za-margin-bottom {prefix}-formBuilder-valueslist-wrap" za-sortable="handle:.za-sortable-handle">{items}</div><div class="za-margin-bottom">{helpText}</div></div>',bullet:'&nbsp;<span style="color:red;font-size:140%">&#8226;</span>'},a={template:{fields:'<div class="za-modal-body">{fields}</div>',buttons:"{buttons}"},formDangerClass:"za-form-danger",html:e,events:{onSaveValidate:function(t){return/[A-Z]/.test(t.password)+/[a-z]/.test(t.password)+/\d/.test(t.password)+/\W/.test(t.password)<3?($zUI.modal.alert(lang["Password is too weak. Please use both lowercase and uppercase characters, numbers and special characters. Minimal length: 8"],{labels:{ok:lang.OK},stack:!0}),$("#zoiaAccountForm_password").addClass("za-form-danger"),$("#zoiaAccountForm_passwordConfirm").addClass("za-form-danger"),"__stop"):($("#zoiaAccountCreateSpinner").show(),$(".zoiaAccountForm-form-button").hide(),t)},onSaveSuccess:function(t){$("#zoiaAccountCreateSpinner").hide(),$(".zoiaAccountForm-form-button").show(),t&&t.status&&1===t.status&&t.taskID?(l.hide(),n.show(),function a(i){$.ajax({type:"GET",url:"/api/customer/account/create/status",data:{id:i},cache:!1}).done(function(t){if(t&&1===t.status)if(t.state&&2===t.state){n.hide(),$(".zoia-accounts-empty-accounts").is(":visible")&&$("#zoia_account_table_body").html(""),$(".zoia-accounts-empty-history").is(":visible")&&$("#zoia_history_table>tbody").html(""),$("#zoia_account_table_body").append('<tr><td class="zoia-accounts-id">'+t.id+'</td><td data="'+t.presetID+'">'+t.preset+"</td><td>"+t.days+'</td><td><a href="" class="za-icon-button zoia-btn-extend" za-icon="plus"></a></td></tr>'),$("#zoia_history_table>tbody").prepend("<tr><td>"+new Date(1e3*parseInt(t.timestamp,10)).toLocaleString()+'</td><td><span za-icon="'+(t.sum<0?"minus":"plus")+'-circle"></span>&nbsp;'+("left"===u.currencyPosition?u.currency[o]:"")+Math.abs(t.sum)+("right"===u.currencyPosition?"&nbsp;"+u.currency[o]:"")+"</td></tr>");var e=parseFloat($(".zoia-balance").html())-Math.abs(parseFloat(t.sum));$(".zoia-balance").html(e),c=e,$(".zoia-btn-extend").unbind().click(h),$zUI.modal.alert(lang["Your account has been created successfully and is ready to use."],{labels:{ok:lang.OK},stack:!0})}else setTimeout(function(){a(i)},3e3);else n.hide(),$zUI.modal.alert(lang["Unable to create new account"],{labels:{ok:lang.OK},stack:!0})}).fail(function(){n.hide(),$zUI.modal.alert(lang["Unable to create new account"],{labels:{ok:lang.OK},stack:!0})},200)}(t.taskID)):$zUI.modal.alert(lang["Unable to create new account"],{labels:{ok:lang.OK},stack:!0})},onSaveError:function(t){for(var e in $("#zoiaAccountCreateSpinner").hide(),$(".zoiaAccountForm-form-button").show(),t.error?$zUI.modal.alert(t.error,{labels:{ok:lang.OK},stack:!0}):$zUI.modal.alert(lang["Unable to create new account"],{labels:{ok:lang.OK},stack:!0}),t.fields)$("#zoiaAccountForm_"+t.fields[e]).addClass("za-form-danger");t.fields&&t.fields.length&&$("#zoiaAccountForm_"+t.fields[0]).focus()}},save:{url:"/api/customer/account/create",method:"POST"},items:{id:{type:"text",label:lang["Account&nbsp;ID"],css:"za-width-medium",autofocus:!0,validation:{mandatoryCreate:!0,mandatoryEdit:!0,length:{min:1,max:64},regexp:/^[A-Za-z0-9_\-]+$/,process:function(t){return t.trim()}},helpText:lang["Latin characters and numbers only (1-64 chars)"]},preset:{type:"select",label:lang["Plan (price per month)"],css:"za-width-large",autofocus:!1,values:d,validation:{mandatoryCreate:!0}},password:{type:"passwordConfirm",label:lang.Password,helpText:lang["Minimal length: 8 characters, type twice to verify. Required: uppercase and lowercase characters, numbers and special characters"],validation:{mandatoryCreate:!0,mandatoryEdit:!1,length:{min:8,max:50},process:function(t){return t.trim()}}},months:{type:"select",label:lang.Months,css:"za-width-small",autofocus:!1,values:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10",11:"11",12:"12"},validation:{mandatoryCreate:!0}},calc:{type:"text",label:""},buttons:{type:"buttons",css:"za-modal-footer za-text-right",buttons:[{label:lang.Cancel,css:"za-button-default za-modal-close"},{name:"btnSave",label:lang.Create,css:"za-button-primary",type:"submit"}],html:'<div za-spinner style="float:right;display:none" id="zoiaAccountCreateSpinner"></div>'}},lang:t},i={template:{fields:'<div class="za-modal-body">{fields}</div>',buttons:"{buttons}"},formDangerClass:"za-form-danger",html:e,events:{onSaveValidate:function(t){return t.id=r,$("#zoiaAccountExtendSpinner").show(),$(".zoiaAccountExtendForm-form-button").hide(),t},onSaveSuccess:function(t){if($("#zoiaAccountExtendSpinner").hide(),$(".zoiaAccountExtendForm-form-button").show(),t&&1===t.status){s.hide(),$(".zoia-accounts-id").each(function(){$(this).html()===r&&$(this).parent().find("td:eq(2)").html(t.days)}),$("#zoia_history_table>tbody").prepend("<tr><td>"+new Date(1e3*parseInt(t.timestamp,10)).toLocaleString()+'</td><td><span za-icon="minus-circle"></span>&nbsp;'+("left"===u.currencyPosition?u.currency[o]:"")+t.sum+("right"===u.currencyPosition?"&nbsp;"+u.currency[o]:"")+"</td></tr>");var e=parseFloat($(".zoia-balance").html())-Math.abs(parseFloat(t.sum));$(".zoia-balance").html(e),c=e,$zUI.modal.alert(lang["Prolongation was successful"],{labels:{ok:lang.OK},stack:!0})}else $zUI.modal.alert(lang["Unable to prolong account"],{labels:{ok:lang.OK},stack:!0})},onSaveError:function(t){for(var e in $("#zoiaAccountExtendSpinner").hide(),$(".zoiaAccountExtendForm-form-button").show(),t.error?$zUI.modal.alert(t.error,{labels:{ok:lang.OK},stack:!0}):$zUI.modal.alert(lang["Unable to prolong account"],{labels:{ok:lang.OK},stack:!0}),t.fields)$("#zoiaAccountExtendForm_"+t.fields[e]).addClass("za-form-danger");t.fields&&t.fields.length&&$("#zoiaAccountExtendForm_"+t.fields[0]).focus()}},save:{url:"/api/customer/account/extend",method:"POST"},items:{months:{type:"select",label:lang.Months,css:"za-width-small",autofocus:!1,values:{1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10",11:"11",12:"12"},validation:{mandatoryCreate:!0}},calc:{type:"text",label:""},buttons:{type:"buttons",css:"za-modal-footer za-text-right",buttons:[{label:lang.Cancel,css:"za-button-default za-modal-close"},{name:"btnSave",label:lang.Prolong,css:"za-button-primary",type:"submit"}],html:'<div za-spinner style="float:right;display:none" id="zoiaAccountExtendSpinner"></div>'}},lang:t};l=$zUI.modal("#createAccountDialog",{bgClose:!1,escClose:!1}),s=$zUI.modal("#extendAccountDialog",{bgClose:!1,escClose:!1}),n=$zUI.modal("#accountProgressDialog",{bgClose:!1,escClose:!1}),$("#zoia_btn_account_create").click(function(){$("#zoiaAccountForm").zoiaFormBuilder().resetForm(),m(),l.show()}),$("#zoiaAccountForm").zoiaFormBuilder(a),$("#zoiaAccountExtendForm").zoiaFormBuilder(i),$("#zoiaAccountForm_calc").parent().parent().html('<div class="za-alert-warning" za-alert id="zoiaAccountCreateInsufficientFunds" style="margin-bottom:-5px"><p>'+lang["Insufficient funds"]+'</p></div><div class="za-card za-card-default za-card-small za-card-body" style="padding-top:25px;"><p class="za-text-large">'+lang.Total+':&nbsp;<span class="zoia-create-account-total"></span></div>'),$("#zoiaAccountForm_preset").change(m).keypress(m),$("#zoiaAccountForm_months").change(m).keypress(m),$("#zoiaAccountExtendForm_months").change(v).keypress(v),$("#zoiaAccountExtendForm_calc").parent().parent().html('<div class="za-alert-warning" za-alert id="zoiaAccountExtendInsufficientFunds" style="margin-bottom:-5px;display:none"><p>'+lang["Insufficient funds"]+'</p></div><div class="za-card za-card-default za-card-small za-card-body" style="padding-top:25px;"><p class="za-text-large">'+lang.Total+':&nbsp;<span class="zoia-extend-account-total"></span></div>'),p&&$("#zoia_history_table>tbody>tr").each(function(){$(this).find("td:first").html(new Date(1e3*parseInt($(this).find("td:first").html(),10)).toLocaleString())}),$("#zoia_history_table").show(),$(".zoia-btn-extend").unbind().click(h),$("#zoia_form_topup").submit(f),$(".zoia-loading").hide(),$(".zoia-wrap-everything").show()})})}();