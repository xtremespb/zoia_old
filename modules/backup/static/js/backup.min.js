"use strict";!function(){var e=void 0,t=void 0,i=void 0,o=function(a){$("#zoia_btn_backup").hasClass("za-disabled")||($("#zoia_btn_backup").addClass("za-disabled"),$("#zoiaSpinnerMain").show(),$.ajax({type:"POST",url:"/api/backup/create",cache:!1,data:{modules:a}}).done(function(a){$("#zoia_btn_backup").removeClass("za-disabled"),$("#zoiaSpinnerMain").hide(),a&&1===a.status&&a.taskId?($("#dialogBackupWait").show(),$("#dialogBackupDownload").hide(),$("#dialogBackupButtons").hide(),e.show(),setTimeout(function(){!function t(o){$.ajax({type:"GET",url:"/api/backup/create/state",data:{id:o},cache:!1}).done(function(a){if(a&&1===a.status&&a.state)if(3===a.state||0===a.state)switch(a.state){case 0:e.hide(),$zUI.notification(lang["Could not create backup file. Please check logs for details."],{status:"danger",timeout:1500});break;default:$("#dialogBackupWait").hide(),$("#dialogBackupDownload").show(),$("#dialogBackupButtons").show(),$("#dialogBackupDownloadLink").html('<a href="/backup/static/storage/backup_'+o+'.tgz">backup_'+o+".tar.gz</a>")}else setTimeout(function(){t(o)},5e3);else e.hide(),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1500})}).fail(function(){e.hide(),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1500})})}(a.taskId)},1500)):($("#zoia_btn_backup").removeClass("za-disabled"),$("#zoiaSpinnerMain").hide(),$zUI.notification(lang["Could not create backup file"],{status:"danger",timeout:1500}))}).fail(function(){$("#zoia_btn_backup").removeClass("za-disabled"),$("#zoiaSpinnerMain").hide(),$zUI.notification(lang["Could not create backup file"],{status:"danger",timeout:1500})},200))},n=function(){var t=document.getElementById("bimport_progressbar");t.setAttribute("hidden","hidden"),$zUI.upload(".bimport-upload",{url:"/api/backup/restore",multiple:!1,error:function(){$zUI.notification(lang["Could not upload file"],{status:"danger",timeout:1500})},loadStart:function(a){t.removeAttribute("hidden"),$("#dialogRestoreFooter").hide(),t.max=a.total,t.value=a.loaded},progress:function(a){t.max=a.total,t.value=a.loaded},loadEnd:function(a){t.max=a.total,t.value=a.loaded},completeAll:function(){setTimeout(function(){t.setAttribute("hidden","hidden")},1e3);var a={};try{a=JSON.parse(arguments[0].response)}catch(a){}a.taskId?($("#dialogRestoreBody").hide(),$("#dialogRestoreSpinner").show(),setTimeout(function(){!function t(o){$.ajax({type:"GET",url:"/api/backup/restore/state",data:{id:o},cache:!1}).done(function(a){if(a&&1===a.status&&a.state)if(3===a.state||0===a.state)switch(a.state){case 0:$("#dialogRestoreBody").show(),$("#dialogRestoreSpinner").hide(),$("#dialogRestoreFooter").show(),$zUI.notification(lang["Could not restore backup file. Please check logs for details."],{status:"danger",timeout:1500});break;default:$("#dialogRestoreRestart").show(),$("#dialogRestoreSpinner").hide(),setTimeout(function(){$("#dialogRestoreRestart").hide(),$("#dialogRestoreSuccess").show()},3e4)}else setTimeout(function(){t(o)},5e3);else i.hide(),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1500})}).fail(function(){i.hide(),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1500})})}(a.taskId)},1500)):($("#dialogRestoreFooter").show(),$zUI.notification(lang["Could not upload file"],{status:"danger",timeout:1500}))}})};$(document).ready(function(){var a=$("#zp_locale").attr("data");$.getScript("/api/lang/backup/"+a+".js").done(function(){n(),$("#zoia_btn_backup").click(function(){$(".za-backup-module-checkbox").prop("checked",!0),t.show()}),$("#zoia_btn_backup_start").click(function(){var a=[];$(".za-backup-module-checkbox").each(function(){$(this).prop("checked")&&a.push($(this).attr("data"))}),t.hide(),o(a)}),$("#zoia_btn_restore").click(function(){$("#dialogRestoreFooter").show(),$("#dialogRestoreBody").show(),$("#dialogRestoreSpinner").hide(),i.show()}),t=$zUI.modal("#dialogBackupOptions",{bgClose:!1,escClose:!1}),e=$zUI.modal("#dialogBackup",{bgClose:!1,escClose:!1}),i=$zUI.modal("#dialogRestore",{bgClose:!1,escClose:!1}),$(".zoia-admin-loading").hide(),$("#zoia_admin_panel_wrap").show()})})}();