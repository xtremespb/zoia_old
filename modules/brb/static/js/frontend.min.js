"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}!function(u){var i="zoiaTable",a={limit:10,maxPages:7,offline:!1,offlineData:{},html:{spinnerHTML:'<div style="width:40px;height:40px;background-color:#333;-webkit-animation:sk-rotateplane 1.2s infinite ease-in-out;animation: sk-rotateplane 1.2s infinite ease-in-out;margin: auto;position: absolute;top:0;left:0;bottom:0;right:0"></div>',spinnerWrapCSS:"background:#fff;position:absolute;opacity:0.6",headCSS:"@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}100%{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}100%{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}",listWrapStartHTML:'<ul class="za-pagination" za-margin>',listWrapEndHTML:"</ul>",itemPagePrevHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-previous></span></a></li>',itemPageNextHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-next></span></a></li>',itemPageHTML:'<li><a class="zoia-page {elementId}PaginationLink" data-page="{page}">{page}</a></li>',itemPageDotsHTML:'<li class="za-disabled"><span>...</span></li>',arrowDown:"&nbsp;&#x25BC;",arrowUp:"&nbsp;&#x25B2;",errorHTML:'<tr><td colspan="100%">{error}</td></tr>'},lang:{error:"Could not load data from server. Please try to refresh page in a few moments.",noitems:"No items to display"},sort:{},loadOnStart:!0,onLoad:function(){}};function s(t,e){this.element=t,this.settings=u.extend({},a,e),this._defaults=a,this._name=i,this.page=1,this.loading=!1,this.search="",this.currentData={},this.init()}u.extend(s.prototype,{init:function(){var e=this;u("head").append('<style type="text/css">'+this.settings.html.headCSS+"</style>"),u(this.element).before('<div style="'+this.settings.html.spinnerWrapCSS+'" id="'+this.element.id+'LoadingDiv">'+this.settings.html.spinnerHTML+"</div>"),this._loading(!1),this.header=[];for(var t=0;t<u("#"+this.element.id+" > thead > tr").children("th").length;t++){var i=u("#"+this.element.id+" > thead > tr").children("th")[t];if(i.id){this.header.push(i.id);var a=i.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.fields[a]&&this.settings.fields[a].sortable&&(u(i).css("cursor","pointer"),u(i).click(function(t){e._sortColumn(t)}))}}u("."+this.element.id+"SearchInput").keypress(e._debounce(function(t){e._search(t)},250)),u("."+this.element.id+"SearchInputClear").click(function(t){e._searchReset(t)}),this.settings.loadOnStart&&this.load()},_search:function(t){this.loading||(this.search=u(t.target).val().trim(),this.page=1,this.load())},_searchReset:function(){this.loading||(u("."+this.element.id+"SearchInput").val("").focus(),this.search="",this.page=1,this.load())},_sortIndicator:function(t,e){u("#"+this.element.id+"SortingIndicator").remove();for(var i="desc"===e?this.settings.html.arrowDown:this.settings.html.arrowUp,a=0;a<u("#"+this.element.id+" > thead > tr").children("th").length;a++){var s=u("#"+this.element.id+" > thead > tr").children("th")[a];s.id===this.element.id+"_"+t&&u(s).html(u(s).html()+'<span class="zoiaTableSortingIndicator" id="'+this.element.id+'SortingIndicator">'+i+"</span>")}},_sortColumn:function(t){if(t.preventDefault(),t.target.id&&t.target.id!==this.element.id+"SortingIndicator"){var e=t.target.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.sort.field===e?this.settings.sort.direction="asc"===this.settings.sort.direction?"desc":"asc":(this.settings.sort.field=e,this.settings.sort.direction="asc"),this.load()}},_template:function(t,e){for(var i in e)t=t.replace(new RegExp("{"+i+"}","g"),e[i]);return t},_bindSelectButtons:function(){var t=this;u("."+this.element.id+"BtnSelectAll").click(function(){t._selectAll()}),u("."+this.element.id+"BtnSelectNone").click(function(){t._selectNone()})},_selectAll:function(){this.loading||u("."+this.element.id+"Checkbox").prop("checked",!0)},_selectNone:function(){this.loading||u("."+this.element.id+"Checkbox").prop("checked",!1)},_pagination:function(){var e=this,t=this.settings.maxPages,i=Math.ceil(this.total/this.settings.limit);if(i<2)u("."+this.element.id+"Pagination").html("");else{var a=this.settings.html.listWrapStartHTML;if(t<i){1<this.page&&(a+=this._template(this.settings.html.itemPagePrevHTML,{elementId:this.element.id,page:this.page-1})),3<this.page&&(a+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:1}));var s=this.page-2;s<1&&(s=1),1<s-1&&(a+=this.settings.html.itemPageDotsHTML);var n=this.page+2;i<n&&(n=i);for(var r=s;r<=n;r++)a+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:r});n<i-1&&(a+=this.settings.html.itemPageDotsHTML),this.page<=i-3&&(a+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:i})),this.page<i&&(a+=this._template(this.settings.html.itemPageNextHTML,{elementId:this.element.id,page:this.page+1}))}else for(var o=1;o<=i;o++)a+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:o});a+=this.settings.html.listWrapEndHTML,u("."+this.element.id+"Pagination").html(a),u("."+this.element.id+"PaginationLink").click(function(){var t=parseInt(u(this).data("page"),10);e.loading||e.page===t||(e.page=t,e.load())})}},_loading:function(t){var e="#"+this.element.id+"LoadingDiv";u(e).css({top:u(this.element).top,left:u(this.element).left,width:u(this.element).outerWidth(!0),height:u(this.element).outerHeight(!0)}),t?this.loadingInt=setTimeout(function(){u(e).show()},300):(clearTimeout(this.loadingInt),u(e).hide())},_debounce:function(i,a){var s=null;return function(){var t=this,e=arguments;clearTimeout(s),s=setTimeout(function(){i.apply(t,e)},a)}},getCurrentData:function(){return this.currentData},load:function(){var i=this;if(this.settings.offline){var t="";this.pages=parseInt(this.settings.offlineData.length/this.settings.limit,10),0<this.settings.offlineData.length%this.settings.limit&&this.pages++,this.settings.offlineData.sort(function(t,e){return t[i.settings.sort.field]>e[i.settings.sort.field]?"asc"===i.settings.sort.direction?-1:1:e[i.settings.sort.field]>t[i.settings.sort.field]?"asc"===i.settings.sort.direction?1:-1:0});var e=[],a=this.page*this.settings.limit-this.settings.limit,s=a+this.settings.limit;s>this.settings.offlineData.length&&(s=this.settings.offlineData.length);for(var n=a;n<s;n++)this.settings.offlineData[n]&&e.push(this.settings.offlineData[n]);for(var r in this.total=this.settings.offlineData.length,this._pagination(),this.currentData={},e){var o=e[r];for(var l in this.currentData[o._id||o.id]=o,t+="<tr>",this.header)if(this.header[l]===this.element.id+"ID")t+='<td><input type="checkbox" id="'+(o._id||o.id)+'" class="za-checkbox '+this.element.id+'Checkbox"></td>';else{var h=!1,c=this.header[l].replace(new RegExp("^"+this.element.id+"_"),"");for(var d in o)d===c&&this.settings.fields[d]&&(o[d]&&"string"==typeof o[d]&&(o[d]=o[d].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),t+="<td>"+this.settings.fields[d].process(d,o,o[d])+"</td>",h=!0);h||(this.settings.fields[c]&&this.settings.fields[c].process?t+="<td>"+this.settings.fields[c].process(c,o)+"</td>":t+="<td></td>")}t+="</tr>"}u(this.element).find("tbody").html(t.length?t:this._template(this.settings.html.errorHTML,{error:this.settings.lang.noitems})),this._loading(!1),u('*[data-page="'+this.page+'"]').parent().addClass("za-active"),this._bindSelectButtons(),this.settings.sort.field&&this._sortIndicator(this.settings.sort.field,this.settings.sort.direction),u(this.element).find("thead").show(),this.settings.onLoad()}else{if(!this.settings.url||this.loading)return;var p=this,g="";this._loading(!0),this.loading=!0,u.ajax({type:"GET",url:this.settings.url,data:{limit:this.settings.limit,skip:this.page*this.settings.limit-this.settings.limit,sortField:this.settings.sort.field,sortDirection:this.settings.sort.direction,search:this.search},cache:!1}).done(function(t){if(p.loading=!1,t){for(var e in p.pages=parseInt(t.total/p.settings.limit,10),0<t.total%p.settings.limit&&p.pages++,p.total=t.total,p._pagination(),p.currentData={},t.items){var i=t.items[e];for(var a in p.currentData[i._id]=i,g+="<tr>",p.header)if(p.header[a]===p.element.id+"ID")g+='<td><input type="checkbox" id="'+i._id+'" class="za-checkbox '+p.element.id+'Checkbox"></td>';else{var s=!1,n=p.header[a].replace(new RegExp("^"+p.element.id+"_"),"");for(var r in i)r===n&&p.settings.fields[r]&&(i[r]&&"string"==typeof i[r]&&(i[r]=i[r].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),g+="<td>"+p.settings.fields[r].process(r,i,i[r])+"</td>",s=!0);s||(p.settings.fields[n]&&p.settings.fields[n].process?g+="<td>"+p.settings.fields[n].process(n,i)+"</td>":g+="<td></td>")}g+="</tr>"}u(p.element).find("tbody").html(g.length?g:p._template(p.settings.html.errorHTML,{error:p.settings.lang.noitems})),p._loading(!1),u('*[data-page="'+p.page+'"]').parent().addClass("za-active"),p._bindSelectButtons(),p.settings.sort.field&&p._sortIndicator(p.settings.sort.field,p.settings.sort.direction),u(p.element).find("thead").show(),p.settings.onLoad()}else p.loading=!1,p._loading(!1),u(p.element).find("tbody").html(p._template(p.settings.html.errorHTML,{error:p.settings.lang.error}))}).fail(function(){p.loading=!1,p._loading(!1),u(p.element).find("tbody").html(p._template(p.settings.html.errorHTML,{error:p.settings.lang.error}))})}}}),u.fn[i]=function(t){var e=void 0;return this.each(function(){(e=u.data(this,"plugin_"+i))||(e=new s(this,t),u.data(this,"plugin_"+i,e))}),e}}(jQuery,window,document),function(){var t=void 0,e=void 0,i=void 0,s=void 0,a=void 0,x=void 0,w=void 0,C=void 0,y=void 0,n=void 0,r=function(t){a=t||a,$(".zoia-wrap-info").hide(),$(".zoia-wrap-ticker").show(),$(".zoia-ticker-name").html(a.ticker),$(".zoia-ticker-full-name").html(a.full_name),$(".zoia-ticker-price").html("$"+a.price),$(".zoia-ticker-position").html((a.position_value<0?lang.Short:lang.Long)+" "+a.position_value)};$(document).ready(function(){t=$("#zp_locale").attr("data"),e=$("#zp_uprefix").attr("data"),i=JSON.parse($("#zp_tickers").attr("data")),s=JSON.parse($("#zp_apiInfo").attr("data")),n=$zUI.modal("#chartSettingsModal",{bgClose:!0,escClose:!0}),$("#chartSettingsButton").click(function(){$("#chartSettingsSpinner").hide(),$(".chart-settings-button").show(),$("#chartColorLine").val(C.graphs[1].lineColor),$("#chartColorPositive").val(C.graphs[0].lineColor),$("#chartColorNegative").val(C.graphs[0].negativeLineColor),$(".zoia-chart-checkbox-line").prop("checked",!C.graphs[1].hidden),$(".zoia-chart-checkbox-candles").prop("checked",!C.graphs[0].hidden),$(".zoia-chart-checkbox-line").data("prev-checked",$(".zoia-chart-checkbox-line").is(":checked")),$(".zoia-chart-checkbox-candles").data("prev-checked",$(".zoia-chart-checkbox-candles").is(":checked")),n.show()}),$("#chartSettingsSaveButton").click(function(){$("#chartSettingsSpinner").show(),$(".chart-settings-button").hide();var t=void 0;C.graphs[0].fillColors!==$("#chartColorPositive").val()&&(t=!0,C.graphs[0].fillColors=$("#chartColorPositive").val(),C.graphs[0].lineColor=$("#chartColorPositive").val()),C.graphs[0].negativeFillColors!==$("#chartColorNegative").val()&&(t=!0,C.graphs[0].negativeFillColors=$("#chartColorNegative").val(),C.graphs[0].negativeLineColor=$("#chartColorNegative").val()),C.graphs[1].lineColor!==$("#chartColorLine").val()&&(t=!0,C.graphs[1].lineColor=$("#chartColorLine").val());var e=$(".zoia-chart-checkbox-line").is(":checked")!==$(".zoia-chart-checkbox-line").data("prev-checked")||$(".zoia-chart-checkbox-candles").is(":checked")!==$(".zoia-chart-checkbox-candles").data("prev-checked");setTimeout(function(){$("#chartSettingsSpinner").hide(),$(".chart-settings-button").show(),n.hide()},e?1e3:0),setTimeout(function(){e&&($(".zoia-chart-checkbox-line").is(":checked")?!C.graphs[1].hidden||C.showGraph(C.graphs[1]):C.graphs[1].hidden||C.hideGraph(C.graphs[1]),$(".zoia-chart-checkbox-candles").is(":checked")?!C.graphs[0].hidden||C.showGraph(C.graphs[0]):C.graphs[0].hidden||C.hideGraph(C.graphs[0])),t&&C.validateNow()},e?500:0)}),$(".chart-button-period").click(function(t){switch($(".chart-button-period").removeClass("za-button-secondary"),$(this).addClass("za-button-secondary"),$(this).attr("id")){case"chartEverythingButton":if("chartEverythingButton"===y)return;y="chartEverythingButton",x=[].concat(_toConsumableArray(w)),C.dataProvider=x,$(".chart-button").hide(),$("#chartTickersSpinner").show(),setTimeout(function(){C.validateData(),$(".chart-button").show(),$("#chartTickersSpinner").hide()},500);break;case"chartMonthButton":if("chartMonthButton"===y)return;y="chartMonthButton";for(var e=[].concat(_toConsumableArray(w)),i=[];0<e.length;){for(var a=void 0,s=1e18,n=0,r=0;r<e.length;r++){if(moment(e[0].date).format("MM")!==moment(e[r].date).format("MM")){a=r;break}e[r].high>n&&(n=e[r].high),e[r].low<s&&(s=e[r].low)}a=(0<a?a-1:null)||e.length-1;for(var o=e[0].open,l=e[a].close,h=e[a].date||e[0].date,c=0;c<a+1;c++)e.shift();i.push({value:l,open:o,close:l,high:n,low:s,date:h})}x=i,C.dataProvider=x,$(".chart-button").hide(),$("#chartTickersSpinner").show(),setTimeout(function(){C.validateData(),$(".chart-button").show(),$("#chartTickersSpinner").hide()},500);break;case"chartWeekButton":if("chartWeekButton"===y)return;y="chartWeekButton";for(var d=[].concat(_toConsumableArray(w)),p=[];0<d.length;){for(var g=1e18,u=0,f=7<=d.length?6:d.length-1,m=0;m<f+1;m++)d[m].high>u&&(u=d[m].high),d[m].low<g&&(g=d[m].low);for(var v=d[0].open,b=d[f].close,k=d[f].date||d[0].date,_=0;_<f+1;_++)d.shift();p.push({value:b,open:v,close:b,high:u,low:g,date:k})}x=p,C.dataProvider=x,$(".chart-button").hide(),$("#chartTickersSpinner").show(),setTimeout(function(){C.validateData(),$(".chart-button").show(),$("#chartTickersSpinner").hide()},500)}}),$("#tickers>thead>tr>th").each(function(){$(this).html($(this).html().replace(/\s/gm,"&nbsp;"))}),a=window.localStorage.getItem("currentTicker")?JSON.parse(window.localStorage.getItem("currentTicker")):{},$(window).bind("popstate",function(t){!function(t){switch((t=t||{}).action){case"ticker":r(a);break;default:$(".zoia-wrap-ticker").hide(),$(".zoia-wrap-info").show()}}(t.originalEvent.state)}),$.getScript("/api/lang/brb/"+t+".js").done(function(){$(".zoia-loading").hide(),$(".zoia-wrap-info").show(),$("#tickers").zoiaTable({offline:!0,offlineData:i,limit:1e3,sort:{field:"ticker",direction:"desc"},fields:{ticker:{sortable:!0,process:function(t,e,i){return'<a za-tooltip="title: '+e.full_name+';pos:top-left" href="" class="zoia-ticker-link" data=\''+JSON.stringify(e)+"'>"+i+"</a>"}},position_date:{sortable:!0,process:function(t,e,i){return i}},position_time:{sortable:!0,process:function(t,e,i){return i}},price:{sortable:!0,process:function(t,e,i){return"$"+i}},position_value:{sortable:!0,process:function(t,e,i){return i}},position:{sortable:!1,process:function(t,e,i){return e.position_value<0?lang.Short:lang.Long}},average_price:{sortable:!0,process:function(t,e,i){return"$"+parseFloat(i).toFixed(2)}},market_price:{sortable:!0,process:function(t,e,i){return(parseFloat(i)<0?"-$":"$")+Math.abs(parseFloat(i).toFixed(2))}},unrealized:{sortable:!0,process:function(t,e,i){return(parseFloat(i)<0?"-$":"$")+Math.abs(parseFloat(i).toFixed(2))}},position_prc:{sortable:!1,process:function(t,e,i){var a=parseFloat(e.market_price/s.portfolio_cost*100).toFixed(2);return(parseFloat(a)<0?"-$":"$")+Math.abs(a)}},tp:{sortable:!0,process:function(t,e,i){return(parseFloat(i)<0?"-$":"$")+Math.abs(parseFloat(i).toFixed(2))}},sl:{sortable:!0,process:function(t,e,i){return(parseFloat(i)<0?"-$":"$")+Math.abs(parseFloat(i).toFixed(2))}},potpro:{sortable:!1,process:function(t,e,i){var a=parseFloat((e.tp-e.average_price)*e.position_value).toFixed(2);return"$"+Math.abs(a)}},potlos:{sortable:!1,process:function(t,e,i){var a=parseFloat((e.sl-e.average_price)*e.position_value).toFixed(2);return"$"+Math.abs(a)}},protolos:{sortable:!1,process:function(t,e,i){var a=(e.tp-e.average_price)*e.position_value,s=(e.sl-e.average_price)*e.position_value;return parseFloat(Math.abs(a/s)).toFixed(2)}}},lang:{error:lang["Could not load data from server. Please try to refresh page in a few moments."],noitems:lang["No items to display"]}}),$(".zoia-ticker-link").click(function(t){t.preventDefault(),window.history.pushState({action:"ticker"},document.title,e+"/brb"),window.localStorage.setItem("currentTicker",$(this).attr("data")),r(JSON.parse($(this).attr("data")))}),$.ajax({type:"GET",url:"/api/brb/getChartData",cache:!1}).done(function(t){if(t&&1===t.status){x=t.chartData,w=x.slice(0),x.map(function(t,e){return t.value=t.close||0,t});for(var e=1;e<11;e++)x.push({date:moment().add(e,"days").format("YYYY-MM-DD")});C=AmCharts.makeChart("chartTickers",{type:"serial",theme:"light",dataDateFormat:"YYYY-MM-DD",valueAxes:[{position:"left"}],marginRight:70,graphs:[{id:"g1",balloonText:lang.Open+": <b>$[[open]]</b><br>"+lang.Low+": <b>$[[low]]</b><br>"+lang.High+": <b>$[[high]]</b><br>"+lang.Close+": <b>$[[close]]</b><br>[[dynText]]",closeField:"close",fillColors:"#50ba27",highField:"high",lineColor:"#50ba27",lineAlpha:1,lowField:"low",fillAlphas:.9,negativeFillColors:"#db4c3c",negativeLineColor:"#db4c3c",openField:"open",title:"Price:",type:"candlestick",valueField:"close"},{id:"g2",balloon:{drop:!1,adjustBorderColor:!1,color:"#fff"},bullet:"round",bulletBorderAlpha:1,bulletColor:"#FFFFFF",lineColor:"#444444",lineAlpha:.5,bulletSize:5,hideBulletsCount:50,lineThickness:2,title:"red line",useLineColorForBulletBorder:!0,valueField:"value",balloonText:"<span>$[[value]]</span>"}],chartScrollbar:{graph:"g2",graphType:"line",scrollbarHeight:30},chartCursor:{valueLineEnabled:!0,valueLineBalloonEnabled:!0},categoryField:"date",categoryAxis:{parseDates:!0},dataProvider:x,listeners:[{event:"zoomed",method:function(s){$(".chart-button").show(),$("#chartTickersSpinner").hide(),x.map(function(t,e){t.value=t.close||null,t.dyn1=t.close?t.close-x[0<e?e-1:e].close:0;var i=t.dyn1/t.open*100;t.dyn2=t.close&&x[s.startIndex].close?t.close-x[s.startIndex].close:0;var a=t.dyn2/t.open*100;return t.dynText='<span class="za-text-bold '+(0<=t.dyn1?"za-text-success":"za-text-danger")+'">'+(0<t.dyn1?"+":0===t.dyn1?"":"-")+"$"+parseFloat(Math.abs(t.dyn1)).toFixed(2)+"</span><br>"+lang["From previous"]+': <span class="'+(0<=i?"za-text-success":"za-text-danger")+'">'+(0<i?"+":0===i?"":"-")+parseFloat(Math.abs(i)).toFixed(2)+"%</span><br>"+lang.Since+" "+x[s.startIndex].date+' <span class="'+(0<=a?"za-text-success":"za-text-danger")+'">'+(0<a?"+":0===a?"":"-")+parseFloat(Math.abs(a)).toFixed(2)+"%</span>",t})}}]})}else $("#chartTickers").html(lang["Could not fetch information from API."]+" (code 1)")}).fail(function(){$("#chartTickers").html(lang["Could not fetch information from API."]+" (code 2)")})})})}();