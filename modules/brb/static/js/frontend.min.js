"use strict";!function(f){var i="zoiaTable",s={limit:10,maxPages:7,offline:!1,offlineData:{},html:{spinnerHTML:'<div style="width:40px;height:40px;background-color:#333;-webkit-animation:sk-rotateplane 1.2s infinite ease-in-out;animation: sk-rotateplane 1.2s infinite ease-in-out;margin: auto;position: absolute;top:0;left:0;bottom:0;right:0"></div>',spinnerWrapCSS:"background:#fff;position:absolute;opacity:0.6",headCSS:"@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}100%{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}100%{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}",listWrapStartHTML:'<ul class="za-pagination" za-margin>',listWrapEndHTML:"</ul>",itemPagePrevHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-previous></span></a></li>',itemPageNextHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-next></span></a></li>',itemPageHTML:'<li><a class="zoia-page {elementId}PaginationLink" data-page="{page}">{page}</a></li>',itemPageDotsHTML:'<li class="za-disabled"><span>...</span></li>',arrowDown:"&nbsp;&#x25BC;",arrowUp:"&nbsp;&#x25B2;",errorHTML:'<tr><td colspan="100%">{error}</td></tr>'},lang:{error:"Could not load data from server. Please try to refresh page in a few moments.",noitems:"No items to display"},sort:{},loadOnStart:!0,onLoad:function(){}};function a(t,e){this.element=t,this.settings=f.extend({},s,e),this._defaults=s,this._name=i,this.page=1,this.loading=!1,this.search="",this.currentData={},this.init()}f.extend(a.prototype,{init:function(){var e=this;f("head").append('<style type="text/css">'+this.settings.html.headCSS+"</style>"),f(this.element).before('<div style="'+this.settings.html.spinnerWrapCSS+'" id="'+this.element.id+'LoadingDiv">'+this.settings.html.spinnerHTML+"</div>"),this._loading(!1),this.header=[];for(var t=0;t<f("#"+this.element.id+" > thead > tr").children("th").length;t++){var i=f("#"+this.element.id+" > thead > tr").children("th")[t];if(i.id){this.header.push(i.id);var s=i.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.fields[s]&&this.settings.fields[s].sortable&&(f(i).css("cursor","pointer"),f(i).click(function(t){e._sortColumn(t)}))}}f("."+this.element.id+"SearchInput").keypress(e._debounce(function(t){e._search(t)},250)),f("."+this.element.id+"SearchInputClear").click(function(t){e._searchReset(t)}),this.settings.loadOnStart&&this.load()},_search:function(t){this.loading||(this.search=f(t.target).val().trim(),this.page=1,this.load())},_searchReset:function(){this.loading||(f("."+this.element.id+"SearchInput").val("").focus(),this.search="",this.page=1,this.load())},_sortIndicator:function(t,e){f("#"+this.element.id+"SortingIndicator").remove();for(var i="desc"===e?this.settings.html.arrowDown:this.settings.html.arrowUp,s=0;s<f("#"+this.element.id+" > thead > tr").children("th").length;s++){var a=f("#"+this.element.id+" > thead > tr").children("th")[s];a.id===this.element.id+"_"+t&&f(a).html(f(a).html()+'<span class="zoiaTableSortingIndicator" id="'+this.element.id+'SortingIndicator">'+i+"</span>")}},_sortColumn:function(t){if(t.preventDefault(),t.target.id&&t.target.id!==this.element.id+"SortingIndicator"){var e=t.target.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.sort.field===e?this.settings.sort.direction="asc"===this.settings.sort.direction?"desc":"asc":(this.settings.sort.field=e,this.settings.sort.direction="asc"),this.load()}},_template:function(t,e){for(var i in e)t=t.replace(new RegExp("{"+i+"}","g"),e[i]);return t},_bindSelectButtons:function(){var t=this;f("."+this.element.id+"BtnSelectAll").click(function(){t._selectAll()}),f("."+this.element.id+"BtnSelectNone").click(function(){t._selectNone()})},_selectAll:function(){this.loading||f("."+this.element.id+"Checkbox").prop("checked",!0)},_selectNone:function(){this.loading||f("."+this.element.id+"Checkbox").prop("checked",!1)},_pagination:function(){var e=this,t=this.settings.maxPages,i=Math.ceil(this.total/this.settings.limit);if(i<2)f("."+this.element.id+"Pagination").html("");else{var s=this.settings.html.listWrapStartHTML;if(t<i){1<this.page&&(s+=this._template(this.settings.html.itemPagePrevHTML,{elementId:this.element.id,page:this.page-1})),3<this.page&&(s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:1}));var a=this.page-2;a<1&&(a=1),1<a-1&&(s+=this.settings.html.itemPageDotsHTML);var n=this.page+2;i<n&&(n=i);for(var r=a;r<=n;r++)s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:r});n<i-1&&(s+=this.settings.html.itemPageDotsHTML),this.page<=i-3&&(s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:i})),this.page<i&&(s+=this._template(this.settings.html.itemPageNextHTML,{elementId:this.element.id,page:this.page+1}))}else for(var o=1;o<=i;o++)s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:o});s+=this.settings.html.listWrapEndHTML,f("."+this.element.id+"Pagination").html(s),f("."+this.element.id+"PaginationLink").click(function(){var t=parseInt(f(this).data("page"),10);e.loading||e.page===t||(e.page=t,e.load())})}},_loading:function(t){var e="#"+this.element.id+"LoadingDiv";f(e).css({top:f(this.element).top,left:f(this.element).left,width:f(this.element).outerWidth(!0),height:f(this.element).outerHeight(!0)}),t?this.loadingInt=setTimeout(function(){f(e).show()},300):(clearTimeout(this.loadingInt),f(e).hide())},_debounce:function(i,s){var a=null;return function(){var t=this,e=arguments;clearTimeout(a),a=setTimeout(function(){i.apply(t,e)},s)}},getCurrentData:function(){return this.currentData},load:function(){var i=this;if(this.settings.offline){var t="";this.pages=parseInt(this.settings.offlineData.length/this.settings.limit,10),0<this.settings.offlineData.length%this.settings.limit&&this.pages++,this.settings.offlineData.sort(function(t,e){return t[i.settings.sort.field]>e[i.settings.sort.field]?"asc"===i.settings.sort.direction?-1:1:e[i.settings.sort.field]>t[i.settings.sort.field]?"asc"===i.settings.sort.direction?1:-1:0});var e=[],s=this.page*this.settings.limit-this.settings.limit,a=s+this.settings.limit;a>this.settings.offlineData.length&&(a=this.settings.offlineData.length);for(var n=s;n<a;n++)this.settings.offlineData[n]&&e.push(this.settings.offlineData[n]);for(var r in this.total=this.settings.offlineData.length,this._pagination(),this.currentData={},e){var o=e[r];for(var l in this.currentData[o._id||o.id]=o,t+="<tr>",this.header)if(this.header[l]===this.element.id+"ID")t+='<td><input type="checkbox" id="'+(o._id||o.id)+'" class="za-checkbox '+this.element.id+'Checkbox"></td>';else{var h=!1,d=this.header[l].replace(new RegExp("^"+this.element.id+"_"),"");for(var p in o)p===d&&this.settings.fields[p]&&(o[p]&&"string"==typeof o[p]&&(o[p]=o[p].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),t+="<td>"+this.settings.fields[p].process(p,o,o[p])+"</td>",h=!0);h||(this.settings.fields[d]&&this.settings.fields[d].process?t+="<td>"+this.settings.fields[d].process(d,o)+"</td>":t+="<td></td>")}t+="</tr>"}f(this.element).find("tbody").html(t.length?t:this._template(this.settings.html.errorHTML,{error:this.settings.lang.noitems})),this._loading(!1),f('*[data-page="'+this.page+'"]').parent().addClass("za-active"),this._bindSelectButtons(),this.settings.sort.field&&this._sortIndicator(this.settings.sort.field,this.settings.sort.direction),f(this.element).find("thead").show(),this.settings.onLoad()}else{if(!this.settings.url||this.loading)return;var c=this,g="";this._loading(!0),this.loading=!0,f.ajax({type:"GET",url:this.settings.url,data:{limit:this.settings.limit,skip:this.page*this.settings.limit-this.settings.limit,sortField:this.settings.sort.field,sortDirection:this.settings.sort.direction,search:this.search},cache:!1}).done(function(t){if(c.loading=!1,t){for(var e in c.pages=parseInt(t.total/c.settings.limit,10),0<t.total%c.settings.limit&&c.pages++,c.total=t.total,c._pagination(),c.currentData={},t.items){var i=t.items[e];for(var s in c.currentData[i._id]=i,g+="<tr>",c.header)if(c.header[s]===c.element.id+"ID")g+='<td><input type="checkbox" id="'+i._id+'" class="za-checkbox '+c.element.id+'Checkbox"></td>';else{var a=!1,n=c.header[s].replace(new RegExp("^"+c.element.id+"_"),"");for(var r in i)r===n&&c.settings.fields[r]&&(i[r]&&"string"==typeof i[r]&&(i[r]=i[r].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),g+="<td>"+c.settings.fields[r].process(r,i,i[r])+"</td>",a=!0);a||(c.settings.fields[n]&&c.settings.fields[n].process?g+="<td>"+c.settings.fields[n].process(n,i)+"</td>":g+="<td></td>")}g+="</tr>"}f(c.element).find("tbody").html(g.length?g:c._template(c.settings.html.errorHTML,{error:c.settings.lang.noitems})),c._loading(!1),f('*[data-page="'+c.page+'"]').parent().addClass("za-active"),c._bindSelectButtons(),c.settings.sort.field&&c._sortIndicator(c.settings.sort.field,c.settings.sort.direction),f(c.element).find("thead").show(),c.settings.onLoad()}else c.loading=!1,c._loading(!1),f(c.element).find("tbody").html(c._template(c.settings.html.errorHTML,{error:c.settings.lang.error}))}).fail(function(){c.loading=!1,c._loading(!1),f(c.element).find("tbody").html(c._template(c.settings.html.errorHTML,{error:c.settings.lang.error}))})}}}),f.fn[i]=function(t){var e=void 0;return this.each(function(){(e=f.data(this,"plugin_"+i))||(e=new a(this,t),f.data(this,"plugin_"+i,e))}),e}}(jQuery,window,document),function(){var t=void 0,e=void 0,i=void 0,a=void 0,s=void 0,n=function(t){s=t||s,$(".zoia-wrap-info").hide(),$(".zoia-wrap-ticker").show(),$(".zoia-ticker-name").html(s.ticker),$(".zoia-ticker-full-name").html(s.full_name),$(".zoia-ticker-price").html("$"+s.price),$(".zoia-ticker-position").html((s.position_value<0?lang.Short:lang.Long)+" "+s.position_value)};$(document).ready(function(){t=$("#zp_locale").attr("data"),e=$("#zp_uprefix").attr("data"),i=JSON.parse($("#zp_tickers").attr("data")),a=JSON.parse($("#zp_apiInfo").attr("data")),$("#tickers>thead>tr>th").each(function(){$(this).html($(this).html().replace(/\s/gm,"&nbsp;"))}),s=window.localStorage.getItem("currentTicker")?JSON.parse(window.localStorage.getItem("currentTicker")):{},$(window).bind("popstate",function(t){!function(t){switch((t=t||{}).action){case"ticker":n(s);break;default:$(".zoia-wrap-ticker").hide(),$(".zoia-wrap-info").show()}}(t.originalEvent.state)}),$.getScript("/api/lang/brb/"+t+".js").done(function(){$(".zoia-loading").hide(),$(".zoia-wrap-info").show(),$("#tickers").zoiaTable({offline:!0,offlineData:i,limit:1e3,sort:{field:"ticker",direction:"desc"},fields:{ticker:{sortable:!0,process:function(t,e,i){return'<a za-tooltip="title: '+e.full_name+';pos:top-left" href="" class="zoia-ticker-link" data=\''+JSON.stringify(e)+"'>"+i+"</a>"}},position_date:{sortable:!0,process:function(t,e,i){return i}},position_time:{sortable:!0,process:function(t,e,i){return i}},price:{sortable:!0,process:function(t,e,i){return"$"+i}},position_value:{sortable:!0,process:function(t,e,i){return i}},position:{sortable:!1,process:function(t,e,i){return e.position_value<0?lang.Short:lang.Long}},average_price:{sortable:!0,process:function(t,e,i){return"$"+parseFloat(i).toFixed(2)}},market_price:{sortable:!0,process:function(t,e,i){return(parseFloat(i)<0?"-$":"$")+Math.abs(parseFloat(i).toFixed(2))}},unrealized:{sortable:!0,process:function(t,e,i){return(parseFloat(i)<0?"-$":"$")+Math.abs(parseFloat(i).toFixed(2))}},position_prc:{sortable:!1,process:function(t,e,i){var s=parseFloat(e.market_price/a.portfolio_cost*100).toFixed(2);return(parseFloat(s)<0?"-$":"$")+Math.abs(s)}},tp:{sortable:!0,process:function(t,e,i){return(parseFloat(i)<0?"-$":"$")+Math.abs(parseFloat(i).toFixed(2))}},sl:{sortable:!0,process:function(t,e,i){return(parseFloat(i)<0?"-$":"$")+Math.abs(parseFloat(i).toFixed(2))}},potpro:{sortable:!1,process:function(t,e,i){var s=parseFloat((e.tp-e.average_price)*e.position_value).toFixed(2);return"$"+Math.abs(s)}},potlos:{sortable:!1,process:function(t,e,i){var s=parseFloat((e.sl-e.average_price)*e.position_value).toFixed(2);return"$"+Math.abs(s)}},protolos:{sortable:!1,process:function(t,e,i){var s=(e.tp-e.average_price)*e.position_value,a=(e.sl-e.average_price)*e.position_value;return parseFloat(Math.abs(s/a)).toFixed(2)}}},lang:{error:lang["Could not load data from server. Please try to refresh page in a few moments."],noitems:lang["No items to display"]}}),$(".zoia-ticker-link").click(function(t){t.preventDefault(),window.history.pushState({action:"ticker"},document.title,e+"/brb"),window.localStorage.setItem("currentTicker",$(this).attr("data")),n(JSON.parse($(this).attr("data")))}),$.ajax({type:"GET",url:"/api/brb/getChartData",cache:!1}).done(function(t){if(t&&1===t.status)AmCharts.makeChart("chartTickers",{type:"serial",theme:"light",marginRight:0,marginLeft:0,autoMarginOffset:20,mouseWheelZoomEnabled:!0,dataDateFormat:"YYYY-MM-DD hh:mm",valueAxes:[{id:"v1",axisAlpha:0,position:"left",ignoreAxisWidth:!0}],balloon:{borderThickness:1,shadowAlpha:0},graphs:[{id:"g1",balloon:{drop:!0,adjustBorderColor:!1,color:"#ffffff"},bullet:"round",bulletBorderAlpha:1,bulletColor:"#FFFFFF",bulletSize:5,hideBulletsCount:50,lineThickness:2,title:"red line",useLineColorForBulletBorder:!0,valueField:"value",balloonText:"<span style='font-size:18px;'>[[value]]</span>"}],chartScrollbar:{graph:"g1",oppositeAxis:!1,offset:30,scrollbarHeight:80,backgroundAlpha:0,selectedBackgroundAlpha:.1,selectedBackgroundColor:"#888888",graphFillAlpha:0,graphLineAlpha:.5,selectedGraphFillAlpha:0,selectedGraphLineAlpha:1,autoGridCount:!0,color:"#AAAAAA"},chartCursor:{pan:!0,valueLineEnabled:!0,valueLineBalloonEnabled:!0,cursorAlpha:1,cursorColor:"#258cbb",limitToGraph:"g1",valueLineAlpha:.2,valueZoomable:!0},valueScrollbar:{oppositeAxis:!1,offset:50,scrollbarHeight:10},categoryField:"date",categoryAxis:{parseDates:!0,dashLength:1,minorGridEnabled:!0},export:{enabled:!0},dataProvider:t.chartData.map(function(t){return{date:moment.unix(t.time_snap).format("YYYY-MM-DD hh:mm"),value:t.portfolio_cost}})});else $("#chartTickers").html(lang["Could not fetch information from API."])}).fail(function(){$("#chartTickers").html(lang["Could not fetch information from API."])})})})}();