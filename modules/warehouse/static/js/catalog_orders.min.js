"use strict";!function(l){var a="zoiaTable",i={limit:10,maxPages:7,html:{spinnerHTML:'<div style="width:40px;height:40px;background-color:#333;-webkit-animation:sk-rotateplane 1.2s infinite ease-in-out;animation: sk-rotateplane 1.2s infinite ease-in-out;margin: auto;position: absolute;top:0;left:0;bottom:0;right:0"></div>',spinnerWrapCSS:"background:#fff;position:absolute;opacity:0.6",headCSS:"@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}100%{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}100%{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}",listWrapStartHTML:'<ul class="za-pagination" za-margin>',listWrapEndHTML:"</ul>",itemPagePrevHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-previous></span></a></li>',itemPageNextHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-next></span></a></li>',itemPageHTML:'<li><a class="zoia-page {elementId}PaginationLink" data-page="{page}">{page}</a></li>',itemPageDotsHTML:'<li class="za-disabled"><span>...</span></li>',arrowDown:"&nbsp;&#x25BC;",arrowUp:"&nbsp;&#x25B2;",errorHTML:'<tr><td colspan="100%">{error}</td></tr>'},lang:{error:"Could not load data from server. Please try to refresh page in a few moments.",noitems:"No items to display"},sort:{},loadOnStart:!0,onLoad:function(){}};function s(t,e){this.element=t,this.settings=l.extend({},i,e),this._defaults=i,this._name=a,this.page=1,this.loading=!1,this.search="",this.currentData={},this.init()}l.extend(s.prototype,{init:function(){var e=this;l("head").append('<style type="text/css">'+this.settings.html.headCSS+"</style>"),l(this.element).before('<div style="'+this.settings.html.spinnerWrapCSS+'" id="'+this.element.id+'LoadingDiv">'+this.settings.html.spinnerHTML+"</div>"),this._loading(!1),this.header=[];for(var t=0;t<l("#"+this.element.id+" > thead > tr").children("th").length;t++){var a=l("#"+this.element.id+" > thead > tr").children("th")[t];if(a.id){this.header.push(a.id);var i=a.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.fields[i]&&this.settings.fields[i].sortable&&(l(a).css("cursor","pointer"),l(a).click(function(t){e._sortColumn(t)}))}}l("."+this.element.id+"SearchInput").keypress(e._debounce(function(t){e._search(t)},250)),l("."+this.element.id+"SearchInputClear").click(function(t){e._searchReset(t)}),this.settings.loadOnStart&&this.load()},_search:function(t){this.loading||(this.search=l(t.target).val().trim(),this.page=1,this.load())},_searchReset:function(){this.loading||(l("."+this.element.id+"SearchInput").val("").focus(),this.search="",this.page=1,this.load())},_sortIndicator:function(t,e){l("#"+this.element.id+"SortingIndicator").remove();for(var a="desc"===e?this.settings.html.arrowDown:this.settings.html.arrowUp,i=0;i<l("#"+this.element.id+" > thead > tr").children("th").length;i++){var s=l("#"+this.element.id+" > thead > tr").children("th")[i];s.id===this.element.id+"_"+t&&l(s).html(l(s).html()+'<span class="zoiaTableSortingIndicator" id="'+this.element.id+'SortingIndicator">'+a+"</span>")}},_sortColumn:function(t){if(t.preventDefault(),t.target.id&&t.target.id!==this.element.id+"SortingIndicator"){var e=t.target.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.sort.field===e?this.settings.sort.direction="asc"===this.settings.sort.direction?"desc":"asc":(this.settings.sort.field=e,this.settings.sort.direction="asc"),this.load()}},_template:function(t,e){for(var a in e)t=t.replace(new RegExp("{"+a+"}","g"),e[a]);return t},_bindSelectButtons:function(){var t=this;l("."+this.element.id+"BtnSelectAll").click(function(){t._selectAll()}),l("."+this.element.id+"BtnSelectNone").click(function(){t._selectNone()})},_selectAll:function(){this.loading||l("."+this.element.id+"Checkbox").prop("checked",!0)},_selectNone:function(){this.loading||l("."+this.element.id+"Checkbox").prop("checked",!1)},_pagination:function(){var e=this,t=this.settings.maxPages,a=Math.ceil(this.total/this.settings.limit);if(a<2)l("."+this.element.id+"Pagination").html("");else{var i=this.settings.html.listWrapStartHTML;if(t<a){1<this.page&&(i+=this._template(this.settings.html.itemPagePrevHTML,{elementId:this.element.id,page:this.page-1})),3<this.page&&(i+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:1}));var s=this.page-2;s<1&&(s=1),1<s-1&&(i+=this.settings.html.itemPageDotsHTML);var r=this.page+2;a<r&&(r=a);for(var n=s;n<=r;n++)i+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:n});r<a-1&&(i+=this.settings.html.itemPageDotsHTML),this.page<=a-3&&(i+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:a})),this.page<a&&(i+=this._template(this.settings.html.itemPageNextHTML,{elementId:this.element.id,page:this.page+1}))}else for(var o=1;o<=a;o++)i+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:o});i+=this.settings.html.listWrapEndHTML,l("."+this.element.id+"Pagination").html(i),l("."+this.element.id+"PaginationLink").click(function(){var t=parseInt(l(this).data("page"),10);e.loading||e.page===t||(e.page=t,e.load())})}},_loading:function(t){var e="#"+this.element.id+"LoadingDiv";l(e).css({top:l(this.element).top,left:l(this.element).left,width:l(this.element).outerWidth(!0),height:l(this.element).outerHeight(!0)}),t?this.loadingInt=setTimeout(function(){l(e).show()},300):(clearTimeout(this.loadingInt),l(e).hide())},_debounce:function(a,i){var s=null;return function(){var t=this,e=arguments;clearTimeout(s),s=setTimeout(function(){a.apply(t,e)},i)}},getCurrentData:function(){return this.currentData},load:function(){if(this.settings.url&&!this.loading){var o=this,d="";this._loading(!0),this.loading=!0,l.ajax({type:"GET",url:this.settings.url,data:{limit:this.settings.limit,skip:this.page*this.settings.limit-this.settings.limit,sortField:this.settings.sort.field,sortDirection:this.settings.sort.direction,search:this.search},cache:!1}).done(function(t){if(o.loading=!1,t){for(var e in o.pages=parseInt(t.total/o.settings.limit,10),0<t.total%o.settings.limit&&o.pages++,o.total=t.total,o._pagination(),o.currentData={},t.items){var a=t.items[e];for(var i in o.currentData[a._id]=a,d+="<tr>",o.header)if(o.header[i]===o.element.id+"ID")d+='<td><input type="checkbox" id="'+a._id+'" class="za-checkbox '+o.element.id+'Checkbox"></td>';else{var s=!1,r=o.header[i].replace(new RegExp("^"+o.element.id+"_"),"");for(var n in a)n===r&&o.settings.fields[n]&&(a[n]&&"string"==typeof a[n]&&(a[n]=a[n].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),d+="<td>"+o.settings.fields[n].process(n,a,a[n])+"</td>",s=!0);s||(o.settings.fields[r]&&o.settings.fields[r].process?d+="<td>"+o.settings.fields[r].process(r,a)+"</td>":d+="<td></td>")}d+="</tr>"}l(o.element).find("tbody").html(d.length?d:o._template(o.settings.html.errorHTML,{error:o.settings.lang.noitems})),o._loading(!1),l('*[data-page="'+o.page+'"]').parent().addClass("za-active"),o._bindSelectButtons(),o.settings.sort.field&&o._sortIndicator(o.settings.sort.field,o.settings.sort.direction),l(o.element).find("thead").show(),o.settings.onLoad()}else o.loading=!1,o._loading(!1),l(o.element).find("tbody").html(o._template(o.settings.html.errorHTML,{error:o.settings.lang.error}))}).fail(function(){o.loading=!1,o._loading(!1),l(o.element).find("tbody").html(o._template(o.settings.html.errorHTML,{error:o.settings.lang.error}))})}}}),l.fn[a]=function(t){var e=void 0;return this.each(function(){(e=l.data(this,"plugin_"+a))||(e=new s(this,t),l.data(this,"plugin_"+a,e))}),e}}(jQuery,window,document);var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var a=[],i=!0,s=!1,r=void 0;try{for(var n,o=t[Symbol.iterator]();!(i=(n=o.next()).done)&&(a.push(n.value),!e||a.length!==e);i=!0);}catch(t){s=!0,r=t}finally{try{!i&&o.return&&o.return()}finally{if(s)throw r}}return a}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};!function(){var t=void 0,T=void 0,L=void 0,I=void 0,D=void 0,e=void 0,a=void 0,M=void 0,i=function(t){var e=decodeURIComponent(window.location.search.substring(1)).split("&"),a=void 0,i=void 0;for(i=0;i<e.length;i++)if((a=e[i].split("="))[0]===t)return void 0===a[1]||a[1]},s=function(t){var e=t||{action:i("action"),id:i("id")};switch(e.action){case"view":r(e.id);break;default:$("#zoiaSpinnerMain").hide(),$("#wrapOrder").hide(),$("#wrapOrders").show()}},r=function(t){$("#zoiaSpinnerMain").show(),$("#orderID").html(t),$.ajax({type:"POST",url:"/api/warehouse/orders/load",data:{id:t},cache:!1}).done(function(t){if($("#zoiaSpinnerMain").hide(),1===t.status&&t.item){var e=t.item;$("#za_order_date").html(new Date(1e3*parseInt(e.date,10)).toLocaleString()),$("#za_order_status").html(lang.orderStatuses[e.status]),$("#za_order_delivery").html(L[e.delivery]),e.tracking&&e.tracking.length?($(".za-order-tracking-wrap").show(),$("#za_order_tracking").html(e.tracking)):$(".za-order-tracking-wrap").hide();var a='<table class="za-table za-table-striped za-table-small za-table-middle za-table-responsive"><tbody>';for(var i in e.cart){var s=i.split("|"),r=_slicedToArray(s,2),n=r[0],o=r[1],d="";for(var l in e.cart[i].checkboxes)t.propertiesData[e.cart[i].checkboxes[l]]&&(d+="<br>"+t.propertiesData[e.cart[i].checkboxes[l]]);for(var c in e.cart[i].integers){var h=e.cart[i].integers[c].split("|"),p=_slicedToArray(h,2),g=p[0],m=p[1];t.propertiesData[g]&&(d+="<br>"+t.propertiesData[g]+"&nbsp;("+m+")")}for(var u in e.cart[i].selects){var f=e.cart[i].selects[u].split("|"),b=_slicedToArray(f,2),v=b[0],_=b[1];if(t.propertiesData[v]){var z=t.propertiesData[v].split("|"),w=_slicedToArray(z,2);d+="<br>"+w[0]+":&nbsp;"+w[1].split(",")[_]}}a+='<tr><td class="za-table-shrink">'+n+'</td><td class="za-table-expand">'+t.cartData[n]+(o?"&nbsp;("+t.variants[o]+")":"")+d+'</td><td class="za-table-shrink">'+e.cart[i].count+'</td><td class="za-table-shrink"></td></tr>'}a+="</tbody></table>",$("#za_order_cart").html(a);var y='<table class="za-table za-table-striped za-table-small za-table-middle za-table-responsive" id="za_catalog_order_costs_table"><tbody>';for(var k in y+='<tr><td class="za-table-expand">'+lang["Wares cost"]+'</td><td class="za-table-shrink">'+("left"===M?T.currency:"")+("NaN"!==e.costs.totalWares?e.costs.totalWares:0)+("right"===M?"&nbsp;"+T.currency:"")+'</td><td class="za-table-shrink"></td></tr>',y+='<tr><td class="za-table-expand">'+lang.Delivery+'</td><td class="za-table-shrink">'+("left"===M?T.currency:"")+("NaN"!==e.costs.delivery?e.costs.delivery:0)+("right"===M?"&nbsp;"+T.currency:"")+'</td><td class="za-table-shrink"></td></tr>',e.costs.extra)y+='<tr><td class="za-table-expand">'+t.addressData[k]+'</td><td class="za-table-shrink">'+("left"===M?T.currency:"")+("NaN"!==e.costs.extra[k]?e.costs.extra[k]:0)+("right"===M?"&nbsp;"+T.currency:"")+'</td><td class="za-table-shrink"></td></tr>';y+='<tr><td class="za-table-expand">'+lang.Total+'</td><td class="za-table-shrink">'+("left"===M?T.currency:"")+("NaN"!==e.costs.total?e.costs.total:0)+("right"===M?"&nbsp;"+T.currency:"")+'</td><td class="za-table-shrink"></td></tr>',y+="</tbody></table>",$("#za_order_costs").html(y);var x="";if("pickup"!==t.delivery.delivery){for(var S in $(".za-catalog-metadata-wrap").addClass("za-grid-divider"),e.address)D[S]&&D[S][e.address[S]]&&(e.address[S]=D[S][e.address[S]]);x=function(t,e){for(var a in e)t=t.replace(new RegExp("{"+a+"}","g"),e[a]);return t=t.replace(new RegExp("({([^}]+)})","ig"),"")}(I.data,e.address)}else $(".za-catalog-metadata-wrap").removeClass("za-grid-divider");$("#za_order_address").html(x),e.paid?($("#za_order_status_badge_paid").show(),$("#za_order_status_badge_unpaid").hide(),$("#za_order_btn_pay").hide()):($("#za_order_status_badge_paid").hide(),$("#za_order_status_badge_unpaid").show(),$("#za_order_btn_pay").attr("href",$("#za_order_btn_pay").attr("data")+"/payment?id="+e._id),$("#za_order_btn_pay").show()),$("#wrapOrders").hide(),$("#wrapOrder").show()}else window.history.go(-1),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1e3})}).fail(function(){$("#zoiaSpinnerMain").hide(),window.history.go(-1),$zUI.notification(lang["Could not load information from database"],{status:"danger",timeout:1e3})})};$(document).ready(function(){t=$("#zp_locale").attr("data"),T=JSON.parse($("#zp_settings").attr("data")),L=JSON.parse($("#zp_deliveryData").attr("data")),I=JSON.parse($("#zp_addressTemplate").attr("data")),D=JSON.parse($("#zp_addressData").attr("data")),e=$("#zp_prefix").attr("data"),a=$("#zp_uprefix").attr("data"),M=$("#zp_currencyPosition").attr("data"),$.getScript("/api/lang/warehouse/"+t+".js").done(function(){var t={url:"/api/warehouse/orders",limit:20,sort:{field:"_id",direction:"desc"},fields:{_id:{sortable:!0,process:function(t,e,a){return a}},date:{sortable:!0,process:function(t,e,a){return new Date(1e3*parseInt(a,10)).toLocaleString()}},costs:{sortable:!1,process:function(t,e,a){return("left"===M?T.currency:"")+("NaN"!==a.total?a.total:0)+("right"===M?"&nbsp;"+T.currency:"")}},status:{sortable:!0,process:function(t,e,a){return lang.orderStatuses[a]}},actions:{sortable:!1,process:function(t,e){return'<button class="za-icon-button zoia-order-view-btn" za-icon="icon:more" data="'+e._id+'" style="margin-right:5px"></button>'}}},onLoad:function(){$(".zoia-order-view-btn").unbind().click(function(){window.history.pushState({action:"view",id:$(this).attr("data")},document.title,a+e+"/orders?action=view&id="+$(this).attr("data")),r($(this).attr("data"))})},lang:{error:lang["Could not load data from server. Please try to refresh page in a few moments."],noitems:lang["No items to display"]}};$("#orders").zoiaTable(t),window.setTimeout(function(){$(window).bind("popstate",function(t){s(t.originalEvent.state)}),s()},0)})})}();