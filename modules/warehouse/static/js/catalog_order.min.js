"use strict";!function(){var c=0,i=!1,s=void 0,d=void 0,n=void 0,_=void 0,t=void 0,f=void 0,g=function(){$(this).removeClass("za-form-danger");var a=$(this).attr("data-mask"),t=$(this).val().trim();if($(this).attr("data-mandatory")&&""===t)$(this).addClass("za-form-danger");else if(a){if(!$(this).attr("data-mandatory")&&""===t)return;new RegExp(a).test(t)||$(this).addClass("za-form-danger")}},m=function(a){if(a.preventDefault(),!i){$("#za_catalog_order_form_error").hide(),$("#za_catalog_form_captcha_error_text").hide(),$(".za-catalog-form-input").removeClass("za-form-danger");var r=void 0,e=void 0,o={delivery:$("#za_catalog_form_delivery").val()};$(".za-catalog-order-form-rx").each(function(){if("delivery"===$("#za_catalog_form_delivery").find(":selected").attr("data-type")||"email"===$(this).attr("id").replace("za_catalog_form_","")||"phone"===$(this).attr("id").replace("za_catalog_form_","")){var a=$(this).val().trim(),t=$(this).attr("data-mask");if($(this).attr("data-mandatory")&&""===a)return $(this).addClass("za-form-danger"),r=!0,void(e||(e=!0,$(this).focus()));if(t){if(!$(this).attr("data-mandatory")&&""===a)return;if(!new RegExp(t).test(a))return $(this).addClass("za-form-danger"),r=!0,void(e||(e=!0,$(this).focus()))}o[$(this).attr("id").replace("za_catalog_form_","")]=a}}),t||(o.captcha=$("#za_catalog_form_captcha").val().trim(),o.captcha&&o.captcha.match(/^([0-9]+){4}$/)||(r=!0,$("#za_catalog_form_captcha_error_text").show())),r?$("#za_catalog_order_form_error").show():(i=!0,$(".za_catalog_order_submit_spinner").show(),$.ajax({type:"POST",url:"/api/warehouse/order",data:o,cache:!1}).done(function(a){if(i=!1,$(".za_catalog_order_submit_spinner").hide(),1===a.status&&a.order)$("#za_catalog_order_wrap").hide(),$("#za_catalog_order_success_id").html(a.order._id),$("#za_catalog_order_success").show();else if(p(),a.fields){var t=!1;for(var r in a.fields)$("#za_catalog_form_"+a.fields[r]).addClass("za-form-danger"),"captcha"===a.fields[r]&&$("#za_catalog_form_captcha_error_text").show(),t||(t=!0,$("#za_catalog_form_"+a.fields[r]).focus());$zUI.notification(lang["Form contains errors"],{status:"danger",timeout:1500})}else $zUI.notification(lang["Could not place your order. Please try again later or contact website support."],{status:"danger",timeout:1500})}).fail(function(){i=!1,$(".za_catalog_order_submit_spinner").hide(),p(),$zUI.notification(lang["Could not place your order. Please try again later or contact website support."],{status:"danger",timeout:1500})}))}},p=function(){$(".za-catalog-order-captcha-img").show(),$(".za-catalog-order-captcha-img").attr("src","/api/captcha?"+(new Date).getTime()),$("#za_catalog_form_captcha").val("")},z=function(){var i=c,l={};"delivery"===$("#za_catalog_form_delivery").find(":selected").attr("data-type")&&$(".za-catalog-order-form-rx").each(function(){var a=$(this).attr("id").replace("za_catalog_form_",""),t=$(this).attr("data-cost")||parseFloat($(this).find(":selected").attr("data-cost"))||0,r=$(this).attr("data-addprc")||parseFloat($(this).find(":selected").attr("data-addprc"))||0,e=$(this).attr("data-weight")||parseFloat($(this).find(":selected").attr("data-weight"))||0;if(t||r||e){var o=0;t&&(o+=t),r&&(o+=c/100*r),e&&(o+=e*_),i+=parseFloat(o),l["delivery"===a?lang.Delivery:function(a){if("za_catalog_form_delivery"===a)return lang.Delivery;for(var t in n){var r=n[t];if(r.id===a)return r.label[s]}return""}(a)]="right"===f?parseFloat(o).toFixed(2)+"&nbsp;"+d.currency:d.currency+parseFloat(o).toFixed(2)}}),i=parseFloat(i).toFixed(2),$(".za-catalog-cart-extra").remove();var a="";for(var t in l)a+='<tr class="za-catalog-cart-extra"><td>'+t+'</td><td colspan="2"></td><td>'+l[t]+"</td></tr>";$("#za-catalog-cart-table").append(a),$(".za-catalog-cart-total").html("right"===f?i+"&nbsp;"+d.currency:d.currency+i)},h=function(){"delivery"===$("#za_catalog_form_delivery").find(":selected").attr("data-type")?$("#za_catalog_order_form").show():$("#za_catalog_order_form").hide(),$("#za_catalog_order_form_error").hide()};$(document).ready(function(){s=$("#zp_locale").attr("data"),d=JSON.parse($("#zp_settings").attr("data")),n=JSON.parse($("#zp_addressJSON").attr("data")),_=parseFloat($("#zp_weight").attr("data")),t=Boolean($("#zp_isAuth").attr("data")),f=$("#zp_currencyPosition").attr("data"),$.getScript("/api/lang/warehouse/"+s+".js").done(function(a){var t="";for(var r in n){var e=n[r];switch(e.type){case"text":t+='<div class="za-margin"><label class="za-form-label" for="za_catalog_form_'+e.id+'">'+e.label[s]+": "+(e.mandatory?'<span class="za-text-danger za-text-bold">&nbsp;*</span>':"")+'</label><div class="za-form-controls"><input class="za-catalog-order-form-rx za-catalog-form-input za-input za-width-'+e.width+'" id="za_catalog_form_'+e.id+'" type="text" maxlength="'+e.maxlength+'" data-mask="'+(e.regex?e.regex:"")+'" data-mandatory="'+(e.mandatory?"true":"")+'"></div></div>';break;case"select":var o="";for(var i in e.values.sort(function(a,t){var r=a.lang[s].toLowerCase(),e=t.lang[s].toLowerCase();return r<e?-1:e<r?1:0}),e.values){var l=e.values[i],d="";e.default&&e.default===l.value&&(d=" selected"),o+='<option value="'+l.value+'" data-addprc="'+l.addPrc+'" data-cost="'+l.cost+'"'+d+">"+l.lang[s]+"</option>"}t+='<div class="za-margin"><label class="za-form-label" for="za_catalog_form_'+e.id+'">'+e.label[s]+':&nbsp;</label><div class="za-form-controls"><select class="za-catalog-form-input za-catalog-order-form-rx za-select za-width-'+e.width+'" id="za_catalog_form_'+e.id+'">'+o+"</select></div></div>"}}$("#za_catalog_order_form").html(t),$(".za-catalog-order-form-rx").on("input",g),$("#za_catalog_form_captcha").on("input",g),$(".za-catalog-order-form-rx").on("input",z),$("#za_catalog_order_submit").click(m),$("#za_catalog_form_delivery").on("input",h),c=parseFloat($(".za-catalog-cart-total").attr("data-total")),z(),h(),p(),$(".za-catalog-order-captcha-img").click(function(){p()})})})}();