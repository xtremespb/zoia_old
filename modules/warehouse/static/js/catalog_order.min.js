"use strict";!function(){var l=0,i=!1,c=void 0,s=void 0,n=void 0,_=void 0,t=void 0,d=void 0,f=void 0,g=function(){$(this).removeClass("za-form-danger");var a=$(this).attr("data-mask"),t=$(this).val().trim();if($(this).attr("data-mandatory")&&""===t)$(this).addClass("za-form-danger");else if(a){if(!$(this).attr("data-mandatory")&&""===t)return;new RegExp(a).test(t)||$(this).addClass("za-form-danger")}},p=function(a){if(a.preventDefault(),!i){$("#za_catalog_order_form_error").hide(),$("#za_catalog_form_captcha_error_text").hide(),$(".za-catalog-form-input").removeClass("za-form-danger");var r=void 0,e=void 0,o={delivery:$("#za_catalog_form_delivery").val()};$(".za-catalog-order-form-rx").each(function(){if("delivery"===$("#za_catalog_form_delivery").find(":selected").attr("data-type")||"email"===$(this).attr("id").replace("za_catalog_form_","")||"phone"===$(this).attr("id").replace("za_catalog_form_","")){var a=$(this).val().trim(),t=$(this).attr("data-mask");if($(this).attr("data-mandatory")&&""===a)return $(this).addClass("za-form-danger"),r=!0,void(e||(e=!0,$(this).focus()));if(t){if(!$(this).attr("data-mandatory")&&""===a)return;if(!new RegExp(t).test(a))return $(this).addClass("za-form-danger"),r=!0,void(e||(e=!0,$(this).focus()))}o[$(this).attr("id").replace("za_catalog_form_","")]=a}}),t||(o.captcha=$("#za_catalog_form_captcha").val().trim(),o.captcha&&o.captcha.match(/^([0-9]+){4}$/)||(r=!0,$("#za_catalog_form_captcha_error_text").show())),r?$("#za_catalog_order_form_error").show():(i=!0,$(".za_catalog_order_submit_spinner").show(),$.ajax({type:"POST",url:"/api/warehouse/order",data:o,cache:!1}).done(function(a){if(i=!1,a&&-101===parseInt(a.status,10))location.href=$("#za_order_btn_pay").attr("data");else if($(".za_catalog_order_submit_spinner").hide(),1===a.status&&a.order)d?($(".za_catalog_order_submit_spinner").show(),location.href=$("#za_order_btn_pay").attr("data")+"/payment?id="+a.order._id):($("#za_catalog_order_wrap").hide(),$("#za_catalog_order_success_id").html(a.order._id),$("#za_catalog_order_success").show(),$("#za_order_btn_pay").attr("href",$("#za_order_btn_pay").attr("data")+"/payment?id="+a.order._id),$("#za_order_btn_goto").attr("href",$("#za_order_btn_pay").attr("data")+"/orders?action=view&id="+a.order._id));else{if(m(),a.error)return $zUI.notification(a.error,{status:"danger",timeout:1500});if(a.fields){var t=!1;for(var r in a.fields)$("#za_catalog_form_"+a.fields[r]).addClass("za-form-danger"),"captcha"===a.fields[r]&&$("#za_catalog_form_captcha_error_text").show(),t||(t=!0,$("#za_catalog_form_"+a.fields[r]).focus());$zUI.notification(lang["Form contains errors"],{status:"danger",timeout:1500})}else $zUI.notification(lang["Could not place your order. Please try again later or contact website support."],{status:"danger",timeout:1500})}}).fail(function(){i=!1,$(".za_catalog_order_submit_spinner").hide(),m(),$zUI.notification(lang["Could not place your order. Please try again later or contact website support."],{status:"danger",timeout:1500})}))}},m=function(){$(".za-catalog-order-captcha-img").show(),$(".za-catalog-order-captcha-img").attr("src","/api/captcha?"+(new Date).getTime()),$("#za_catalog_form_captcha").val("")},z=function(){var i=l,d={};"delivery"===$("#za_catalog_form_delivery").find(":selected").attr("data-type")&&$(".za-catalog-order-form-rx").each(function(){var a=$(this).attr("id").replace("za_catalog_form_",""),t=$(this).attr("data-cost")||parseFloat($(this).find(":selected").attr("data-cost"))||0,r=$(this).attr("data-addprc")||parseFloat($(this).find(":selected").attr("data-addprc"))||0,e=$(this).attr("data-weight")||parseFloat($(this).find(":selected").attr("data-weight"))||0;if(t||r||e){var o=0;t&&(o+=t),r&&(o+=l/100*r),e&&(o+=e*_),o||(o=0),i+=parseFloat(o),d["delivery"===a?lang.Delivery:function(a){if("za_catalog_form_delivery"===a)return lang.Delivery;for(var t in n){var r=n[t];if(r.id===a)return r.label[c]}return""}(a)]="right"===f?parseFloat(o).toFixed(2).replace(/\.00$/gm,"")+"&nbsp;"+s.currency:s.currency+parseFloat(o).toFixed(2).replace(/\.00$/gm,"")}}),i||(i=0),i=parseFloat(i).toFixed(2).replace(/\.00$/gm,""),$(".za-catalog-cart-extra").remove();var a="";for(var t in d)a+='<tr class="za-catalog-cart-extra"><td>'+t+'</td><td colspan="2"></td><td>'+d[t]+"</td></tr>";$("#za-catalog-cart-table").append(a),$(".za-catalog-cart-total").html("right"===f?i+"&nbsp;"+s.currency:s.currency+i)},u=function(){"delivery"===$("#za_catalog_form_delivery").find(":selected").attr("data-type")?$("#za_catalog_order_form").show():$("#za_catalog_order_form").hide(),$("#za_catalog_order_form_error").hide()};$(document).ready(function(){c=$("#zp_locale").attr("data"),s=JSON.parse($("#zp_settings").attr("data")),n=JSON.parse($("#zp_addressJSON").attr("data")),_=parseFloat($("#zp_weight").attr("data")),t="true"===$("#zp_isAuth").attr("data"),d="true"===$("#zp_payBeforeOrderIsPlaced").attr("data"),f=$("#zp_currencyPosition").attr("data"),$.getScript("/api/lang/warehouse/"+c+".js").done(function(){var a="";for(var t in n){var r=n[t];switch(r.type){case"text":a+='<div class="za-margin"><label class="za-form-label" for="za_catalog_form_'+r.id+'">'+r.label[c]+": "+(r.mandatory?'<span class="za-text-danger za-text-bold">&nbsp;*</span>':"")+'</label><div class="za-form-controls"><input class="za-catalog-order-form-rx za-catalog-form-input za-input za-width-'+r.width+'" id="za_catalog_form_'+r.id+'" type="text" maxlength="'+r.maxlength+'" data-mask="'+(r.regex?r.regex:"")+'" data-mandatory="'+(r.mandatory?"true":"")+'"></div></div>';break;case"select":var e="";for(var o in r.values.sort(function(a,t){var r=a.lang[c].toLowerCase(),e=t.lang[c].toLowerCase();return r<e?-1:e<r?1:0}),r.values){var i=r.values[o],d="";r.default&&r.default===i.value&&(d=" selected"),e+='<option value="'+i.value+'" data-addprc="'+i.addPrc+'" data-cost="'+i.cost+'"'+d+">"+i.lang[c]+"</option>"}a+='<div class="za-margin"><label class="za-form-label" for="za_catalog_form_'+r.id+'">'+r.label[c]+':&nbsp;</label><div class="za-form-controls"><select class="za-catalog-form-input za-catalog-order-form-rx za-select za-width-'+r.width+'" id="za_catalog_form_'+r.id+'">'+e+"</select></div></div>"}}$("#za_catalog_order_form").html(a),$(".za-catalog-order-form-rx").on("input",g),$("#za_catalog_form_captcha").on("input",g),$(".za-catalog-order-form-rx").on("input",z),$("#za_catalog_order_submit").click(p),$("#za_catalog_form_delivery").on("input",u),l=parseFloat($(".za-catalog-cart-total").attr("data-total")),z(),u(),m(),$(".za-catalog-order-captcha-img").click(function(){m()})})})}();