"use strict";!function(){var a=void 0,i=void 0,r=void 0,o=function(){$zUI.modal.confirm(lang["Your profile picture will be deleted permanently. Continue?"],{labels:{ok:lang.Yes,cancel:lang.Cancel},stack:!0}).then(function(){$("#zoia_actc_photo_progress>span").html(""),$("#zoia_actc_photo_progress").show(),$(".zoia-btn-picture").hide(),$.ajax({type:"POST",url:"/api/users/picture/delete",cache:!1}).done(function(a){$(".zoia-btn-picture").show(),$("#zoia_actc_photo_progress").hide(),a&&1===a.status?$("#zoia_actc_picture").attr("src",a.pictureURL+"?_"+Date.now()):$zUI.notification(lang["Could not delete image on server"],{status:"danger",timeout:1500})}).fail(function(){$(".zoia-btn-picture").show(),$("#zoia_actc_photo_progress").hide(),$zUI.notification(lang["Could not delete image on server"],{status:"danger",timeout:1500})},200)})},t=function(a){if(a.preventDefault(),!$("#spnCommonForm").is(":visible")){var o=$("#zoia_actc_realname").val().trim();$("#spnCommonForm").show(),$("#zoia_actc_realname").removeClass("za-form-danger"),$.ajax({type:"POST",url:"/api/users/profile/common/save",data:{realname:o},cache:!1}).done(function(a){$("#spnCommonForm").hide(),a&&1===a.status?$zUI.notification(lang["Profile information has been saved"],{status:"success",timeout:1500}):(2===a.status&&$("#zoia_actc_realname").addClass("za-form-danger").focus(),$zUI.notification(lang["Could not save profile information"],{status:"danger",timeout:1500}))}).fail(function(){$("#spnCommonForm").hide(),$zUI.notification(lang["Could not save profile information"],{status:"danger",timeout:1500})},200)}},e=function(a){if(a.preventDefault(),!$("#spnPasswordForm").is(":visible")){$(".zoia-act-form-field").removeClass("za-form-danger"),$(".zoia-form-error-message").hide();var o=$("#zoia_act_password_current").val().trim(),t=$("#zoia_act_password").val().trim(),e=$("#zoia_act_password_confirm").val().trim();if(!o.length||50<o.length)return $("#zoia_act_password_current_error>span").html(lang["Doesn't match required format"]),$("#zoia_act_password_current_error").show(),$("#zoia_act_password_current").focus().addClass("za-form-danger");if(t!==e)return $("#zoia_act_password_error>span").html(lang["Passwords do not match"]),$("#zoia_act_password_error").show(),$("#zoia_act_password_confirm").addClass("za-form-danger"),$("#zoia_act_password").addClass("za-form-danger").focus();if(!t.length||t.length<8||50<t.length)return $("#zoia_act_password_error>span").html(lang["Doesn't match required format"]),$("#zoia_act_password_error").show(),$("#zoia_act_password_confirm").addClass("za-form-danger"),$("#zoia_act_password").focus().addClass("za-form-danger");$("#spnPasswordForm").show(),$.ajax({type:"POST",url:"/api/users/profile/password/save",data:{passwordCurrent:o,passwordNew:t},cache:!1}).done(function(a){$("#spnPasswordForm").hide(),a&&1===a.status?$zUI.modal.alert(lang["Your password has been changed. Now you will be forwarded to the sign in form."],{labels:{ok:lang.OK,cancel:lang.Cancel},stack:!0}).then(function(){$(".zoia-loading").show(),$(".zoia-wrap").hide(),window.location.href=i+r+"?redirect="+i+"/account?_="+Date.now()}):$zUI.notification(lang["Could not save profile information"],{status:"danger",timeout:1500})}).fail(function(){$("#spnPasswordForm").hide(),$zUI.notification(lang["Could not save profile information"],{status:"danger",timeout:1500})},200)}},n=function(a){if(a.preventDefault(),!$("#spnEmail1Form").is(":visible")){$(".zoia-act-form-field").removeClass("za-form-danger"),$(".zoia-form-error-message").hide();var o=$("#zoia_act_email_new").val().trim();if(!o.length||129<o.length||o.length<6||!o.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/))return $("#zoia_act_email_new_error>span").html(lang["Doesn't match required format"]),$("#zoia_act_email_new_error").show(),$("#zoia_act_email_new").focus().addClass("za-form-danger");$("#spnEmail1Form").show(),$.ajax({type:"POST",url:"/api/users/profile/email/step1",data:{emailNew:o},cache:!1}).done(function(a){$("#spnEmail1Form").hide(),a&&1===a.status?($("#zoia_act_email_code2_label").html(o),$("#zoia_act_email_step1").hide(),$("#zoia_act_email_step2").show(),$("#zoia_act_email_code1").focus()):$zUI.notification(lang["Could not send confirmation codes"],{status:"danger",timeout:1500})}).fail(function(){$("#spnEmail1Form").hide(),$zUI.notification(lang["Could not send confirmation codes"],{status:"danger",timeout:1500})},200)}},s=function(a){if(a.preventDefault(),!$("#spnEmail2Form").is(":visible")){$(".zoia-act-form-field").removeClass("za-form-danger"),$(".zoia-form-error-message").hide();var o=$("#zoia_act_email_code1").val().trim(),t=$("#zoia_act_email_code2").val().trim();if(!o||!o.match(/^[0-9]{1,6}$/))return $("#zoia_act_email_code1_error>span").html(lang["Doesn't match required format"]),$("#zoia_act_email_code1_error").show(),$("#zoia_act_email_code1").focus().addClass("za-form-danger");if(!t||!t.match(/^[0-9]{1,6}$/))return $("#zoia_act_email_code2_error>span").html(lang["Doesn't match required format"]),$("#zoia_act_email_code2_error").show(),$("#zoia_act_email_code2").focus().addClass("za-form-danger");$("#spnEmail2Form").show(),$.ajax({type:"POST",url:"/api/users/profile/email/step2",data:{code1:o,code2:t},cache:!1}).done(function(a){if($("#spnEmail2Form").hide(),a&&1===a.status)$zUI.modal.alert(lang["Your e-mail address has been changed. Now you will be forwarded to the sign in form."],{labels:{ok:lang.OK,cancel:lang.Cancel},stack:!0}).then(function(){$(".zoia-loading").show(),$(".zoia-wrap").hide(),window.location.href=i+r+"?redirect="+i+"/account?_="+Date.now()});else{if(-4===a.status&&($zUI.notification(lang["Invalid codes. Please check your input and try again."],{status:"danger",timeout:1500}),$("#zoia_act_email_code2").addClass("za-form-danger"),$("#zoia_act_email_code1").focus().addClass("za-form-danger")),-3===a.status)return $zUI.notification(lang["Invalid code(s). Please check your input and try again."],{status:"danger",timeout:1500}),$("#zoia_act_email_code2").addClass("za-form-danger"),$("#zoia_act_email_code1").focus().addClass("za-form-danger");if(-4===a.status)return $zUI.modal.alert(lang["Too many accepts. Now you will be forwarded to the sign in form."],{labels:{ok:lang.OK,cancel:lang.Cancel},stack:!0}).then(function(){$(".zoia-loading").show(),$(".zoia-wrap").hide(),window.location.href=i+r+"?redirect="+i+"/account?_="+Date.now()});$zUI.notification(lang["Could not change e-mail address"],{status:"danger",timeout:1500})}}).fail(function(){$("#spnEmail2Form").hide(),$zUI.notification(lang["Could not change e-mail address"],{status:"danger",timeout:1500})},200)}};$(document).ready(function(){a=$("#zp_locale").attr("data"),i=$("#zp_uprefix").attr("data"),r=$("#zp_aprefix").attr("data"),$.getScript("/api/lang/users/"+a+".js").done(function(){$(".zoia-account-timestamp").html($(".zoia-account-timestamp").html().length?new Date(1e3*parseInt($(".zoia-account-timestamp").html(),10)).toLocaleString():lang.unknown),$(".zoia-account-status").html(lang.statuses[parseInt($(".zoia-account-status").html(),10)]),$zUI.upload(".js-upload",{url:"/api/users/picture/upload",multiple:!1,beforeSend:function(a){$("#zoia_actc_photo_progress").show(),$("#zoia_actc_photo_progress>span").html(""),$(".zoia-btn-picture").hide()},error:function(){$("#zoia_actc_photo_progress").hide(),$(".zoia-btn-picture").show()},progress:function(a){var o=parseInt(100/a.total*a.loaded,10);100===o&&(o=99),$("#zoia_actc_photo_progress>span").html(o+"%")},completeAll:function(a){$(".zoia-btn-picture").show(),$("#zoia_actc_photo_progress>span").html("100%"),setTimeout(function(){$("#zoia_actc_photo_progress").hide()},500);var o={};try{o=JSON.parse(a.response)}catch(a){}o.status&&1===o.status?$("#zoia_actc_picture").attr("src",o.pictureURL+"?_"+Date.now()):$zUI.notification(lang["Could not upload image to server"],{status:"danger",timeout:1500})}}),$("#zoia_actc_btn_picture_reset").click(o),$("#zoia_act_form_common").submit(t),$("#zoia_act_form_password").submit(e),$("#zoia_act_form_email1").submit(n),$("#zoia_act_form_email2").submit(s),$(".zoia-loading").hide(),$(".zoia-wrap").show()})})}();