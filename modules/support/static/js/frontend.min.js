"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){var e={load:{url:"#",method:"POST"},save:{url:"#",method:"POST"},captcha:"/api/captcha",items:[],edit:!1,validation:!0,html:{helpText:'<div class="uk-text-meta">{text}</div>',text:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><input class="uk-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',select:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><select{multiple} class="uk-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-flex"><div class="{prefix}-field-wrap"><input class="uk-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="uk-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',captcha:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-grid uk-grid-small"><div><input class="uk-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="uk-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="uk-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}_btn">{label}:{bullet}</label><div class="uk-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="uk-button uk-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}{html}</div>',textarea:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><textarea class="uk-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',checkboxlistItem:'<li><label><input class="uk-checkbox {prefix}-{name}-cbx" type="checkbox" data="{title}">&nbsp;&nbsp;{title}</label></li>',checkboxlist:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-panel uk-panel-scrollable{css}" id="{prefix}_{name}_wrap"><ul class="uk-list">{items}</ul></div>{helpText}</div>',valueslistItem:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right"><input placeholder="{langParameter}" type="text" class="uk-input formBuilder-valueslist-par" value="{key}"></div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div><div style="padding-top:3px"><button class="uk-icon-button uk-button-danger formBuilder-valueslist-btnDel" uk-icon="icon:minus"></button></div></div>',valueslistItemFixed:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right">{key}</div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div></div>',valueslist:'<div class="uk-flex uk-flex-column"><div class="uk-margin-bottom"><label class="uk-form-label">{label}:{bullet}</label></div><div><button type="button" class="uk-icon-button uk-button-primary formBuilder-valueslist-btnAdd" id="{prefix}_{name}_btnAdd" uk-icon="icon:plus" data-prefix="{prefix}" data-name="{name}"></button></div><div id="{prefix}_{name}_wrap" class="uk-margin-bottom {prefix}-formBuilder-valueslist-wrap">{items}</div></div>',bullet:'&nbsp;<span style="color:red;font-size:120%">&#8226;</span>'},template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:"Should not be empty",tooShort:"Too short",tooLong:"Too long",invalidFormat:"Doesn't match required format",passwordsNotMatch:"Passwords do not match",parameter:"Parameter",value:"Value"},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(){},onSaveSuccess:function(){},onSaveError:function(){},onLoadStart:function(){},onLoadSuccess:function(){},onLoadError:function(){}},formDangerClass:"uk-form-danger"},a=function(a,i){this.element=a,this.settings=t.extend({},e,i),this._defaults=e,this._name="zoiaFormBuilder",this._prefix=this.element.id,this._formTypes=["text","email","password","select","passwordConfirm","captcha","launcher","textarea","checkboxlist","valueslist","valueslistfixed","valueslisteditable"],this._saving=!1,this.init()};t.extend(a.prototype,{init:function(){var e="",a="";for(var i in this.settings.items){var s=this.settings.items[i],l="";switch((s.validation&&!this.settings.edit&&s.validation.mandatoryCreate||s.validation&&this.settings.edit&&s.validation.mandatoryEdit)&&(l=this.settings.html.bullet),s.type){case"text":case"email":case"password":e+=this._template(this.settings.html.text,{prefix:this._prefix,name:i,label:s.label,bullet:l,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:s.type});break;case"launcher":e+=this._template(this.settings.html.launcher,{prefix:this._prefix,name:i,label:s.label,bullet:l,labelBtn:s.labelBtn,data:s.data,value:s.value,css:s.css?" "+s.css:"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",html:s.html?" "+s.html:""});break;case"valueslist":var r="";for(var n in s.values)r+=this._template(this.settings.html.valueslistItem,{prefix:this._prefix,name:i,key:s.values[n].p,value:s.values[n].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e+=this._template(this.settings.html.valueslist,{prefix:this._prefix,name:i,label:s.label,bullet:l,items:r});break;case"valueslisteditable":var o="";for(var d in s.values)o+=this._template(s.values[d].t?this.settings.html.valueslistItemEditablePostfix:this.settings.html.valueslistItemEditable,{prefix:this._prefix,name:i,key:s.values[d].p,value:s.values[d].v,postfix:s.values[d].t,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e+=this._template(this.settings.html.valueslistEditable,{prefix:this._prefix,name:i,label:s.label,bullet:l,items:o,helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",buttons:s.buttons||""});break;case"valueslistfixed":var u="";for(var c in s.values)u+=this._template(this.settings.html.valueslistItemFixed,{prefix:this._prefix,name:i,key:s.values[c].p,value:s.values[c].t,data:s.values[c].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e+=this._template(this.settings.html.valueslistFixed,{prefix:this._prefix,name:i,label:s.label,bullet:l,items:u});break;case"select":var p="";for(var f in s.values)p+='<option value="'+f+'">'+s.values[f]+"</option>";e+=this._template(this.settings.html.select,{prefix:this._prefix,name:i,label:s.label,bullet:l,css:s.css?" "+s.css:"",multiple:s.multiple?" multiple":"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:s.type,values:p});break;case"checkboxlist":var h="";for(var m in s.values)h+=this._template(this.settings.html.checkboxlistItem,{prefix:this._prefix,name:i,title:s.values[m]});e+=this._template(this.settings.html.checkboxlist,{prefix:this._prefix,name:i,label:s.label,bullet:l,css:s.css?" "+s.css:"",multiple:s.multiple?" multiple":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",items:h});break;case"passwordConfirm":e+=this._template(this.settings.html.passwordConfirm,{prefix:this._prefix,name:i,label:s.label,bullet:l,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:"password"});break;case"captcha":e+=this._template(this.settings.html.captcha,{prefix:this._prefix,name:i,css:s.css?" "+s.css:"",label:s.label,bullet:l,helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",autofocus:s.autofocus?"autofocus":""});break;case"textarea":e+=this._template(this.settings.html.textarea,{prefix:this._prefix,name:i,label:s.label,bullet:l,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):""});break;case"buttons":for(var v="",g=0;g<s.buttons.length;g++){var _=s.buttons[g];v+=this._template(this.settings.html.button,{css:_.css?" "+_.css:"",prefix:this._prefix,name:_.name||"button"+g,type:_.type||"button",label:_.label||""})+"&nbsp;"}a+=this._template(this.settings.html.buttonsWrap,{prefix:this._prefix,css:s.css?" "+s.css:"",buttons:v,html:s.html?" "+s.html:""})}}t(this.element).html(this._template(this.settings.template.fields,{fields:e})+this._template(this.settings.template.buttons,{buttons:a})),t(".formBuilder-valueslist-btnAdd").unbind(),t(".formBuilder-valueslist-btnAdd").click(function(e){b._valueslistAddFunc(t(this).attr("data-prefix"),t(this).attr("data-name"),"","")}),t(".formBuilder-valueslist-btnDel").unbind(),t(".formBuilder-valueslist-btnDel").click(function(e){t(this).parent().parent().remove()}),t(".formBuilder-valueslistfixed-btnAdd").unbind(),t(".formBuilder-valueslistfixed-btnAdd").click(function(e){b._valueslistfixedAddFunc(t(this).attr("data-prefix"),t(this).attr("data-name"),"","")}),t(".formBuilder-valueslistfixed-btnDel").unbind(),t(".formBuilder-valueslistfixed-btnDel").click(function(e){t(this).parent().parent().remove()}),t(".formBuilder-valueslisteditable-btnAdd").unbind(),t(".formBuilder-valueslisteditable-btnAdd").click(function(e){b._valueslistAddFunc(t(this).attr("data-prefix"),t(this).attr("data-name"),"","")}),t(".formBuilder-valueslisteditable-btnDel").unbind(),t(".formBuilder-valueslisteditable-btnDel").click(function(e){t(this).parent().parent().remove()}),this.settings.events.onInit&&this.settings.events.onInit();var b=this;t(this.element).submit(function(t){t.preventDefault(),b._submit()}),this._captchaInit()},_valueslistAddFunc:function(e,a,i,s,l){var r=this._template(this.settings.html.valueslistItem,{prefix:e,name:a,key:i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t("#"+e+"_"+a+"_wrap").append(r),l||t("."+e+"-"+a+"-item").last().find("div>input:first").focus(),t(".formBuilder-valueslist-btnDel").unbind(),t(".formBuilder-valueslist-btnDel").click(function(e){e.stopPropagation(),t(this).parent().parent().remove()})},_valueslisteditableAddFunc:function(e,a,i,s,l,r,n){if(r="undefined"===r?null:r,i){i=String(i);var o=this._template(r?this.settings.html.valueslistItemEditablePostfix:this.settings.html.valueslistItemEditable,{prefix:e,name:a,key:i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,data:l,postfix:r,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t("#"+e+"_"+a+"_wrap").append(o),n||t("."+e+"-"+a+"-item").last().find("div>input:first").focus(),t(".formBuilder-valueslisteditable-btnDel").unbind(),t(".formBuilder-valueslisteditable-btnDel").click(function(e){e.stopPropagation(),t(this).parent().parent().remove()})}},_valueslistfixedAddFunc:function(e,a,i,s,l){var r=this._template(this.settings.html.valueslistfixedItem,{prefix:e,name:a,key:i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t("#"+e+"_"+a+"_wrap").append(r),l||t("."+e+"-"+a+"-item").last().find("div>input:first").focus(),t(".formBuilder-valueslistfixed-btnDel").unbind(),t(".formBuilder-valueslistfixed-btnDel").click(function(e){e.stopPropagation(),t(this).parent().parent().remove()})},setValidation:function(t){this.validation=t},setEditMode:function(t){this.settings.edit=t},clearErrors:function(){t("."+this._prefix+"-form-field").removeClass(this.settings.formDangerClass),t("."+this._prefix+"-error-text").hide()},resetForm:function(){this.clearErrors();t("."+this._prefix+"-form-field").not(".zoiaFormBuilder-no-reset").val(""),t("select."+this._prefix+"-form-field").prop("selectedIndex",0),t(".formBuilder-valueslist-val").val(""),t("."+this._prefix+"-formBuilder-valueslist-wrap").html("");for(var e in this.settings.items){var a=this.settings.items[e];a.default&&t("#"+this._prefix+"_"+e).val(a.default),"launcher"===a.type&&(t("#"+this._prefix+"_"+e+"_val").html(a.value),t("#"+this._prefix+"_"+e+"_val").attr("data",a.data)),"checkboxlist"===a.type&&t("."+this._prefix+"-"+e+"-cbx").prop("checked",!1)}},serialize:function(){var e=this,a={};for(var i in this.settings.items){var s=this.settings.items[i];-1!==this._formTypes.indexOf(s.type)&&function(){switch(s.type){case"launcher":a[i]={type:s.type,value:t("#"+e._prefix+"_"+i+"_val").html(),id:t("#"+e._prefix+"_"+i+"_val").attr("data")};break;case"checkboxlist":var l=t("."+e._prefix+"-"+i+"-cbx:checked").map(function(){return t(this).attr("data")}).get();a[i]={type:s.type,value:l.join(",")};break;case"valueslist":var r=[];t("."+e._prefix+"-"+i+"-item").each(function(){r.push({p:String(t(this).find("*>.formBuilder-valueslist-par").val()),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),a[i]={type:s.type,value:r};break;case"valueslisteditable":var n=[];t("."+e._prefix+"-"+i+"-item").each(function(){n.push({p:String(t(this).find("*>.formBuilder-valueslist-par").html()),v:String(t(this).find("*>.formBuilder-valueslist-val").val()),d:String(t(this).find("*>.formBuilder-valueslist-val").attr("data")),t:String(t(this).find("*>.formBuilder-valueslist-val").attr("data-postfix"))})}),a[i]={type:s.type,value:n};break;case"valueslistfixed":var o=[];t("."+e._prefix+"-"+i+"-item").each(function(){o.push({p:String(t(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),a[i]={type:s.type,value:o};break;default:a[i]={type:s.type,value:t("#"+e._prefix+"_"+i).val()}}}()}return a},deserialize:function(e){if(e&&"object"===(void 0===e?"undefined":_typeof(e)))for(var a in this.settings.items)switch(e[a]||(e[a]={id:"",value:""}),e[a].type){case"launcher":t("#"+this._prefix+"_"+a+"_val").html(e[a].value),t("#"+this._prefix+"_"+a+"_val").attr("data",e[a].id);break;case"checkboxlist":var i=e[a].value.split(",");for(var s in i)t('.editForm-groups-cbx[data="'+i[s]+'"]').prop("checked",!0);break;case"valueslist":var l=[];for(var r in e[a].value)l.push(e[a].value[r].p),l.push(e[a].value[r].v);for(t("#"+this._prefix+"_"+a+"_wrap").html("");l.length>0;){var n=l.shift(),o=l.shift();this._valueslistAddFunc(this._prefix,a,n,o,!0)}break;case"valueslisteditable":var d=[];for(var u in e[a].value)d.push(e[a].value[u].p),d.push(e[a].value[u].v),d.push(e[a].value[u].d),d.push(e[a].value[u].t);for(t("#"+this._prefix+"_"+a+"_wrap").html("");d.length>0;){var c=d.shift(),p=d.shift(),f=d.shift(),h=d.shift();this._valueslisteditableAddFunc(this._prefix,a,c,p,f,h,!0)}break;case"valueslistfixed":t("."+this._prefix+"-"+a+"-item-val").val("");for(var m in e[a].value)t("."+this._prefix+"-"+a+'-item-val[data="'+e[a].value[m].p+'"]').val(e[a].value[m].v);break;default:t("#"+this._prefix+"_"+a).val(e[a].value||"")}},deserializePart:function(e,a){if(a&&"object"===(void 0===a?"undefined":_typeof(a)))switch(a||(a={id:"",value:""}),a.type){case"launcher":t("#"+this._prefix+"_"+e+"_val").html(a.value),t("#"+this._prefix+"_"+e+"_val").attr("data",a.id);break;case"checkboxlist":var i=a.value.split(",");for(var s in i)t('.editForm-groups-cbx[data="'+i[s]+'"]').prop("checked",!0);break;case"valueslist":var l=[];for(var r in a.value)l.push(a.value[r].p),l.push(a.value[r].v);for(t("#"+this._prefix+"_"+e+"_wrap").html("");l.length>0;){var n=l.shift(),o=l.shift();this._valueslistAddFunc(this._prefix,e,n,o,!0)}break;case"valueslisteditable":var d=[];for(var u in a.value)d.push(a.value[u].p),d.push(a.value[u].v),d.push(a.value[u].d),d.push(a.value[u].t);for(t("#"+this._prefix+"_"+e+"_wrap").html("");d.length>0;){var c=d.shift(),p=d.shift(),f=d.shift(),h=d.shift();this._valueslisteditableAddFunc(this._prefix,e,c,p,f,h,!0)}break;case"valueslistfixed":t("."+this._prefix+"-"+e+"-item-val").val("");for(var m in a.value)t("."+this._prefix+"-"+e+'-item-val[data="'+a.value[m].p+'"]').val(a.value[m].v);break;default:t("#"+this._prefix+"_"+e).val(a.value||"")}},loadJSON:function(e){var a=this,i=this;jQuery.each(e,function(e,s){if(t("#"+i._prefix+"_"+e).val(s),i.settings.items[e]&&"checkboxlist"===i.settings.items[e].type&&s){var l=s.split(",");for(var r in l)t('.editForm-groups-cbx[data="'+l[r]+'"]').prop("checked",!0)}if(i.settings.items[e]&&"valueslist"===i.settings.items[e].type&&s){var n=[];for(var o in s)n.push(o),n.push(s[o]);t("#"+i._prefix+"_"+e+"_wrap").html("");for(var d in s)i._valueslistAddFunc(i._prefix,e,n.shift(),n.shift())}if(i.settings.items[e]&&"valueslisteditable"===i.settings.items[e].type&&s){var u=[];for(var c in s)u.push(c),u.push(s[c]);t("#"+i._prefix+"_"+e+"_wrap").html("");for(var p in s)i._valueslisteditableAddFunc(i._prefix,e,u.shift(),u.shift(),u.shift(),u.shift())}if(i.settings.items[e]&&"valueslistfixed"===i.settings.items[e].type&&s){t("."+a._prefix+"-"+e+"-item-val").val("");for(var f in s)t("."+a._prefix+"-"+e+'-item-val[data="'+s[f].p+'"]').val(s[f].v)}})},loadData:function(e){var a=this;this.settings.events.onLoadStart&&this.settings.events.onLoadStart(),this.resetForm();var i=this;t.ajax({type:this.settings.load.method,url:this.settings.load.url,data:e,cache:!1}).done(function(e){e&&1===e.status?(jQuery.each(e.item,function(e,s){if(t("#"+i._prefix+"_"+e).val(s),i.settings.items[e]&&"checkboxlist"===i.settings.items[e].type&&s){var l=s.split(",");for(var r in l)t('.editForm-groups-cbx[data="'+l[r]+'"]').prop("checked",!0)}if(i.settings.items[e]&&"valueslist"===i.settings.items[e].type&&s){var n=[];for(var o in s)n.push(o),n.push(s[o]);t("#"+i._prefix+"_"+e+"_wrap").html("");for(var d in s)i._valueslistAddFunc(i._prefix,e,n.shift(),n.shift())}if(i.settings.items[e]&&"valueslisteditable"===i.settings.items[e].type&&s){var u=[];for(var c in s)u.push(c),u.push(s[c]);t("#"+i._prefix+"_"+e+"_wrap").html("");for(var p in s)i._valueslisteditableAddFunc(i._prefix,e,u.shift(),u.shift(),u.shift())}if(i.settings.items[e]&&"valueslistfixed"===i.settings.items[e].type&&s){t("."+a._prefix+"-"+e+"-item-val").val("");for(var f in s)t("."+a._prefix+"-"+e+'-item-val[data="'+s[f].p+'"]').val(s[f].v)}}),i.settings.events.onLoadSuccess&&i.settings.events.onLoadSuccess(e)):i.settings.events.onLoadError&&i.settings.events.onLoadError(e)}).fail(function(t,e){i.settings.events.onLoadError&&i.settings.events.onLoadError(t,e)})},captchaRefresh:function(){t("."+this._prefix+"-captcha-img").show(),t("."+this._prefix+"-captcha-img").attr("src",this.settings.captcha+"?"+(new Date).getTime()),t("."+this._prefix+"-captcha-field").val("")},_captchaInit:function(){this.captchaRefresh();var e=this;t("img."+this._prefix+"-captcha-img").click(function(){e.captchaRefresh()})},_template:function(t,e){for(var a in e)t=t.replace(new RegExp("{"+a+"}","g"),e[a]);return t},validate:function(e){var a=this,i={},s={};for(var l in this.settings.items){var r=this.settings.items[l];if(-1!==this._formTypes.indexOf(r.type))if("launcher"!==r.type){if(("valueslist"!==r.type||"continue"!==function(){if(e&&e[l])return s[l]=e[l].value,"continue";var i=[];return t("."+a._prefix+"-"+l+"-item").each(function(){i.push({p:String(t(this).find("*>.formBuilder-valueslist-par").val()),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),s[l]=i,"continue"}())&&!("valueslisteditable"===r.type&&"continue"===function(){if(e&&e[l])return s[l]=e[l].value,"continue";var i=[];return t("."+a._prefix+"-"+l+"-item").each(function(){i.push({p:String(t(this).find("*>.formBuilder-valueslist-par").val()),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),s[l]=i,"continue"}()||"valueslistfixed"===r.type&&"continue"===function(){if(e&&e[l])return s[l]=e[l].value,"continue";var i=[];return t("."+a._prefix+"-"+l+"-item").each(function(){i.push({p:String(t(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),s[l]=i,"continue"}()))if("checkboxlist"!==r.type){var n=e?e[l]?e[l].value:void 0:t("#"+this._prefix+"_"+l).val();if(r.validation){if(!r.validation.mandatoryEdit&&!n&&this.settings.edit||!r.validation.mandatoryCreate&&!n&&!this.settings.edit)continue;if(r.validation.mandatoryCreate&&!n&&!this.settings.edit){i[l]=this.settings.lang.mandatoryMissing;continue}if(r.validation.mandatoryEdit&&!n&&this.settings.edit){i[l]=this.settings.lang.mandatoryMissing;continue}if(r.validation.process&&"function"==typeof r.validation.process&&(n=r.validation.process(n)),"passwordConfirm"===r.type&&t("#"+this._prefix+"_"+l+"Confirm").val()!==n){i[l]=this.settings.lang.passwordsNotMatch;continue}if(r.validation.length){if(r.validation.length.min&&n.length<r.validation.length.min){i[l]=this.settings.lang.tooShort;continue}if(r.validation.length.max&&n.length>r.validation.length.max){i[l]=this.settings.lang.tooLong;continue}}if(r.validation.regexp&&!n.match(r.validation.regexp)){i[l]=this.settings.lang.invalidFormat;continue}s[l]=n}}else{var o=t("."+this._prefix+"-"+l+"-cbx:checked").map(function(){return t(this).attr("data")}).get();s[l]=e?e[l]?e[l].value:void 0:o.join(",")}}else s[l]=e?e[l]?e[l].id:void 0:t("#"+this._prefix+"_"+l+"_val").attr("data")}return{data:s,errors:i}},errors:function(e){if(Object.keys(e).length>0){var a=!1;for(var i in e)t("#"+this._prefix+"_"+i).addClass(this.settings.formDangerClass),t("#"+this._prefix+"_"+i+"_error_text > span").html(e[i]),t("#"+this._prefix+"_"+i+"_error_text").show(),a||(t("#"+this._prefix+"_"+i).focus(),a=!0),"passwordConfirm"===this.settings.items[i].type&&t("#"+this._prefix+"_"+i+"Confirm").addClass(this.settings.formDangerClass);return!0}return!1},_submit:function(){if(!this._saving){this.settings.events.onSaveSubmit&&this.settings.events.onSaveSubmit(),this.clearErrors();var e=this,a={},i={};if(this.settings.validation){var s=this.validate();if(a=s.data||{},i=s.errors||{},this.errors(i))return;if(this.settings.events.onSaveValidate&&"__stop"===(a=this.settings.events.onSaveValidate(a,i)||a))return}else if(this.settings.events.onSaveValidate&&"__stop"===(a=this.settings.events.onSaveValidate(a)))return;e._saving=!0,t.ajax({type:this.settings.save.method,url:this.settings.save.url,data:a,cache:!1}).done(function(a){if(e._saving=!1,a&&1===a.status)e.settings.events.onSaveSuccess&&e.settings.events.onSaveSuccess(a);else{if(a.fields)for(var i in a.fields){var s=!1;t("#"+e._prefix+"_"+a.fields[i]).addClass(e.settings.formDangerClass),s||(t("#"+e._prefix+"_"+a.fields[i]).focus(),s=!0)}e.captchaRefresh(),e.settings.events.onSaveError&&e.settings.events.onSaveError(a)}}).fail(function(t,a){e._saving=!1,e.captchaRefresh(),e.settings.events.onSaveError&&e.settings.events.onSaveError(t,a)})}}}),t.fn.zoiaFormBuilder=function(e){var i=void 0;return this.each(function(){(i=t.data(this,"plugin_zoiaFormBuilder"))||(i=new a(this,e),t.data(this,"plugin_zoiaFormBuilder",i))}),i}}(jQuery,window,document);var currentSupportRequestID=void 0,supportMessageDialog=void 0,captchaRefresh=function(){$(".zoia-ct-captcha-img").attr("src","/api/captcha?rnd="+Math.random()),$("#zoia_ct_captcha").val(""),$(".zoia-ct-captcha-img").show()},createTicketFormSubmit=function(t){t.preventDefault();var e=$("#zoia_ct_title").val().trim(),a=$("#zoia_ct_message").val().trim(),i=parseInt($("#zoia_ct_priority").val()),s=$("#zoia_ct_captcha").val().trim();return $(".zoia-ct-field").removeClass("za-form-danger"),$("#zoia_ct_form_error").hide(),!e||e.length<2||e.length>128?($("#zoia_ct_form_error").show(),$("#zoia_ct_title").focus().addClass("za-form-danger")):!a||a.length<2||a.length>4096?($("#zoia_ct_form_error").show(),$("#zoia_ct_message").focus().addClass("za-form-danger")):s&&s.match(/^[0-9]{4}$/)?($("#zoia_ct_btn_create_spinner").show(),void $.ajax({type:"POST",url:"/api/support/frontend/create",cache:!1,data:{title:e,message:a,priority:i,captcha:s}}).done(function(t){$("#zoia_ct_btn_create_spinner").hide(),t&&1===t.status?(window.history.pushState({action:"view",id:t.id},document.title,"/support?action=view&id="+t.id),viewTicket(String(t.id))):(captchaRefresh(),t.captcha&&$("#zoia_ct_captcha").focus().addClass("za-form-danger"),$zUI.notification(t.error?t.error:lang["Error while loading data"],{status:"danger",timeout:1500}))}).fail(function(){captchaRefresh(),$("#zoia_ct_btn_create_spinner").hide(),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})},200)):($("#zoia_ct_form_error").show(),$("#zoia_ct_captcha").focus().addClass("za-form-danger"))},getUrlParam=function(t){var e=decodeURIComponent(window.location.search.substring(1)).split("&"),a=void 0,i=void 0;for(i=0;i<e.length;i++)if((a=e[i].split("="))[0]===t)return void 0===a[1]||a[1]},deleteAttachment=function(t,e){$('.zoia-attachment-delete[data-fid="'+e+'"]').parent().hide(),$.ajax({type:"POST",url:"/api/support/frontend/attachment/delete",cache:!1,data:{id:t,fid:e}}).done(function(t){t&&1===t.status?$('.zoia-attachment-delete[data-fid="'+e+'"]').parent().remove():($('.zoia-attachment-delete[data-fid="'+e+'"]').parent().show(),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500}))}).fail(function(){$('.zoia-attachment-delete[data-fid="'+e+'"]').parent().show(),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})},200)},bindDeleteAttachmentHandlers=function(){$(".zoia-attachment-delete").unbind().click(function(){var t=$(this).parent().find("a").html(),e=$(this).attr("data-id"),a=$(this).attr("data-fid");$zUI.modal.confirm(lang["The following file will be deleted. Continue?"]+"<br><br>"+t,{labels:{ok:lang.Yes,cancel:lang.Cancel},stack:!0}).then(function(){deleteAttachment(e,a)})})},viewTicket=function(t){if(!t||!t.match(/^[0-9]{1,10}$/))return $zUI.modal.alert(lang["Invalid Ticket ID."],{labels:{ok:lang.OK}});currentSupportRequestID=t,$(".zoia-wrap-table").hide(),$(".zoia-wrap-new").hide(),$(".zoia-ticket-id").html(t),$(".zoia-ticket-wrap-data").hide(),$(".zoia-ticket-wrap-loading").show(),$(".zoia-wrap-view").show(),$.ajax({type:"GET",url:"/api/support/frontend/load",cache:!1,data:{id:t}}).done(function(t){if(t&&1===t.status){switch($("#support").zoiaTable().load(),$(".zoia-ticket-title").html(t.data.title),$(".zoia-ticket-timestamp").html(new Date(1e3*t.data.timestamp).toLocaleString()),$(".zoia-ticket-status").removeClass("za-label-success").removeClass("za-label-warning"),t.data.status){case 1:$(".zoia-ticket-status").addClass("za-label-warning");break;case 2:$(".zoia-ticket-status").addClass("za-label-success")}t.data.messages&&t.data.messages.sort(function(t,e){return t.timestamp>e.timestamp?-1:e.timestamp>t.timestamp?1:0});var e="";for(var a in t.data.messages){var i="";t.data.messages[a].username!==currentUsername&&(i=" zoia-reply-msg"),e+='<article class="za-comment za-margin za-card za-card-default za-card-small za-card-body'+i+'"><header class="za-comment-header za-grid-medium za-flex-middle" za-grid><div class="za-width-expand""><h4 class="za-comment-title za-margin-remove"><span class="za-link-reset">'+t.data.messages[a].username+'</span></h4><ul class="za-comment-meta za-subnav za-subnav-divider za-margin-remove-top" style="border-bottom:1px solid #ddd"><li><span>'+new Date(1e3*parseInt(t.data.messages[a].timestamp)).toLocaleString()+'</span></li></ul></div></header><div class="za-comment-body"><p class="zoia-msg-text">'+t.data.messages[a].message.replace(/\n/gm,"<br>")+"</p></div></article>"}var s="";for(var l in t.data.files){var r=t.data.files[l];s+='<div><span za-icon="icon:trash" class="zoia-attachment-delete" data-id="'+currentSupportRequestID+'" data-fid="'+r.id+'"></span>&nbsp;<a href="/api/support/download?id='+currentSupportRequestID+"&fid="+r.id+'" target="_blank">'+r.filename+"</a></div>"}$("#zoia_attachments").html(s),bindDeleteAttachmentHandlers(),$(".zoia-ticket-messages").html(e),$(".zoia-ticket-status").html(lang.statuses[t.data.status]),$(".zoia-ticket-wrap-loading").hide(),$(".zoia-ticket-wrap-data").show()}else $(".zoia-wrap-view").hide(),$(".zoia-wrap-table").show(),window.history.go(-1),$zUI.notification(t.error?t.error:lang["Error while loading data"],{status:"danger",timeout:1500})}).fail(function(){$(".zoia-wrap-view").hide(),$(".zoia-wrap-table").show(),window.history.go(-1),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})},200)},initUploader=function(){var t=document.getElementById("zoia_upload_progressbar");$zUI.upload(".zoia-upload",{url:"/api/support/frontend/upload",multiple:!0,beforeAll:function(){this.params.id=currentSupportRequestID},error:function(){t.setAttribute("hidden","hidden"),$zUI.modal.alert(lang["Could not upload file to server. Please check file name and size, then try again."],{labels:{ok:lang.OK},stack:!0})},loadStart:function(e){t.removeAttribute("hidden"),t.max=e.total,t.value=e.loaded},progress:function(e){t.max=e.total,t.value=e.loaded},loadEnd:function(e){t.max=e.total,t.value=e.loaded},completeAll:function(e){var a={};try{a=JSON.parse(e.response)}catch(t){}if(a.status&&1===a.status){var i="";for(var s in a.files){var l=a.files[s];i+='<div><span za-icon="icon:trash" class="zoia-attachment-delete" data-id="'+currentSupportRequestID+'" data-fid="'+l.id+'"></span>&nbsp;<a href="/api/support/download?id='+currentSupportRequestID+"&fid="+l.id+'" target="_blank">'+l.filename+"</a></div>"}$("#zoia_attachments").html(i),bindDeleteAttachmentHandlers()}else if(a.error){if($zUI.modal.alert(a.error,{labels:{ok:lang.OK},stack:!0}),a.files){var r="";for(var n in a.files){var o=a.files[n];r+='<div><span za-icon="icon:trash" class="zoia-attachment-delete" data-id="'+currentSupportRequestID+'" data-fid="'+o.id+'"></span>&nbsp;<a href="/api/support/download?id='+currentSupportRequestID+"&fid="+o.id+'" target="_blank">'+o.filename+"</a></div>"}$("#zoia_attachments").html(r),bindDeleteAttachmentHandlers()}}else $zUI.modal.alert(lang["Could not upload file to server. Please check file name and size, then try again."],{labels:{ok:lang.OK},stack:!0});setTimeout(function(){t.setAttribute("hidden","hidden")},1e3)}})},btnMessageSaveClickHandler=function(){$(".zoia-md-field").removeClass("za-form-danger");var t=$("#zoia_md_message").val().trim(),e=$("#zoia_md_captcha").val().trim();return!t||t.length<2||t.length>4096?$("#zoia_md_message").addClass("za-form-danger").focus():e&&e.match(/^[0-9]{4}$/)?($(".zoia-md-button").hide(),$("#zoia_btn_message_save_spinner").show(),void $.ajax({type:"POST",url:"/api/support/frontend/message",cache:!1,data:{id:currentSupportRequestID,captcha:e,message:t}}).done(function(t){if($(".zoia-md-button").show(),$("#zoia_btn_message_save_spinner").hide(),t&&1===t.status){$("#zoia_md_captcha").val("");var e='<article class="za-comment za-margin za-card za-card-default za-card-small za-card-body"><header class="za-comment-header za-grid-medium za-flex-middle" za-grid><div class="za-width-expand""><h4 class="za-comment-title za-margin-remove"><span class="za-link-reset">'+t.message.username+'</span></h4><ul class="za-comment-meta za-subnav za-subnav-divider za-margin-remove-top" style="border-bottom:1px solid #ddd"><li><span>'+new Date(1e3*parseInt(t.message.timestamp)).toLocaleString()+'</span></li></ul></div></header><div class="za-comment-body"><p class="zoia-msg-text">'+t.message.message+"</p></div></article>";$(".zoia-ticket-messages").prepend(e),supportMessageDialog.hide()}else t.captcha&&$("#zoia_md_captcha").addClass("za-form-danger").focus(),captchaRefresh(),$("#zoia_md_captcha").val(""),$zUI.notification(t.error?t.error:lang["Error while loading data"],{status:"danger",timeout:1500})}).fail(function(){$(".zoia-md-button").show(),$("#zoia_btn_message_save_spinner").hide(),captchaRefresh(),$("#zoia_md_captcha").val(""),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})},200)):$("#zoia_md_captcha").addClass("za-form-danger").focus()},processState=function(t){var e=t||{action:getUrlParam("action"),id:getUrlParam("id")};switch(e.action){case"view":viewTicket(e.id);break;case"create":createTicket();break;default:$(".zoia-wrap-new").hide(),$(".zoia-wrap-view").hide(),$(".zoia-wrap-table").show()}},createTicket=function(){$(".zoia-wrap-table").hide(),$(".zoia-wrap-new").show(),$(".zoia-ct-field").val(""),$("#zoia_ct_priority").val(3),$("#zoia_ct_title").focus(),$("#zoia_ct_form_error").hide()};$(document).ready(function(){$("#support").zoiaTable({url:"/api/support/frontend/list",limit:10,sort:{field:"_id",direction:"desc"},fields:{_id:{sortable:!0,process:function(t,e,a){return a}},timestamp:{sortable:!0,process:function(t,e,a){return new Date(1e3*parseInt(a,10)).toLocaleString().replace(/\s/gm,"&nbsp;")}},title:{sortable:!0,process:function(t,e,a){return e.unreadUser&&(a='<span class="za-icon-button" za-icon="icon:mail;ratio:0.6" style="background:#FFB03B;color:#fff;width:20px;height:20px;"></span>&nbsp;'+a),a}},status:{sortable:!0,process:function(t,e,a){return lang.statuses[a]}},priority:{sortable:!0,process:function(t,e,a){return lang.priorities[a]?lang.priorities[a].replace(/\s/g,"&nbsp;"):"&ndash;"}},actions:{sortable:!1,process:function(t,e){return e&&"admin"===e.groupname?"&ndash;":'<button class="za-icon-button zoia-support-action-edit-btn" za-icon="icon: pencil" data="'+e._id+'" style="margin-right:5px"></button>'}}},onLoad:function(){$(".zoia-support-action-edit-btn").click(function(){window.history.pushState({action:"view",id:$(this).attr("data")},document.title,"/support?action=view&id="+$(this).attr("data")),viewTicket($(this).attr("data"))})},lang:{error:lang["Could not load data from server. Please try to refresh page in a few moments."],noitems:lang["No items to display"]}});for(var t in lang.priorities)$("#zoia_ct_priority").append('<option value="'+t+'">'+lang.priorities[t]+"</option>");captchaRefresh(),$(".zoia-ct-captcha-img").click(captchaRefresh),$("#zoia_ct_btn_cancel").click(function(t){t.preventDefault(),$(".zoia-wrap-new").hide(),$(".zoia-wrap-table").show(),window.history.pushState({action:""},document.title,"/support")}),$(".zoia-btn-create-ticket").click(function(){window.history.pushState({action:"create"},document.title,"/support?action=create"),createTicket()}),$("#zoia_ct_form").submit(createTicketFormSubmit),$(window).bind("popstate",function(t){processState(t.originalEvent.state)}),$(".zoia-loading").hide(),supportMessageDialog=$zUI.modal("#supportMessageDialog",{bgClose:!1,escClose:!1,stack:!0}),$(".zoia-btn-create-msg").click(function(){$(".zoia-md-field").removeClass("za-form-danger").val(""),supportMessageDialog.show().then(function(){$("#zoia_md_message").focus()})}),$("#zoia_btn_message_save").click(btnMessageSaveClickHandler),$(".zoia-breadcrumb-root").click(function(t){t.preventDefault(),window.history.pushState({action:""},document.title,"/support"),$(".zoia-wrap-new").hide(),$(".zoia-wrap-view").hide(),$(".zoia-wrap-table").show()}),initUploader(),processState()});