"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){var e={load:{url:"#",method:"POST"},save:{url:"#",method:"POST"},captcha:"/api/captcha",items:[],edit:!1,validation:!0,html:{helpText:'<div class="uk-text-meta">{text}</div>',text:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><input class="uk-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',select:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><select{multiple} class="uk-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-flex"><div class="{prefix}-field-wrap"><input class="uk-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="uk-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',captcha:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-grid uk-grid-small"><div><input class="uk-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="uk-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="uk-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}_btn">{label}:{bullet}</label><div class="uk-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="uk-button uk-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}{html}</div>',textarea:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><br><div class="uk-form-controls"><textarea class="uk-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',checkboxlistItem:'<li><label><input class="uk-checkbox {prefix}-{name}-cbx" type="checkbox" data="{title}">&nbsp;&nbsp;{title}</label></li>',checkboxlist:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:{bullet}</label><div class="uk-panel uk-panel-scrollable{css}" id="{prefix}_{name}_wrap"><ul class="uk-list">{items}</ul></div>{helpText}</div>',valueslistItem:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right"><input placeholder="{langParameter}" type="text" class="uk-input formBuilder-valueslist-par" value="{key}"></div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div><div style="padding-top:3px"><button class="uk-icon-button uk-button-danger formBuilder-valueslist-btnDel" uk-icon="icon:minus"></button></div></div>',valueslistItemFixed:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right">{key}</div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div></div>',valueslist:'<div class="uk-flex uk-flex-column"><div class="uk-margin-bottom"><label class="uk-form-label">{label}:{bullet}</label></div><div><button type="button" class="uk-icon-button uk-button-primary formBuilder-valueslist-btnAdd" id="{prefix}_{name}_btnAdd" uk-icon="icon:plus" data-prefix="{prefix}" data-name="{name}"></button></div><div id="{prefix}_{name}_wrap" class="uk-margin-bottom {prefix}-formBuilder-valueslist-wrap">{items}</div></div>',bullet:'&nbsp;<span style="color:red;font-size:120%">&#8226;</span>'},template:{fields:"{fields}",buttons:"{buttons}"},lang:{mandatoryMissing:"Should not be empty",tooShort:"Too short",tooLong:"Too long",invalidFormat:"Doesn't match required format",passwordsNotMatch:"Passwords do not match",parameter:"Parameter",value:"Value"},events:{onInit:function(){},onSaveSubmit:function(){},onSaveValidate:function(){},onSaveSuccess:function(){},onSaveError:function(){},onLoadStart:function(){},onLoadSuccess:function(){},onLoadError:function(){}},formDangerClass:"uk-form-danger"},a=function(a,i){this.element=a,this.settings=t.extend({},e,i),this._defaults=e,this._name="zoiaFormBuilder",this._prefix=this.element.id,this._formTypes=["text","email","password","select","passwordConfirm","captcha","launcher","textarea","checkboxlist","valueslist","valueslistfixed","valueslisteditable"],this._saving=!1,this.init()};t.extend(a.prototype,{init:function(){var e="",a="";for(var i in this.settings.items){var s=this.settings.items[i],n="";switch((s.validation&&!this.settings.edit&&s.validation.mandatoryCreate||s.validation&&this.settings.edit&&s.validation.mandatoryEdit)&&(n=this.settings.html.bullet),s.type){case"text":case"email":case"password":e+=this._template(this.settings.html.text,{prefix:this._prefix,name:i,label:s.label,bullet:n,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:s.type});break;case"launcher":e+=this._template(this.settings.html.launcher,{prefix:this._prefix,name:i,label:s.label,bullet:n,labelBtn:s.labelBtn,data:s.data,value:s.value,css:s.css?" "+s.css:"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",html:s.html?" "+s.html:""});break;case"valueslist":var l="";for(var r in s.values)l+=this._template(this.settings.html.valueslistItem,{prefix:this._prefix,name:i,key:s.values[r].p,value:s.values[r].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e+=this._template(this.settings.html.valueslist,{prefix:this._prefix,name:i,label:s.label,bullet:n,items:l});break;case"valueslisteditable":var o="";for(var p in s.values)o+=this._template(s.values[p].t?this.settings.html.valueslistItemEditablePostfix:this.settings.html.valueslistItemEditable,{prefix:this._prefix,name:i,key:s.values[p].p,value:s.values[p].v,postfix:s.values[p].t,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e+=this._template(this.settings.html.valueslistEditable,{prefix:this._prefix,name:i,label:s.label,bullet:n,items:o,helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",buttons:s.buttons||""});break;case"valueslistfixed":var u="";for(var d in s.values)u+=this._template(this.settings.html.valueslistItemFixed,{prefix:this._prefix,name:i,key:s.values[d].p,value:s.values[d].t,data:s.values[d].v,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});e+=this._template(this.settings.html.valueslistFixed,{prefix:this._prefix,name:i,label:s.label,bullet:n,items:u});break;case"select":var c="";for(var h in s.values)c+='<option value="'+h+'">'+s.values[h]+"</option>";e+=this._template(this.settings.html.select,{prefix:this._prefix,name:i,label:s.label,bullet:n,css:s.css?" "+s.css:"",multiple:s.multiple?" multiple":"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:s.type,values:c});break;case"checkboxlist":var f="";for(var m in s.values)f+=this._template(this.settings.html.checkboxlistItem,{prefix:this._prefix,name:i,title:s.values[m]});e+=this._template(this.settings.html.checkboxlist,{prefix:this._prefix,name:i,label:s.label,bullet:n,css:s.css?" "+s.css:"",multiple:s.multiple?" multiple":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",items:f});break;case"passwordConfirm":e+=this._template(this.settings.html.passwordConfirm,{prefix:this._prefix,name:i,label:s.label,bullet:n,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",type:"password"});break;case"captcha":e+=this._template(this.settings.html.captcha,{prefix:this._prefix,name:i,css:s.css?" "+s.css:"",label:s.label,bullet:n,helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):"",autofocus:s.autofocus?"autofocus":""});break;case"textarea":e+=this._template(this.settings.html.textarea,{prefix:this._prefix,name:i,label:s.label,bullet:n,css:s.css?" "+s.css:"",autofocus:s.autofocus?"autofocus":"",helpText:s.helpText?this._template(this.settings.html.helpText,{text:s.helpText,prefix:this._prefix}):""});break;case"buttons":for(var g="",v=0;v<s.buttons.length;v++){var _=s.buttons[v];g+=this._template(this.settings.html.button,{css:_.css?" "+_.css:"",prefix:this._prefix,name:_.name||"button"+v,type:_.type||"button",label:_.label||""})+"&nbsp;"}a+=this._template(this.settings.html.buttonsWrap,{prefix:this._prefix,css:s.css?" "+s.css:"",buttons:g,html:s.html?" "+s.html:""})}}t(this.element).html(this._template(this.settings.template.fields,{fields:e})+this._template(this.settings.template.buttons,{buttons:a})),t(".formBuilder-valueslist-btnAdd").unbind(),t(".formBuilder-valueslist-btnAdd").click(function(e){b._valueslistAddFunc(t(this).attr("data-prefix"),t(this).attr("data-name"),"","")}),t(".formBuilder-valueslist-btnDel").unbind(),t(".formBuilder-valueslist-btnDel").click(function(e){t(this).parent().parent().remove()}),t(".formBuilder-valueslistfixed-btnAdd").unbind(),t(".formBuilder-valueslistfixed-btnAdd").click(function(e){b._valueslistfixedAddFunc(t(this).attr("data-prefix"),t(this).attr("data-name"),"","")}),t(".formBuilder-valueslistfixed-btnDel").unbind(),t(".formBuilder-valueslistfixed-btnDel").click(function(e){t(this).parent().parent().remove()}),t(".formBuilder-valueslisteditable-btnAdd").unbind(),t(".formBuilder-valueslisteditable-btnAdd").click(function(e){b._valueslistAddFunc(t(this).attr("data-prefix"),t(this).attr("data-name"),"","")}),t(".formBuilder-valueslisteditable-btnDel").unbind(),t(".formBuilder-valueslisteditable-btnDel").click(function(e){t(this).parent().parent().remove()}),this.settings.events.onInit&&this.settings.events.onInit();var b=this;t(this.element).submit(function(t){t.preventDefault(),b._submit()}),this._captchaInit()},_valueslistAddFunc:function(e,a,i,s,n){var l=this._template(this.settings.html.valueslistItem,{prefix:e,name:a,key:i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t("#"+e+"_"+a+"_wrap").append(l),n||t("."+e+"-"+a+"-item").last().find("div>input:first").focus(),t(".formBuilder-valueslist-btnDel").unbind(),t(".formBuilder-valueslist-btnDel").click(function(e){e.stopPropagation(),t(this).parent().parent().remove()})},_valueslisteditableAddFunc:function(e,a,i,s,n,l,r){if(l="undefined"===l?null:l,i){i=String(i);var o=this._template(l?this.settings.html.valueslistItemEditablePostfix:this.settings.html.valueslistItemEditable,{prefix:e,name:a,key:i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,data:n,postfix:l,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t("#"+e+"_"+a+"_wrap").append(o),r||t("."+e+"-"+a+"-item").last().find("div>input:first").focus(),t(".formBuilder-valueslisteditable-btnDel").unbind(),t(".formBuilder-valueslisteditable-btnDel").click(function(e){e.stopPropagation(),t(this).parent().parent().remove()})}},_valueslistfixedAddFunc:function(e,a,i,s,n){var l=this._template(this.settings.html.valueslistfixedItem,{prefix:e,name:a,key:i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),value:s,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});t("#"+e+"_"+a+"_wrap").append(l),n||t("."+e+"-"+a+"-item").last().find("div>input:first").focus(),t(".formBuilder-valueslistfixed-btnDel").unbind(),t(".formBuilder-valueslistfixed-btnDel").click(function(e){e.stopPropagation(),t(this).parent().parent().remove()})},setValidation:function(t){this.validation=t},setEditMode:function(t){this.settings.edit=t},clearErrors:function(){t("."+this._prefix+"-form-field").removeClass(this.settings.formDangerClass),t("."+this._prefix+"-error-text").hide()},resetForm:function(){this.clearErrors();t("."+this._prefix+"-form-field").not(".zoiaFormBuilder-no-reset").val(""),t("select."+this._prefix+"-form-field").prop("selectedIndex",0),t(".formBuilder-valueslist-val").val(""),t("."+this._prefix+"-formBuilder-valueslist-wrap").html("");for(var e in this.settings.items){var a=this.settings.items[e];a.default&&t("#"+this._prefix+"_"+e).val(a.default),"launcher"===a.type&&(t("#"+this._prefix+"_"+e+"_val").html(a.value),t("#"+this._prefix+"_"+e+"_val").attr("data",a.data)),"checkboxlist"===a.type&&t("."+this._prefix+"-"+e+"-cbx").prop("checked",!1)}},serialize:function(){var e=this,a={};for(var i in this.settings.items){var s=this.settings.items[i];-1!==this._formTypes.indexOf(s.type)&&function(){switch(s.type){case"launcher":a[i]={type:s.type,value:t("#"+e._prefix+"_"+i+"_val").html(),id:t("#"+e._prefix+"_"+i+"_val").attr("data")};break;case"checkboxlist":var n=t("."+e._prefix+"-"+i+"-cbx:checked").map(function(){return t(this).attr("data")}).get();a[i]={type:s.type,value:n.join(",")};break;case"valueslist":var l=[];t("."+e._prefix+"-"+i+"-item").each(function(){l.push({p:String(t(this).find("*>.formBuilder-valueslist-par").val()),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),a[i]={type:s.type,value:l};break;case"valueslisteditable":var r=[];t("."+e._prefix+"-"+i+"-item").each(function(){r.push({p:String(t(this).find("*>.formBuilder-valueslist-par").html()),v:String(t(this).find("*>.formBuilder-valueslist-val").val()),d:String(t(this).find("*>.formBuilder-valueslist-val").attr("data")),t:String(t(this).find("*>.formBuilder-valueslist-val").attr("data-postfix"))})}),a[i]={type:s.type,value:r};break;case"valueslistfixed":var o=[];t("."+e._prefix+"-"+i+"-item").each(function(){o.push({p:String(t(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),a[i]={type:s.type,value:o};break;default:a[i]={type:s.type,value:t("#"+e._prefix+"_"+i).val()}}}()}return a},deserialize:function(e){if(e&&"object"===(void 0===e?"undefined":_typeof(e)))for(var a in this.settings.items)switch(e[a]||(e[a]={id:"",value:""}),e[a].type){case"launcher":t("#"+this._prefix+"_"+a+"_val").html(e[a].value),t("#"+this._prefix+"_"+a+"_val").attr("data",e[a].id);break;case"checkboxlist":var i=e[a].value.split(",");for(var s in i)t('.editForm-groups-cbx[data="'+i[s]+'"]').prop("checked",!0);break;case"valueslist":var n=[];for(var l in e[a].value)n.push(e[a].value[l].p),n.push(e[a].value[l].v);for(t("#"+this._prefix+"_"+a+"_wrap").html("");n.length>0;){var r=n.shift(),o=n.shift();this._valueslistAddFunc(this._prefix,a,r,o,!0)}break;case"valueslisteditable":var p=[];for(var u in e[a].value)p.push(e[a].value[u].p),p.push(e[a].value[u].v),p.push(e[a].value[u].d),p.push(e[a].value[u].t);for(t("#"+this._prefix+"_"+a+"_wrap").html("");p.length>0;){var d=p.shift(),c=p.shift(),h=p.shift(),f=p.shift();this._valueslisteditableAddFunc(this._prefix,a,d,c,h,f,!0)}break;case"valueslistfixed":t("."+this._prefix+"-"+a+"-item-val").val("");for(var m in e[a].value)t("."+this._prefix+"-"+a+'-item-val[data="'+e[a].value[m].p+'"]').val(e[a].value[m].v);break;default:t("#"+this._prefix+"_"+a).val(e[a].value||"")}},deserializePart:function(e,a){if(a&&"object"===(void 0===a?"undefined":_typeof(a)))switch(a||(a={id:"",value:""}),a.type){case"launcher":t("#"+this._prefix+"_"+e+"_val").html(a.value),t("#"+this._prefix+"_"+e+"_val").attr("data",a.id);break;case"checkboxlist":var i=a.value.split(",");for(var s in i)t('.editForm-groups-cbx[data="'+i[s]+'"]').prop("checked",!0);break;case"valueslist":var n=[];for(var l in a.value)n.push(a.value[l].p),n.push(a.value[l].v);for(t("#"+this._prefix+"_"+e+"_wrap").html("");n.length>0;){var r=n.shift(),o=n.shift();this._valueslistAddFunc(this._prefix,e,r,o,!0)}break;case"valueslisteditable":var p=[];for(var u in a.value)p.push(a.value[u].p),p.push(a.value[u].v),p.push(a.value[u].d),p.push(a.value[u].t);for(t("#"+this._prefix+"_"+e+"_wrap").html("");p.length>0;){var d=p.shift(),c=p.shift(),h=p.shift(),f=p.shift();this._valueslisteditableAddFunc(this._prefix,e,d,c,h,f,!0)}break;case"valueslistfixed":t("."+this._prefix+"-"+e+"-item-val").val("");for(var m in a.value)t("."+this._prefix+"-"+e+'-item-val[data="'+a.value[m].p+'"]').val(a.value[m].v);break;default:t("#"+this._prefix+"_"+e).val(a.value||"")}},loadJSON:function(e){var a=this,i=this;jQuery.each(e,function(e,s){if(t("#"+i._prefix+"_"+e).val(s),i.settings.items[e]&&"checkboxlist"===i.settings.items[e].type&&s){var n=s.split(",");for(var l in n)t('.editForm-groups-cbx[data="'+n[l]+'"]').prop("checked",!0)}if(i.settings.items[e]&&"valueslist"===i.settings.items[e].type&&s){var r=[];for(var o in s)r.push(o),r.push(s[o]);t("#"+i._prefix+"_"+e+"_wrap").html("");for(var p in s)i._valueslistAddFunc(i._prefix,e,r.shift(),r.shift())}if(i.settings.items[e]&&"valueslisteditable"===i.settings.items[e].type&&s){var u=[];for(var d in s)u.push(d),u.push(s[d]);t("#"+i._prefix+"_"+e+"_wrap").html("");for(var c in s)i._valueslisteditableAddFunc(i._prefix,e,u.shift(),u.shift(),u.shift(),u.shift())}if(i.settings.items[e]&&"valueslistfixed"===i.settings.items[e].type&&s){t("."+a._prefix+"-"+e+"-item-val").val("");for(var h in s)t("."+a._prefix+"-"+e+'-item-val[data="'+s[h].p+'"]').val(s[h].v)}})},loadData:function(e){var a=this;this.settings.events.onLoadStart&&this.settings.events.onLoadStart(),this.resetForm();var i=this;t.ajax({type:this.settings.load.method,url:this.settings.load.url,data:e,cache:!1}).done(function(e){e&&1===e.status?(jQuery.each(e.item,function(e,s){if(t("#"+i._prefix+"_"+e).val(s),i.settings.items[e]&&"checkboxlist"===i.settings.items[e].type&&s){var n=s.split(",");for(var l in n)t('.editForm-groups-cbx[data="'+n[l]+'"]').prop("checked",!0)}if(i.settings.items[e]&&"valueslist"===i.settings.items[e].type&&s){var r=[];for(var o in s)r.push(o),r.push(s[o]);t("#"+i._prefix+"_"+e+"_wrap").html("");for(var p in s)i._valueslistAddFunc(i._prefix,e,r.shift(),r.shift())}if(i.settings.items[e]&&"valueslisteditable"===i.settings.items[e].type&&s){var u=[];for(var d in s)u.push(d),u.push(s[d]);t("#"+i._prefix+"_"+e+"_wrap").html("");for(var c in s)i._valueslisteditableAddFunc(i._prefix,e,u.shift(),u.shift(),u.shift())}if(i.settings.items[e]&&"valueslistfixed"===i.settings.items[e].type&&s){t("."+a._prefix+"-"+e+"-item-val").val("");for(var h in s)t("."+a._prefix+"-"+e+'-item-val[data="'+s[h].p+'"]').val(s[h].v)}}),i.settings.events.onLoadSuccess&&i.settings.events.onLoadSuccess(e)):i.settings.events.onLoadError&&i.settings.events.onLoadError(e)}).fail(function(t,e){i.settings.events.onLoadError&&i.settings.events.onLoadError(t,e)})},captchaRefresh:function(){t("."+this._prefix+"-captcha-img").show(),t("."+this._prefix+"-captcha-img").attr("src",this.settings.captcha+"?"+(new Date).getTime()),t("."+this._prefix+"-captcha-field").val("")},_captchaInit:function(){this.captchaRefresh();var e=this;t("img."+this._prefix+"-captcha-img").click(function(){e.captchaRefresh()})},_template:function(t,e){for(var a in e)t=t.replace(new RegExp("{"+a+"}","g"),e[a]);return t},validate:function(e){var a=this,i={},s={};for(var n in this.settings.items){var l=this.settings.items[n];if(-1!==this._formTypes.indexOf(l.type))if("launcher"!==l.type){if(("valueslist"!==l.type||"continue"!==function(){if(e&&e[n])return s[n]=e[n].value,"continue";var i=[];return t("."+a._prefix+"-"+n+"-item").each(function(){i.push({p:String(t(this).find("*>.formBuilder-valueslist-par").val()),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),s[n]=i,"continue"}())&&!("valueslisteditable"===l.type&&"continue"===function(){if(e&&e[n])return s[n]=e[n].value,"continue";var i=[];return t("."+a._prefix+"-"+n+"-item").each(function(){i.push({p:String(t(this).find("*>.formBuilder-valueslist-par").val()),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),s[n]=i,"continue"}()||"valueslistfixed"===l.type&&"continue"===function(){if(e&&e[n])return s[n]=e[n].value,"continue";var i=[];return t("."+a._prefix+"-"+n+"-item").each(function(){i.push({p:String(t(this).find("*>.formBuilder-valueslist-val").attr("data")),v:String(t(this).find("*>.formBuilder-valueslist-val").val())})}),s[n]=i,"continue"}()))if("checkboxlist"!==l.type){var r=e?e[n]?e[n].value:void 0:t("#"+this._prefix+"_"+n).val();if(l.validation){if(!l.validation.mandatoryEdit&&!r&&this.settings.edit||!l.validation.mandatoryCreate&&!r&&!this.settings.edit)continue;if(l.validation.mandatoryCreate&&!r&&!this.settings.edit){i[n]=this.settings.lang.mandatoryMissing;continue}if(l.validation.mandatoryEdit&&!r&&this.settings.edit){i[n]=this.settings.lang.mandatoryMissing;continue}if(l.validation.process&&"function"==typeof l.validation.process&&(r=l.validation.process(r)),"passwordConfirm"===l.type&&t("#"+this._prefix+"_"+n+"Confirm").val()!==r){i[n]=this.settings.lang.passwordsNotMatch;continue}if(l.validation.length){if(l.validation.length.min&&r.length<l.validation.length.min){i[n]=this.settings.lang.tooShort;continue}if(l.validation.length.max&&r.length>l.validation.length.max){i[n]=this.settings.lang.tooLong;continue}}if(l.validation.regexp&&!r.match(l.validation.regexp)){i[n]=this.settings.lang.invalidFormat;continue}s[n]=r}}else{var o=t("."+this._prefix+"-"+n+"-cbx:checked").map(function(){return t(this).attr("data")}).get();s[n]=e?e[n]?e[n].value:void 0:o.join(",")}}else s[n]=e?e[n]?e[n].id:void 0:t("#"+this._prefix+"_"+n+"_val").attr("data")}return{data:s,errors:i}},errors:function(e){if(Object.keys(e).length>0){var a=!1;for(var i in e)t("#"+this._prefix+"_"+i).addClass(this.settings.formDangerClass),t("#"+this._prefix+"_"+i+"_error_text > span").html(e[i]),t("#"+this._prefix+"_"+i+"_error_text").show(),a||(t("#"+this._prefix+"_"+i).focus(),a=!0),"passwordConfirm"===this.settings.items[i].type&&t("#"+this._prefix+"_"+i+"Confirm").addClass(this.settings.formDangerClass);return!0}return!1},_submit:function(){if(!this._saving){this.settings.events.onSaveSubmit&&this.settings.events.onSaveSubmit(),this.clearErrors();var e=this,a={},i={};if(this.settings.validation){var s=this.validate();if(a=s.data||{},i=s.errors||{},this.errors(i))return;if(this.settings.events.onSaveValidate&&"__stop"===(a=this.settings.events.onSaveValidate(a,i)||a))return}else if(this.settings.events.onSaveValidate&&"__stop"===(a=this.settings.events.onSaveValidate(a)))return;e._saving=!0,t.ajax({type:this.settings.save.method,url:this.settings.save.url,data:a,cache:!1}).done(function(a){if(e._saving=!1,a&&1===a.status)e.settings.events.onSaveSuccess&&e.settings.events.onSaveSuccess(a);else{if(a.fields)for(var i in a.fields){var s=!1;t("#"+e._prefix+"_"+a.fields[i]).addClass(e.settings.formDangerClass),s||(t("#"+e._prefix+"_"+a.fields[i]).focus(),s=!0)}e.captchaRefresh(),e.settings.events.onSaveError&&e.settings.events.onSaveError(a)}}).fail(function(t,a){e._saving=!1,e.captchaRefresh(),e.settings.events.onSaveError&&e.settings.events.onSaveError(t,a)})}}}),t.fn.zoiaFormBuilder=function(e){var i=void 0;return this.each(function(){(i=t.data(this,"plugin_zoiaFormBuilder"))||(i=new a(this,e),t.data(this,"plugin_zoiaFormBuilder",i))}),i}}(jQuery,window,document),function(t){function e(e,s){this.element=e,this.settings=t.extend({},i,s),this._defaults=i,this._name=a,this.page=1,this.loading=!1,this.search="",this.currentData={},this.init()}var a="zoiaTable",i={limit:10,maxPages:7,html:{spinnerHTML:'<div style="width:40px;height:40px;background-color:#333;-webkit-animation:sk-rotateplane 1.2s infinite ease-in-out;animation: sk-rotateplane 1.2s infinite ease-in-out;margin: auto;position: absolute;top:0;left:0;bottom:0;right:0"></div>',spinnerWrapCSS:"background:#fff;position:absolute;opacity:0.6",headCSS:"@-webkit-keyframes sk-rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}100%{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes sk-rotateplane{0%{transform:perspective(120px) rotateX(0deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(0deg) rotateY(0deg)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0deg)}100%{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}",listWrapStartHTML:'<ul class="za-pagination" za-margin>',listWrapEndHTML:"</ul>",itemPagePrevHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-previous></span></a></li>',itemPageNextHTML:'<li><a href="#"><a class="zoia-page {elementId}PaginationLink" data-page="{page}"><span za-pagination-next></span></a></li>',itemPageHTML:'<li><a class="zoia-page {elementId}PaginationLink" data-page="{page}">{page}</a></li>',itemPageDotsHTML:'<li class="za-disabled"><span>...</span></li>',arrowDown:"&nbsp;&#x25BC;",arrowUp:"&nbsp;&#x25B2;",errorHTML:'<tr><td colspan="100%">{error}</td></tr>'},lang:{error:"Could not load data from server. Please try to refresh page in a few moments.",noitems:"No items to display"},sort:{},loadOnStart:!0,onLoad:function(){}};t.extend(e.prototype,{init:function(){var e=this;t("head").append('<style type="text/css">'+this.settings.html.headCSS+"</style>"),t(this.element).before('<div style="'+this.settings.html.spinnerWrapCSS+'" id="'+this.element.id+'LoadingDiv">'+this.settings.html.spinnerHTML+"</div>"),this._loading(!1),this.header=[];for(var a=0;a<t("#"+this.element.id+" > thead > tr").children("th").length;a++){var i=t("#"+this.element.id+" > thead > tr").children("th")[a];if(i.id){this.header.push(i.id);var s=i.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.fields[s]&&this.settings.fields[s].sortable&&(t(i).css("cursor","pointer"),t(i).click(function(t){e._sortColumn(t)}))}}t("."+this.element.id+"SearchInput").keypress(e._debounce(function(t){e._search(t)},250)),t("."+this.element.id+"SearchInputClear").click(function(t){e._searchReset(t)}),this.settings.loadOnStart&&this.load()},_search:function(e){this.loading||(this.search=t(e.target).val().trim(),this.page=1,this.load())},_searchReset:function(){this.loading||(t("."+this.element.id+"SearchInput").val("").focus(),this.search="",this.page=1,this.load())},_sortIndicator:function(e,a){t("#"+this.element.id+"SortingIndicator").remove();for(var i="desc"===a?this.settings.html.arrowDown:this.settings.html.arrowUp,s=0;s<t("#"+this.element.id+" > thead > tr").children("th").length;s++){var n=t("#"+this.element.id+" > thead > tr").children("th")[s];n.id===this.element.id+"_"+e&&t(n).html(t(n).html()+'<span class="zoiaTableSortingIndicator" id="'+this.element.id+'SortingIndicator">'+i+"</span>")}},_sortColumn:function(t){if(t.preventDefault(),t.target.id&&t.target.id!==this.element.id+"SortingIndicator"){var e=t.target.id.replace(new RegExp("^"+this.element.id+"_"),"");this.settings.sort.field===e?this.settings.sort.direction="asc"===this.settings.sort.direction?"desc":"asc":(this.settings.sort.field=e,this.settings.sort.direction="asc"),this.load()}},_template:function(t,e){for(var a in e)t=t.replace(new RegExp("{"+a+"}","g"),e[a]);return t},_bindSelectButtons:function(){var e=this;t("."+this.element.id+"BtnSelectAll").click(function(){e._selectAll()}),t("."+this.element.id+"BtnSelectNone").click(function(){e._selectNone()})},_selectAll:function(){this.loading||t("."+this.element.id+"Checkbox").prop("checked",!0)},_selectNone:function(){this.loading||t("."+this.element.id+"Checkbox").prop("checked",!1)},_pagination:function(){var e=this,a=this.settings.maxPages,i=Math.ceil(this.total/this.settings.limit);if(i<2)t("."+this.element.id+"Pagination").html("");else{var s=this.settings.html.listWrapStartHTML;if(i>a){this.page>1&&(s+=this._template(this.settings.html.itemPagePrevHTML,{elementId:this.element.id,page:this.page-1})),this.page>3&&(s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:1}));var n=this.page-2;n<1&&(n=1),n-1>1&&(s+=this.settings.html.itemPageDotsHTML);var l=this.page+2;l>i&&(l=i);for(var r=n;r<=l;r++)s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:r});l<i-1&&(s+=this.settings.html.itemPageDotsHTML),this.page<=i-3&&(s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:i})),this.page<i&&(s+=this._template(this.settings.html.itemPageNextHTML,{elementId:this.element.id,page:this.page+1}))}else for(var o=1;o<=i;o++)s+=this._template(this.settings.html.itemPageHTML,{elementId:this.element.id,page:o});s+=this.settings.html.listWrapEndHTML,t("."+this.element.id+"Pagination").html(s),t("."+this.element.id+"PaginationLink").click(function(){var a=parseInt(t(this).data("page"),10);e.loading||e.page===a||(e.page=a,e.load())})}},_loading:function(e){var a="#"+this.element.id+"LoadingDiv";t(a).css({top:t(this.element).top,left:t(this.element).left,width:t(this.element).outerWidth(!0),height:t(this.element).outerHeight(!0)}),e?this.loadingInt=setTimeout(function(){t(a).show()},300):(clearTimeout(this.loadingInt),t(a).hide())},_debounce:function(t,e){var a=null;return function(){var i=this,s=arguments;clearTimeout(a),a=setTimeout(function(){t.apply(i,s)},e)}},getCurrentData:function(){return this.currentData},load:function(){if(this.settings.url&&!this.loading){var e=this,a="";this._loading(!0),this.loading=!0,t.ajax({type:"GET",url:this.settings.url,data:{limit:this.settings.limit,skip:this.page*this.settings.limit-this.settings.limit,sortField:this.settings.sort.field,sortDirection:this.settings.sort.direction,search:this.search},cache:!1}).done(function(i){if(e.loading=!1,i){e.pages=parseInt(i.total/e.settings.limit,10),i.total%e.settings.limit>0&&e.pages++,e.total=i.total,e._pagination(),e.currentData={};for(var s in i.items){var n=i.items[s];e.currentData[n._id]=n,a+="<tr>";for(var l in e.header)if(e.header[l]===e.element.id+"ID")a+='<td><input type="checkbox" id="'+n._id+'" class="za-checkbox '+e.element.id+'Checkbox"></td>';else{var r=!1,o=e.header[l].replace(new RegExp("^"+e.element.id+"_"),"");for(var p in n)p===o&&e.settings.fields[p]&&(n[p]&&"string"==typeof n[p]&&(n[p]=n[p].replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")),a+="<td>"+e.settings.fields[p].process(p,n,n[p])+"</td>",r=!0);r||(e.settings.fields[o]&&e.settings.fields[o].process?a+="<td>"+e.settings.fields[o].process(o,n)+"</td>":a+="<td></td>")}a+="</tr>"}t(e.element).find("tbody").html(a.length?a:e._template(e.settings.html.errorHTML,{error:e.settings.lang.noitems})),e._loading(!1),t('*[data-page="'+e.page+'"]').parent().addClass("za-active"),e._bindSelectButtons(),e.settings.sort.field&&e._sortIndicator(e.settings.sort.field,e.settings.sort.direction),t(e.element).find("thead").show(),e.settings.onLoad()}else e.loading=!1,e._loading(!1),t(e.element).find("tbody").html(e._template(e.settings.html.errorHTML,{error:e.settings.lang.error}))}).fail(function(){e.loading=!1,e._loading(!1),t(e.element).find("tbody").html(e._template(e.settings.html.errorHTML,{error:e.settings.lang.error}))})}}}),t.fn[a]=function(i){var s=void 0;return this.each(function(){(s=t.data(this,"plugin_"+a))||(s=new e(this,i),t.data(this,"plugin_"+a,s))}),s}}(jQuery,window,document);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},supportDialog=void 0,supportMessageDialog=void 0,currentSupportRequestID=void 0,currentSupportMessageID=void 0,currentData=void 0,bindMessageHandlers=function(){$(".zoia-msg-edit").unbind().click(function(){currentSupportMessageID=$(this).attr("data"),$("#zoia_support_msg").removeClass("za-form-danger").val(""),supportMessageDialog.show().then(function(){$("#zoia_support_msg").val($('.zoia-msg-text[data="'+currentSupportMessageID+'"]').html().replace(/&lt;/,"<").replace(/&gt;/,">").replace(/&quot;/,'"').replace(/&amp;/,"&")),$("#zoia_support_msg").focus()})}),$(".zoia-msg-delete").unbind().click(function(){currentSupportMessageID=$(this).attr("data"),$zUI.modal.confirm(lang["Message will be removed from support ticket. Continue?"],{labels:{ok:lang.Yes,cancel:lang.Cancel},stack:!0}).then(function(){$("#zoiaSpinnerDark").show(),$.ajax({type:"POST",url:"/api/support/request/message/delete",cache:!1,data:{id:currentSupportRequestID,msgId:currentSupportMessageID}}).done(function(t){$("#zoiaSpinnerDark").hide(),t&&1===t.status?$('.zoia-msg-text[data="'+currentSupportMessageID+'"]').parent().parent().remove():$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})}).fail(function(){$("#zoiaSpinnerDark").hide(),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})},200)})})},ajaxPickUp=function(t,e,a){$("#zoiaSpinnerWhite").show(),$.ajax({type:"POST",url:"/api/support/request/pickup",cache:!1,data:{id:currentSupportRequestID,pickup:!!t||null}}).done(function(t){$("#zoiaSpinnerWhite").hide(),t&&1===t.status?($("#zoia_support_specialist").html(t.specialist),e||$zUI.notification(lang["Data has been saved successfully"],{status:"success",timeout:1500}),a&&$("#support").zoiaTable().load()):$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})}).fail(function(){$("#zoiaSpinnerWhite").hide(),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})},200)},bindDeleteAttachmentHandlers=function(){$(".zoia-attachment-delete").unbind().click(function(){var t=$(this).parent().find("a").html(),e=$(this).attr("data-id"),a=$(this).attr("data-fid");$zUI.modal.confirm(lang["The following file will be deleted. Continue?"]+"<br><br>"+t,{labels:{ok:lang.Yes,cancel:lang.Cancel},stack:!0}).then(function(){deleteAttachment(e,a)})})},loadSupportRequest=function(){$.ajax({type:"GET",url:"/api/support/request/load",cache:!1,data:{id:currentSupportRequestID}}).done(function(t){if(t&&1===t.status&&t.data){currentData=t.data,$("#zoia_support_timestamp").html(new Date(1e3*parseInt(t.data.timestamp)).toLocaleString()),$("#zoia_support_username").html(t.data.username),$("#zoia_support_specialist").html(t.data.specialist),$("#zoia_support_status").val(t.data.status),$("#zoia_support_priority").val(t.data.priority),$("#zoia_support_title").val(t.data.title),t.data.messages&&t.data.messages.sort(function(t,e){return t.timestamp>e.timestamp?-1:e.timestamp>t.timestamp?1:0});var e="";for(var a in t.data.messages){var i="";t.data.messages[a].username!==currentUsername&&(i=" zoia-reply-msg"),e+='<article class="za-comment za-margin za-card za-card-default za-card-small za-card-body'+i+'"><header class="za-comment-header za-grid-medium za-flex-middle" za-grid><div class="za-width-expand""><h4 class="za-comment-title za-margin-remove"><span class="za-link-reset">'+t.data.messages[a].username+'</span></h4><ul class="za-comment-meta za-subnav za-subnav-divider za-margin-remove-top" style="border-bottom:1px solid #ddd"><li><span>'+new Date(1e3*parseInt(t.data.messages[a].timestamp)).toLocaleString()+'</span></li><li><span class="zoia-msg-edit" data="'+t.data.messages[a].id+'">'+lang.Edit+'</span></li><li><span class="zoia-msg-delete" data="'+t.data.messages[a].id+'">'+lang.Delete+'</span></li></ul></div></header><div class="za-comment-body"><p class="zoia-msg-text" data="'+t.data.messages[a].id+'">'+t.data.messages[a].message.replace(/\n/gm,"<br>")+"</p></div></article>"}$("#zoia_support_messages").html(e);var s="";for(var n in t.data.files){var l=t.data.files[n];s+='<div><span za-icon="icon:trash" class="zoia-attachment-delete" data-id="'+t.data._id+'" data-fid="'+l.id+'"></span>&nbsp;<a href="/api/support/download?id='+t.data._id+"&fid="+l.id+'" target="_blank">'+l.filename+"</a></div>"}$("#zoia_attachments").html(s),bindMessageHandlers(),bindDeleteAttachmentHandlers(),$("#support_request_id").html(currentSupportRequestID),t.data.specialist&&t.data.specialist!==currentUsername?(setTimeout(function(){$("#zoiaSpinnerDark").hide()},200),$zUI.modal.confirm(lang["Selected support request is currently being processed by another specialist. Continue?"]+"<br><br>"+t.data.specialist,{labels:{ok:lang.Yes,cancel:lang.Cancel},stack:!0}).then(function(){supportDialog.show().then(function(){$zUI.tab("#zoia_support_dialog_tabs").show(0)})})):supportDialog.show().then(function(){$zUI.tab("#zoia_support_dialog_tabs").show(0),$("#zoiaSpinnerDark").hide()})}else $("#zoiaSpinnerDark").hide(),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})}).fail(function(){$("#zoiaSpinnerDark").hide(),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})},200)},btnMessageSaveClickHandler=function(){$("#zoia_support_msg").removeClass("za-form-danger");var t=$("#zoia_support_msg").val().trim();if(!t||t.length>4096)return $("#zoia_support_msg").addClass("za-form-danger");$("#zoiaSpinnerDark").show(),$.ajax({type:"POST",url:"/api/support/request/message/edit",cache:!1,data:{id:currentSupportRequestID,msgId:currentSupportMessageID,msg:t}}).done(function(t){if($("#zoiaSpinnerDark").hide(),t&&1===t.status){if(currentSupportMessageID)$('.zoia-msg-text[data="'+currentSupportMessageID+'"]').html(t.message.message.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;"));else{var e='<article class="za-comment za-margin za-card za-card-default za-card-small za-card-body"><header class="za-comment-header za-grid-medium za-flex-middle" za-grid><div class="za-width-expand""><h4 class="za-comment-title za-margin-remove"><span class="za-link-reset">'+t.message.username+'</span></h4><ul class="za-comment-meta za-subnav za-subnav-divider za-margin-remove-top" style="border-bottom:1px solid #ddd"><li><span>'+new Date(1e3*parseInt(t.message.timestamp)).toLocaleString()+'</span></li><li><span class="zoia-msg-edit" data="'+t.message.id+'">'+lang.Edit+'</span></li><li><span class="zoia-msg-delete" data="'+t.message.id+'">'+lang.Delete+'</span></li></ul></div></header><div class="za-comment-body"><p class="zoia-msg-text" data="'+t.message.id+'">'+t.message.message.replace(/\n/gm,"<br>")+"</p></div></article>";$("#zoia_support_messages").prepend(e),bindMessageHandlers()}supportMessageDialog.hide()}else $("#zoiaSpinnerDark").hide(),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})}).fail(function(){$("#zoiaSpinnerDark").hide(),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})},200)},initUploader=function(){var t=document.getElementById("zoia_upload_progressbar");$zUI.upload(".zoia-upload",{url:"/api/support/request/upload",multiple:!0,beforeAll:function(){this.params.id=currentSupportRequestID},error:function(){t.setAttribute("hidden","hidden"),$zUI.modal.alert(lang["Could not upload file to server. Please check file name and size, then try again."],{labels:{ok:lang.OK},stack:!0})},loadStart:function(e){t.removeAttribute("hidden"),t.max=e.total,t.value=e.loaded},progress:function(e){t.max=e.total,t.value=e.loaded},loadEnd:function(e){t.max=e.total,t.value=e.loaded},completeAll:function(e){var a={};try{a=JSON.parse(e.response)}catch(t){}if(a.status&&1===a.status){var i="";for(var s in a.files){var n=a.files[s];i+='<div><span za-icon="icon:trash" class="zoia-attachment-delete" data-id="'+currentSupportRequestID+'" data-fid="'+n.id+'"></span>&nbsp;<a href="/api/support/download?id='+currentSupportRequestID+"&fid="+n.id+'" target="_blank">'+n.filename+"</a></div>"}$("#zoia_attachments").html(i),bindDeleteAttachmentHandlers()}else a.error?$zUI.modal.alert(a.error,{labels:{ok:lang.OK},stack:!0}):$zUI.modal.alert(lang["Could not upload file to server. Please check file name and size, then try again."],{labels:{ok:lang.OK},stack:!0});setTimeout(function(){t.setAttribute("hidden","hidden")},1e3)}})},btnCommonSaveClickHandler=function(t){$("#zoia_support_title").removeClass("za-form-danger");var e=$("#zoia_support_title").val().trim(),a=$("#zoia_support_status").val(),i=$("#zoia_support_priority").val();if(!e||e.length>512)return $("#zoia_support_title").addClass("za-form-danger").focus();$("#zoiaSpinnerWhite").show(),$.ajax({type:"POST",url:"/api/support/request/common/save",cache:!1,data:{id:currentSupportRequestID,title:e,status:a,priority:i}}).done(function(e){setTimeout(function(){$("#zoiaSpinnerWhite").hide()},300),e&&1===e.status?(currentData.status=parseInt($("#zoia_support_status").val()),currentData.priority=parseInt($("#zoia_support_priority").val()),currentData.title=$("#zoia_support_title").val(),$zUI.notification(lang["Data has been saved successfully"],{status:"success",timeout:1500})):$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500}),t&&t()}).fail(function(){setTimeout(function(){$("#zoiaSpinnerWhite").hide()},300),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500}),t&&t()},200)},deleteAttachment=function(t,e){$("#zoiaSpinnerWhite").show(),$.ajax({type:"POST",url:"/api/support/request/attachment/delete",cache:!1,data:{id:t,fid:e}}).done(function(t){setTimeout(function(){$("#zoiaSpinnerWhite").hide()},300),t&&1===t.status?$('.zoia-attachment-delete[data-fid="'+e+'"]').parent().remove():$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})}).fail(function(){setTimeout(function(){$("#zoiaSpinnerWhite").hide()},300),$zUI.notification(lang["Error while loading data"],{status:"danger",timeout:1500})},200)},zoiaDeleteButtonClickHandler=function(t){if(t){var e=[],a=[];if("object"===(void 0===t?"undefined":_typeof(t))){e=t,currentDeleteID=t;for(var i in t)a.push($("#support").zoiaTable().getCurrentData()[t[i]]._id+" ("+$("#support").zoiaTable().getCurrentData()[t[i]].title+")")}else e.push(t),a.push($("#support").zoiaTable().getCurrentData()[t]._id+" ("+$("#support").zoiaTable().getCurrentData()[t].title+")");$zUI.modal.confirm(lang["The following support request(s) will be removed. Continue?"]+"<br><br>"+a.join("<br>"),{labels:{ok:lang.Yes,cancel:lang.Cancel},stack:!0}).then(function(){$("#zoiaSpinnerWhite").show(),$.ajax({type:"POST",url:"/api/support/request/delete",data:{id:e},cache:!1}).done(function(t){$("#zoiaSpinnerWhite").hide(),$("#support").zoiaTable().load(),$zUI.notification(t&&1===t.status?lang["Operation was successful"]:lang["Cannot delete one or more items"],{status:t&&1===t.status?"success":"danger",timeout:1500})}).fail(function(){$("#zoiaSpinnerWhite").hide(),$("#support").zoiaTable().load(),$zUI.notification(lang["Cannot delete one or more items"],{status:"danger",timeout:1500})})})}},supportBtnRefreshClick=function(){$("#support").zoiaTable().load()},pickupTicketHandler=function(){ajaxPickUp(!0)},releaseTicketHandler=function(){ajaxPickUp(!1)};$(document).ready(function(){$("#support").zoiaTable({url:"/api/support/list",limit:20,sort:{field:"_id",direction:"desc"},fields:{_id:{sortable:!0,process:function(t,e,a){return a}},timestamp:{sortable:!0,process:function(t,e,a){return new Date(1e3*parseInt(a,10)).toLocaleString().replace(/\s/gm,"&nbsp;")}},username:{sortable:!0,process:function(t,e,a){return a}},title:{sortable:!0,process:function(t,e,a){return e.unreadSupport&&(a='<span class="za-icon-button" za-icon="icon:mail;ratio:0.6" style="background:#FFB03B;color:#fff;width:20px;height:20px;"></span>&nbsp;'+a),a}},status:{sortable:!0,process:function(t,e,a){return lang.statuses[a]}},specialist:{sortable:!0,process:function(t,e,a){return a||"&ndash;"}},priority:{sortable:!0,process:function(t,e,a){return lang.priorities[a]?lang.priorities[a].replace(/\s/g,"&nbsp;"):"&ndash;"}},actions:{sortable:!1,process:function(t,e){return e&&"admin"===e.groupname?"&ndash;":'<button class="za-icon-button zoia-support-action-edit-btn" za-icon="icon: pencil" data="'+e._id+'" style="margin-right:5px"></button><button class="za-icon-button zoia-support-action-del-btn" za-icon="icon: trash" data="'+e._id+'"></button><div style="margin-bottom:17px" class="za-hidden@m">&nbsp;</div>'}}},onLoad:function(){$(".zoia-support-action-edit-btn").click(function(){$("#zoiaSpinnerDark").show(),currentSupportRequestID=$(this).attr("data"),loadSupportRequest()}),$(".zoia-support-action-del-btn").click(function(){zoiaDeleteButtonClickHandler($(this).attr("data"))})},lang:{error:lang["Could not load data from server. Please try to refresh page in a few moments."],noitems:lang["No items to display"]}}),supportDialog=$zUI.modal("#supportDialog",{bgClose:!1,escClose:!1,stack:!0}),supportMessageDialog=$zUI.modal("#supportMessageDialog",{bgClose:!1,escClose:!1,stack:!0});for(var t in lang.statuses)$("#zoia_support_status").append('<option value="'+t+'">'+lang.statuses[t]+"</option>");for(var e in lang.priorities)$("#zoia_support_priority").append('<option value="'+e+'">'+lang.priorities[e]+"</option>");$("#zoia_btn_message_add").click(function(){currentSupportMessageID=null,$("#zoia_support_msg").removeClass("za-form-danger").val(""),supportMessageDialog.show().then(function(){$("#zoia_support_msg").focus()})}),$("#zoia_btn_message_save").click(btnMessageSaveClickHandler),$("#zoia_common_save").click(btnCommonSaveClickHandler),$(".zoiaDeleteButton").click(function(){var t=$(".supportCheckbox:checkbox:checked").map(function(){return this.id}).get();t&&t.length>0&&zoiaDeleteButtonClickHandler(t)}),$("#zoia_common_pickup").click(pickupTicketHandler),$("#zoia_common_release").click(releaseTicketHandler),$("#zoia_btn_ticket_done").click(function(){parseInt(currentData.status)!==parseInt($("#zoia_support_status").val())||parseInt(currentData.priority,10)!==parseInt($("#zoia_support_priority").val(),10)||currentData.title!==$("#zoia_support_title").val()?$zUI.modal.confirm(lang["There are unsaved changes. Save?"],{labels:{ok:lang.Yes,cancel:lang.No},stack:!0}).then(function(){btnCommonSaveClickHandler(function(){0===parseInt($("#zoia_support_status").val(),10)?ajaxPickUp(!1,!0,!0):$("#support").zoiaTable().load()})}):0===parseInt($("#zoia_support_status").val(),10)?ajaxPickUp(!1,!0,!0):$("#support").zoiaTable().load()}),$(".supportBtnRefresh").click(supportBtnRefreshClick),initUploader()});