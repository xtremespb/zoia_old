"use strict";!function(){var a=!1,i=void 0,t=void 0,o=void 0,n=function(){a||($("#spnCheckUpdates").show(),a=!0,$.ajax({type:"GET",url:"/api/updates/check",cache:!1}).done(function(e){if($("#spnCheckUpdates").hide(),a=!1,e&&1===e.status)if(e.update&&e.update.version){if($("#zoiaUpdateDialogVersion").html(e.update.version),e.update.changelog){var t="";for(var o in e.update.changelog)t+="<li>"+e.update.changelog[o]+"</li>";$("#zoiaUpdateDialogChangelog").html(t)}i.show()}else $zUI.notification(lang["Your system is up to date"],{status:"success",timeout:1500});else $zUI.notification(lang["Could not get version information from remote server"],{status:"danger",timeout:1500})}).fail(function(){$("#spnCheckUpdates").hide(),a=!1,$zUI.notification(lang["Could not get version information from remote server"],{status:"danger",timeout:1500})}))},r=function(){$.ajax({type:"GET",url:"/api/updates/extract",cache:!1}).done(function(e){e&&1===e.status?(window.progressbar&&(progressbar.value=100),setTimeout(function(){o.show(),$.ajax({type:"GET",url:"/api/updates/restart",cache:!1}),setTimeout(function(){o.hide(),location.href="/admin?rnd="+Date.now()},3e4)},1e3)):(t.hide(),$zUI.notification(lang["Could not extract the update archive"]+(e.error?": "+e.error:""),{status:"danger",timeout:3e3}))}).fail(function(){t.hide(),$zUI.notification(lang["Error while updating your system"],{status:"danger",timeout:1500})})},s=function(){i.hide(),window.progressbar&&(progressbar.value=10),t.show().then(function(){$.ajax({type:"GET",url:"/api/updates/download",cache:!1}).done(function(e){if(!e||1!==e.status)return t.hide(),void $zUI.notification(lang["Could not download new version from remote server"]+(e.error?": "+e.error:""),{status:"danger",timeout:3e3});window.progressbar&&(progressbar.value=50),r()}).fail(function(){t.hide(),$zUI.notification(lang["Error while updating your system"],{status:"danger",timeout:1500})})})};$(document).ready(function(){var e=$("#zp_locale").attr("data");$.getScript("/api/lang/updates/"+e+".js").done(function(){$("#btnCheckUpdates").click(n),$("#btnUpdateStart").click(s),i=$zUI.modal("#zoiaUpdateDialog",{bgClose:!1,escClose:!1}),t=$zUI.modal("#zoiaUpdateProgressDialog",{bgClose:!1,escClose:!1}),o=$zUI.modal("#zoiaRestartProgressDialog",{bgClose:!1,escClose:!1}),$(".zoia-admin-loading").hide(),$("#zoia_admin_panel_wrap").show()})})}();