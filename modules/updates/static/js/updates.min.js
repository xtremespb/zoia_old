"use strict";!function(){var o=!1,i=void 0,t=void 0,a=void 0,n=void 0,r=function(){o||($("#spnCheckUpdates").show(),o=!0,$.ajax({type:"GET",url:"/api/updates/check",cache:!1}).done(function(e){if($("#spnCheckUpdates").hide(),o=!1,e&&1===e.status)if(e.update&&e.update.version){if($("#zoiaUpdateDialogVersion").html(e.update.version),e.update.changelog){var t="";for(var a in e.update.changelog)t+="<li>"+e.update.changelog[a]+"</li>";$("#zoiaUpdateDialogChangelog").html(t)}i.show()}else $zUI.notification(lang["Your system is up to date"],{status:"success",timeout:1500});else $zUI.notification(lang["Could not get version information from remote server"],{status:"danger",timeout:1500})}).fail(function(){$("#spnCheckUpdates").hide(),o=!1,$zUI.notification(lang["Could not get version information from remote server"],{status:"danger",timeout:1500})}))},s=function(){$.ajax({type:"GET",url:"/api/updates/extract",cache:!1}).done(function(e){e&&1===e.status?(window.progressbar&&(progressbar.value=100),setTimeout(function(){a.show(),$.ajax({type:"GET",url:"/api/updates/restart",cache:!1}),setTimeout(function(){a.hide(),location.href=n.admin+"?rnd="+Date.now()},3e4)},1e3)):(t.hide(),$zUI.notification(lang["Could not extract the update archive"]+(e.error?": "+e.error:""),{status:"danger",timeout:3e3}))}).fail(function(){t.hide(),$zUI.notification(lang["Error while updating your system"],{status:"danger",timeout:1500})})},d=function(){i.hide(),window.progressbar&&(progressbar.value=10),t.show().then(function(){$.ajax({type:"GET",url:"/api/updates/download",cache:!1}).done(function(e){if(!e||1!==e.status)return t.hide(),void $zUI.notification(lang["Could not download new version from remote server"]+(e.error?": "+e.error:""),{status:"danger",timeout:3e3});window.progressbar&&(progressbar.value=50),s()}).fail(function(){t.hide(),$zUI.notification(lang["Error while updating your system"],{status:"danger",timeout:1500})})})};$(document).ready(function(){var e=$("#zp_locale").attr("data");$("#zp_uprefix").attr("data");n=JSON.parse($("#zp_corePrefix").attr("data")),$.getScript("/api/lang/updates/"+e+".js").done(function(){$("#btnCheckUpdates").click(r),$("#btnUpdateStart").click(d),i=$zUI.modal("#zoiaUpdateDialog",{bgClose:!1,escClose:!1}),t=$zUI.modal("#zoiaUpdateProgressDialog",{bgClose:!1,escClose:!1}),a=$zUI.modal("#zoiaRestartProgressDialog",{bgClose:!1,escClose:!1}),$(".zoia-admin-loading").hide(),$("#zoia_admin_panel_wrap").show()})})}();